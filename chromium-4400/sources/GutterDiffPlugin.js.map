{"version":3,"file":"GutterDiffPlugin.js","sourceRoot":"","sources":["../../../../../front_end/sources/GutterDiffPlugin.js"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2018 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../common/common.js';\nimport * as Diff from '../diff/diff.js';  // eslint-disable-line no-unused-vars\nimport * as Persistence from '../persistence/persistence.js';\nimport {ls} from '../platform/platform.js';\nimport * as SourceFrame from '../source_frame/source_frame.js';\nimport * as TextEditor from '../text_editor/text_editor.js';  // eslint-disable-line no-unused-vars\nimport * as UI from '../ui/ui.js';                            // eslint-disable-line no-unused-vars\nimport * as Workspace from '../workspace/workspace.js';\nimport * as WorkspaceDiff from '../workspace_diff/workspace_diff.js';\n\nimport {Plugin} from './Plugin.js';\n\nexport class GutterDiffPlugin extends Plugin {\n  /**\n   * @param {!SourceFrame.SourcesTextEditor.SourcesTextEditor} textEditor\n   * @param {!Workspace.UISourceCode.UISourceCode} uiSourceCode\n   */\n  constructor(textEditor, uiSourceCode) {\n    super();\n    this._textEditor = textEditor;\n    this._uiSourceCode = uiSourceCode;\n\n    /** @type {!Array<!GutterDecoration>} */\n    this._decorations = [];\n    this._textEditor.installGutter(DiffGutterType, true);\n    this._workspaceDiff = WorkspaceDiff.WorkspaceDiff.workspaceDiff();\n    this._workspaceDiff.subscribeToDiffChange(this._uiSourceCode, this._update, this);\n    this._update();\n  }\n\n  /**\n   * @override\n   * @param {!Workspace.UISourceCode.UISourceCode} uiSourceCode\n   * @return {boolean}\n   */\n  static accepts(uiSourceCode) {\n    return uiSourceCode.project().type() === Workspace.Workspace.projectTypes.Network;\n  }\n\n  /**\n   * @param {!Array<!GutterDecoration>} removed\n   * @param {!Array<!GutterDecoration>} added\n   */\n  _updateDecorations(removed, added) {\n    this._textEditor.operation(operation);\n\n    function operation() {\n      for (const decoration of removed) {\n        decoration.remove();\n      }\n      for (const decoration of added) {\n        decoration.install();\n      }\n    }\n  }\n\n  _update() {\n    if (this._uiSourceCode) {\n      this._workspaceDiff.requestDiff(this._uiSourceCode).then(this._innerUpdate.bind(this));\n    } else {\n      this._innerUpdate(null);\n    }\n  }\n\n  /**\n   * @param {?Diff.Diff.DiffArray} lineDiff\n   */\n  _innerUpdate(lineDiff) {\n    if (!lineDiff) {\n      this._updateDecorations(this._decorations, []);\n      this._decorations = [];\n      return;\n    }\n\n    const diff = SourceFrame.SourceCodeDiff.SourceCodeDiff.computeDiff(lineDiff);\n\n    /** @type {!Map<number, !{lineNumber: number, type: !SourceFrame.SourceCodeDiff.EditType}>} */\n    const newDecorations = new Map();\n    for (let i = 0; i < diff.length; ++i) {\n      const diffEntry = diff[i];\n      for (let lineNumber = diffEntry.from; lineNumber < diffEntry.to; ++lineNumber) {\n        newDecorations.set(lineNumber, {lineNumber: lineNumber, type: diffEntry.type});\n      }\n    }\n\n    const decorationDiff = this._calculateDecorationsDiff(newDecorations);\n    const addedDecorations =\n        decorationDiff.added.map(entry => new GutterDecoration(this._textEditor, entry.lineNumber, entry.type));\n\n    this._decorations = decorationDiff.equal.concat(addedDecorations);\n    this._updateDecorations(decorationDiff.removed, addedDecorations);\n    this._decorationsSetForTest(newDecorations);\n  }\n\n  /**\n   * @return {!Map<number, !GutterDecoration>}\n   */\n  _decorationsByLine() {\n    const decorations = new Map();\n    for (const decoration of this._decorations) {\n      const lineNumber = decoration.lineNumber();\n      if (lineNumber !== -1) {\n        decorations.set(lineNumber, decoration);\n      }\n    }\n    return decorations;\n  }\n\n  /**\n   * @param {!Map<number, !{lineNumber: number, type: !SourceFrame.SourceCodeDiff.EditType}>} decorations\n   */\n  _calculateDecorationsDiff(decorations) {\n    const oldDecorations = this._decorationsByLine();\n    const leftKeys = [...oldDecorations.keys()];\n    const rightKeys = [...decorations.keys()];\n    leftKeys.sort((a, b) => a - b);\n    rightKeys.sort((a, b) => a - b);\n\n    const removed = [];\n    const added = [];\n    const equal = [];\n    let leftIndex = 0;\n    let rightIndex = 0;\n    while (leftIndex < leftKeys.length && rightIndex < rightKeys.length) {\n      const leftKey = leftKeys[leftIndex];\n      const rightKey = rightKeys[rightIndex];\n      const left = oldDecorations.get(leftKey);\n      const right = decorations.get(rightKey);\n      if (!left) {\n        throw new Error(`No decoration with key ${leftKey}`);\n      }\n      if (!right) {\n        throw new Error(`No decoration with key ${rightKey}`);\n      }\n      if (leftKey === rightKey && left.type === right.type) {\n        equal.push(left);\n        ++leftIndex;\n        ++rightIndex;\n      } else if (leftKey <= rightKey) {\n        removed.push(left);\n        ++leftIndex;\n      } else {\n        added.push(right);\n        ++rightIndex;\n      }\n    }\n    while (leftIndex < leftKeys.length) {\n      const leftKey = leftKeys[leftIndex++];\n      const left = oldDecorations.get(leftKey);\n      if (!left) {\n        throw new Error(`No decoration with key ${leftKey}`);\n      }\n      removed.push(left);\n    }\n    while (rightIndex < rightKeys.length) {\n      const rightKey = rightKeys[rightIndex++];\n      const right = decorations.get(rightKey);\n      if (!right) {\n        throw new Error(`No decoration with key ${rightKey}`);\n      }\n      added.push(right);\n    }\n    return {added: added, removed: removed, equal: equal};\n  }\n\n  /**\n   * @param {!Map<number, !{lineNumber: number, type: !SourceFrame.SourceCodeDiff.EditType}>} decorations\n   */\n  _decorationsSetForTest(decorations) {\n  }\n\n  /**\n   * @override\n   * @param {!UI.ContextMenu.ContextMenu} contextMenu\n   * @param {number} lineNumber\n   * @return {!Promise<void>}\n   */\n  async populateLineGutterContextMenu(contextMenu, lineNumber) {\n    GutterDiffPlugin._appendRevealDiffContextMenu(contextMenu, this._uiSourceCode);\n  }\n\n  /**\n   * @override\n   * @param {!UI.ContextMenu.ContextMenu} contextMenu\n   * @param {number} lineNumber\n   * @param {number} columnNumber\n   * @return {!Promise<void>}\n   */\n  async populateTextAreaContextMenu(contextMenu, lineNumber, columnNumber) {\n    GutterDiffPlugin._appendRevealDiffContextMenu(contextMenu, this._uiSourceCode);\n  }\n\n  /**\n   * @param {!UI.ContextMenu.ContextMenu} contextMenu\n   * @param {!Workspace.UISourceCode.UISourceCode} uiSourceCode\n   */\n  static _appendRevealDiffContextMenu(contextMenu, uiSourceCode) {\n    if (!WorkspaceDiff.WorkspaceDiff.workspaceDiff().isUISourceCodeModified(uiSourceCode)) {\n      return;\n    }\n    contextMenu.revealSection().appendItem(ls`Local Modifications...`, () => {\n      Common.Revealer.reveal(new WorkspaceDiff.WorkspaceDiff.DiffUILocation(uiSourceCode));\n    });\n  }\n\n  /**\n   * @override\n   */\n  dispose() {\n    for (const decoration of this._decorations) {\n      decoration.remove();\n    }\n    WorkspaceDiff.WorkspaceDiff.workspaceDiff().unsubscribeFromDiffChange(this._uiSourceCode, this._update, this);\n  }\n}\n\nexport class GutterDecoration {\n  /**\n   * @param {!SourceFrame.SourcesTextEditor.SourcesTextEditor} textEditor\n   * @param {number} lineNumber\n   * @param {!SourceFrame.SourceCodeDiff.EditType} type\n   */\n  constructor(textEditor, lineNumber, type) {\n    this._textEditor = textEditor;\n    this._position = this._textEditor.textEditorPositionHandle(lineNumber, 0);\n    this._className = '';\n    if (type === SourceFrame.SourceCodeDiff.EditType.Insert) {\n      this._className = 'diff-entry-insert';\n    } else if (type === SourceFrame.SourceCodeDiff.EditType.Delete) {\n      this._className = 'diff-entry-delete';\n    } else if (type === SourceFrame.SourceCodeDiff.EditType.Modify) {\n      this._className = 'diff-entry-modify';\n    }\n    this.type = type;\n  }\n\n  /**\n   * @return {number}\n   */\n  lineNumber() {\n    const location = this._position.resolve();\n    if (!location) {\n      return -1;\n    }\n    return location.lineNumber;\n  }\n\n  install() {\n    const location = this._position.resolve();\n    if (!location) {\n      return;\n    }\n    const element = document.createElement('div');\n    element.classList.add('diff-marker');\n    element.textContent = '\\xA0';\n    this._textEditor.setGutterDecoration(location.lineNumber, DiffGutterType, element);\n    this._textEditor.toggleLineClass(location.lineNumber, this._className, true);\n  }\n\n  remove() {\n    const location = this._position.resolve();\n    if (!location) {\n      return;\n    }\n    this._textEditor.setGutterDecoration(location.lineNumber, DiffGutterType, null);\n    this._textEditor.toggleLineClass(location.lineNumber, this._className, false);\n  }\n}\n\n/** @type {string} */\nexport const DiffGutterType = 'CodeMirror-gutter-diff';\n\n/**\n * @implements {UI.ContextMenu.Provider}\n */\nexport class ContextMenuProvider {\n  /**\n   * @override\n   * @param {!Event} event\n   * @param {!UI.ContextMenu.ContextMenu} contextMenu\n   * @param {!Object} target\n   */\n  appendApplicableItems(event, contextMenu, target) {\n    let uiSourceCode = /** @type {!Workspace.UISourceCode.UISourceCode} */ (target);\n    const binding = Persistence.Persistence.PersistenceImpl.instance().binding(uiSourceCode);\n    if (binding) {\n      uiSourceCode = binding.network;\n    }\n    GutterDiffPlugin._appendRevealDiffContextMenu(contextMenu, uiSourceCode);\n  }\n}\n"]}