{"version":3,"file":"CoveragePlugin.js","sourceRoot":"","sources":["../../../../../front_end/sources/CoveragePlugin.js"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2019 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Coverage from '../coverage/coverage.js';\nimport * as Formatter from '../formatter/formatter.js';\nimport {ls} from '../platform/platform.js';\nimport * as SDK from '../sdk/sdk.js';\nimport * as SourceFrame from '../source_frame/source_frame.js';  // eslint-disable-line no-unused-vars\nimport * as UI from '../ui/ui.js';\nimport * as Workspace from '../workspace/workspace.js';  // eslint-disable-line no-unused-vars\n\nimport {Plugin} from './Plugin.js';\n\nexport class CoveragePlugin extends Plugin {\n  /**\n   * @param {!SourceFrame.SourcesTextEditor.SourcesTextEditor} textEditor\n   * @param {!Workspace.UISourceCode.UISourceCode} uiSourceCode\n   */\n  constructor(textEditor, uiSourceCode) {\n    super();\n\n    this._textEditor = textEditor;\n    this._uiSourceCode = uiSourceCode;\n\n    /** @type {!Workspace.UISourceCode.UISourceCode} */\n    this._originalSourceCode =\n        Formatter.SourceFormatter.SourceFormatter.instance().getOriginalUISourceCode(this._uiSourceCode);\n\n    this._text = new UI.Toolbar.ToolbarButton(ls`Click to show Coverage Panel`);\n    this._text.setSecondary();\n    this._text.addEventListener(UI.Toolbar.ToolbarButton.Events.Click, () => {\n      UI.ViewManager.ViewManager.instance().showView('coverage');\n    });\n\n    const mainTarget = SDK.SDKModel.TargetManager.instance().mainTarget();\n    if (mainTarget) {\n      this._model = mainTarget.model(Coverage.CoverageModel.CoverageModel);\n      if (this._model) {\n        this._model.addEventListener(Coverage.CoverageModel.Events.CoverageReset, this._handleReset, this);\n\n        this._coverage = this._model.getCoverageForUrl(this._originalSourceCode.url());\n        if (this._coverage) {\n          this._coverage.addEventListener(\n              Coverage.CoverageModel.URLCoverageInfo.Events.SizesChanged, this._handleCoverageSizesChanged, this);\n        }\n      }\n    }\n\n    this._updateStats();\n  }\n\n  /**\n   * @override\n   */\n  dispose() {\n    if (this._coverage) {\n      this._coverage.removeEventListener(\n          Coverage.CoverageModel.URLCoverageInfo.Events.SizesChanged, this._handleCoverageSizesChanged, this);\n    }\n    if (this._model) {\n      this._model.removeEventListener(Coverage.CoverageModel.Events.CoverageReset, this._handleReset, this);\n    }\n  }\n\n  /**\n   * @override\n   * @param {!Workspace.UISourceCode.UISourceCode} uiSourceCode\n   * @return {boolean}\n   */\n  static accepts(uiSourceCode) {\n    return uiSourceCode.contentType().isDocumentOrScriptOrStyleSheet();\n  }\n\n  _handleReset() {\n    this._coverage = null;\n    this._updateStats();\n  }\n\n  _handleCoverageSizesChanged() {\n    this._updateStats();\n  }\n\n  _updateStats() {\n    if (this._coverage) {\n      this._text.setTitle(ls`Show Details`);\n      this._text.setText(ls`Coverage: ${this._coverage.usedPercentage().toFixed(1)} %`);\n    } else {\n      this._text.setTitle(ls`Click to show Coverage Panel`);\n      this._text.setText(ls`Coverage: n/a`);\n    }\n  }\n\n  /**\n   * @override\n   * @return {!Promise<!Array<!UI.Toolbar.ToolbarItem>>}\n   */\n  async rightToolbarItems() {\n    return [this._text];\n  }\n}\n"]}