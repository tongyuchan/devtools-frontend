{"version":3,"file":"BinaryResourceViewFactory.js","sourceRoot":"","sources":["../../../../../front_end/source_frame/BinaryResourceViewFactory.js"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2019 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n\nimport * as Common from '../common/common.js';             // eslint-disable-line no-unused-vars\nimport * as TextUtils from '../text_utils/text_utils.js';  // eslint-disable-line no-unused-vars\nimport * as UI from '../ui/ui.js';                         // eslint-disable-line no-unused-vars\n\nimport {ResourceSourceFrame} from './ResourceSourceFrame.js';\n\nexport class BinaryResourceViewFactory {\n  /**\n   * @param {string} base64content\n   * @param {string} contentUrl\n   * @param {!Common.ResourceType.ResourceType} resourceType\n   */\n  constructor(base64content, contentUrl, resourceType) {\n    this._base64content = base64content;\n    this._contentUrl = contentUrl;\n    this._resourceType = resourceType;\n    /** @type {?Promise<!Uint8Array>} */\n    this._arrayPromise = null;\n    /** @type {?Promise<!TextUtils.ContentProvider.DeferredContent>} */\n    this._hexPromise = null;\n    /** @type {?Promise<!TextUtils.ContentProvider.DeferredContent>} */\n    this._utf8Promise = null;\n  }\n\n  async _fetchContentAsArray() {\n    if (!this._arrayPromise) {\n      this._arrayPromise = new Promise(async resolve => {\n        const fetchResponse = await fetch('data:;base64,' + this._base64content);\n        resolve(new Uint8Array(await fetchResponse.arrayBuffer()));\n      });\n    }\n    return await this._arrayPromise;\n  }\n\n  /**\n   * @return {!Promise<!TextUtils.ContentProvider.DeferredContent>}\n   */\n  async hex() {\n    if (!this._hexPromise) {\n        const content = await this._fetchContentAsArray();\n        const hexString = BinaryResourceViewFactory.uint8ArrayToHexString(content);\n        return {content: hexString, isEncoded: false};\n    }\n\n    return this._hexPromise;\n  }\n\n  /**\n   * @return {!Promise<!TextUtils.ContentProvider.DeferredContent>}\n   */\n  async base64() {\n    return {content: this._base64content, isEncoded: true};\n  }\n\n  /**\n   * @return {!Promise<!TextUtils.ContentProvider.DeferredContent>}\n   */\n  async utf8() {\n    if (!this._utf8Promise) {\n      this._utf8Promise = new Promise(async resolve => {\n        const content = await this._fetchContentAsArray();\n        const utf8String = new TextDecoder('utf8').decode(content);\n        resolve({content: utf8String, isEncoded: false});\n      });\n    }\n\n    return this._utf8Promise;\n  }\n\n  /**\n   * @return {!ResourceSourceFrame}\n   */\n  createBase64View() {\n    return new ResourceSourceFrame(\n        TextUtils.StaticContentProvider.StaticContentProvider.fromString(\n            this._contentUrl, this._resourceType, this._base64content),\n        /* autoPrettyPrint */ false, /** @type {!UI.TextEditor.Options} */ ({lineNumbers: false, lineWrapping: true}));\n  }\n\n  /**\n   * @return {!ResourceSourceFrame}\n   */\n  createHexView() {\n    const hexViewerContentProvider =\n        new TextUtils.StaticContentProvider.StaticContentProvider(this._contentUrl, this._resourceType, async () => {\n          const contentAsArray = await this._fetchContentAsArray();\n          const content = BinaryResourceViewFactory.uint8ArrayToHexViewer(contentAsArray);\n          return {content, isEncoded: false};\n        });\n    return new ResourceSourceFrame(\n        hexViewerContentProvider,\n        /* autoPrettyPrint */ false, /** @type {!UI.TextEditor.Options} */ ({lineNumbers: false, lineWrapping: false}));\n  }\n\n  /**\n   * @return {!ResourceSourceFrame}\n   */\n  createUtf8View() {\n    const utf8fn = this.utf8.bind(this);\n    const utf8ContentProvider =\n        new TextUtils.StaticContentProvider.StaticContentProvider(this._contentUrl, this._resourceType, utf8fn);\n    return new ResourceSourceFrame(\n        utf8ContentProvider,\n        /* autoPrettyPrint */ false, /** @type {!UI.TextEditor.Options} */ ({lineNumbers: true, lineWrapping: true}));\n  }\n\n  /**\n   * @param {!Uint8Array} uint8Array\n   * @return {string}\n   */\n  static uint8ArrayToHexString(uint8Array) {\n    let output = '';\n    for (let i = 0; i < uint8Array.length; i++) {\n      output += BinaryResourceViewFactory.numberToHex(uint8Array[i], 2);\n    }\n    return output;\n  }\n\n  /**\n   * @param {number} number\n   * @param {number} padding\n   * @return {string}\n   */\n  static numberToHex(number, padding) {\n    let hex = number.toString(16);\n    while (hex.length < padding) {\n      hex = '0' + hex;\n    }\n    return hex;\n  }\n\n  /**\n   * @param {!Uint8Array} array\n   * @return {string}\n   */\n  static uint8ArrayToHexViewer(array) {\n    let output = '';\n    let line = 0;\n\n    while ((line * 16) < array.length) {\n      const lineArray = array.slice(line * 16, (line + 1) * 16);\n\n      // line number\n      output += BinaryResourceViewFactory.numberToHex(line, 8) + ':';\n\n      // hex\n      let hexColsPrinted = 0;\n      for (let i = 0; i < lineArray.length; i++) {\n        if (i % 2 === 0) {\n          output += ' ';\n          hexColsPrinted++;\n        }\n        output += BinaryResourceViewFactory.numberToHex(lineArray[i], 2);\n        hexColsPrinted += 2;\n      }\n\n      // hex-ascii padding\n      while (hexColsPrinted < 42) {\n        output += ' ';\n        hexColsPrinted++;\n      }\n\n      // ascii\n      for (let i = 0; i < lineArray.length; i++) {\n        const code = lineArray[i];\n        if (code >= 32 && code <= 126) {\n          // printable ascii character\n          output += String.fromCharCode(code);\n        } else {\n          // non-printable\n          output += '.';\n        }\n      }\n\n      output += '\\n';\n      line++;\n    }\n    return output;\n  }\n}\n"]}