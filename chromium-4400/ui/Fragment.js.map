{"version":3,"file":"Fragment.js","sourceRoot":"","sources":["../../../../../front_end/ui/Fragment.js"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2017 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/**\n * @param {*} node\n * @return {string}\n */\nfunction getNodeData(node) {\n  return /** @type {{data: string}} */ (node).data;\n}\n\nexport class Fragment {\n  /**\n   * @param {!Element} element\n   */\n  constructor(element) {\n    this._element = element;\n\n    /** @type {!Map<string, !Element>} */\n    this._elementsById = new Map();\n  }\n\n  /**\n   * @return {!Element}\n   */\n  element() {\n    return this._element;\n  }\n\n  /**\n   * @param {string} elementId\n   * @return {!Element}\n   */\n  $(elementId) {\n    return /** @type {!Element} */ (this._elementsById.get(elementId));\n  }\n\n  /**\n   * @param {!TemplateDefinition} strings\n   * @param {...*} values\n   * @return {!Fragment}\n   */\n  static build(strings, ...values) {\n    return Fragment._render(Fragment._template(strings), values);\n  }\n\n  /**\n   * @param {!TemplateDefinition} strings\n   * @param {...*} values\n   * @return {!Fragment}\n   */\n  static cached(strings, ...values) {\n    let template = _templateCache.get(strings);\n    if (!template) {\n      template = Fragment._template(strings);\n      _templateCache.set(strings, template);\n    }\n    return Fragment._render(template, values);\n  }\n\n  /**\n   * @param {!TemplateDefinition} strings\n   * @return {!_Template}\n   */\n  static _template(strings) {\n    let html = '';\n    let insideText = true;\n    for (let i = 0; i < strings.length - 1; i++) {\n      html += strings[i];\n      const close = strings[i].lastIndexOf('>');\n      const open = strings[i].indexOf('<', close + 1);\n      if (close !== -1 && open === -1) {\n        insideText = true;\n      } else if (open !== -1) {\n        insideText = false;\n      }\n      html += insideText ? _textMarker : _attributeMarker(i);\n    }\n    html += strings[strings.length - 1];\n\n    const template = /** @type {!HTMLTemplateElement} */ (document.createElement('template'));\n    template.innerHTML = html;\n    const walker = template.ownerDocument.createTreeWalker(\n        template.content, NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_TEXT, null, false);\n    let valueIndex = 0;\n    const emptyTextNodes = [];\n    /** @type {!Array<!_Bind>} */\n    const binds = [];\n    const nodesToMark = [];\n    while (walker.nextNode()) {\n      const node = /** @type {!HTMLElement} */ (walker.currentNode);\n      if (node.nodeType === Node.ELEMENT_NODE && node.hasAttributes()) {\n        if (node.hasAttribute('$')) {\n          nodesToMark.push(node);\n          binds.push({replaceNodeIndex: undefined, attr: undefined, elementId: node.getAttribute('$') || ''});\n          node.removeAttribute('$');\n        }\n\n        const attributesToRemove = [];\n        for (let i = 0; i < node.attributes.length; i++) {\n          const name = node.attributes[i].name;\n\n          if (!_attributeMarkerRegex.test(name) && !_attributeMarkerRegex.test(node.attributes[i].value)) {\n            continue;\n          }\n\n          attributesToRemove.push(name);\n          nodesToMark.push(node);\n\n          const attr = {\n            index: valueIndex,\n            names: name.split(_attributeMarkerRegex),\n            values: node.attributes[i].value.split(_attributeMarkerRegex)\n          };\n          valueIndex += attr.names.length - 1;\n          valueIndex += attr.values.length - 1;\n          /** @type {!_Bind} */\n          const bind = {\n            elementId: undefined,\n            replaceNodeIndex: undefined,\n            attr,\n          };\n          binds.push(bind);\n        }\n        for (let i = 0; i < attributesToRemove.length; i++) {\n          node.removeAttribute(attributesToRemove[i]);\n        }\n      }\n\n      if (node.nodeType === Node.TEXT_NODE && getNodeData(node).indexOf(_textMarker) !== -1) {\n        const texts = getNodeData(node).split(_textMarkerRegex);\n        /** @type {*} */ (node).data = texts[texts.length - 1];\n        const parentNode = /** @type {!HTMLElement} */ (node.parentNode);\n        for (let i = 0; i < texts.length - 1; i++) {\n          if (texts[i]) {\n            parentNode.insertBefore(document.createTextNode(texts[i]), node);\n          }\n          const nodeToReplace = document.createElement('span');\n          nodesToMark.push(nodeToReplace);\n          binds.push({attr: undefined, elementId: undefined, replaceNodeIndex: valueIndex++});\n          parentNode.insertBefore(nodeToReplace, node);\n        }\n      }\n\n      if (node.nodeType === Node.TEXT_NODE &&\n          (!node.previousSibling || node.previousSibling.nodeType === Node.ELEMENT_NODE) &&\n          (!node.nextSibling || node.nextSibling.nodeType === Node.ELEMENT_NODE) && /^\\s*$/.test(getNodeData(node))) {\n        emptyTextNodes.push(node);\n      }\n    }\n\n    for (let i = 0; i < nodesToMark.length; i++) {\n      nodesToMark[i].classList.add(_class(i));\n    }\n\n    for (const emptyTextNode of emptyTextNodes) {\n      emptyTextNode.remove();\n    }\n    return {template, binds};\n  }\n\n  /**\n   * @param {!_Template} template\n   * @param {!Array<*>} values\n   * @return {!Fragment}\n   */\n  static _render(template, values) {\n    const content = template.template.ownerDocument.importNode(template.template.content, true);\n    const resultElement =\n        /** @type {!Element} */ (content.firstChild === content.lastChild ? content.firstChild : content);\n    const result = new Fragment(resultElement);\n\n    const boundElements = [];\n    for (let i = 0; i < template.binds.length; i++) {\n      const className = _class(i);\n      const element = /** @type {!Element} */ (content.querySelector('.' + className));\n      element.classList.remove(className);\n      boundElements.push(element);\n    }\n\n    for (let bindIndex = 0; bindIndex < template.binds.length; bindIndex++) {\n      const bind = template.binds[bindIndex];\n      const element = boundElements[bindIndex];\n      if (bind.elementId !== undefined) {\n        result._elementsById.set(bind.elementId, element);\n      } else if (bind.replaceNodeIndex !== undefined) {\n        const value = values[bind.replaceNodeIndex];\n        /** @type {!HTMLElement} */ (element.parentNode).replaceChild(this._nodeForValue(value), element);\n      } else if (bind.attr !== undefined) {\n        if (bind.attr.names.length === 2 && bind.attr.values.length === 1 &&\n            typeof values[bind.attr.index] === 'function') {\n          values[bind.attr.index].call(null, element);\n        } else {\n          let name = bind.attr.names[0];\n          for (let i = 1; i < bind.attr.names.length; i++) {\n            name += values[bind.attr.index + i - 1];\n            name += bind.attr.names[i];\n          }\n          if (name) {\n            let value = bind.attr.values[0];\n            for (let i = 1; i < bind.attr.values.length; i++) {\n              value += values[bind.attr.index + bind.attr.names.length - 1 + i - 1];\n              value += bind.attr.values[i];\n            }\n            element.setAttribute(name, value);\n          }\n        }\n      } else {\n        throw new Error('Unexpected bind');\n      }\n    }\n    return result;\n  }\n\n  /**\n   * @param {*} value\n   * @return {!Node}\n   */\n  static _nodeForValue(value) {\n    if (value instanceof Node) {\n      return value;\n    }\n    if (value instanceof Fragment) {\n      return value._element;\n    }\n    if (Array.isArray(value)) {\n      const node = document.createDocumentFragment();\n      for (const v of value) {\n        node.appendChild(this._nodeForValue(v));\n      }\n      return node;\n    }\n    return document.createTextNode(String(value));\n  }\n}\n\nexport const _textMarker = '{{template-text}}';\nconst _textMarkerRegex = /{{template-text}}/;\nexport const _attributeMarker = /** @param {number} index */ index => 'template-attribute' + index;\nconst _attributeMarkerRegex = /template-attribute\\d+/;\nconst _class = /** @param {number} index */ index => 'template-class-' + index;\nconst _templateCache = new Map();\n\n/**\n * @param {!TemplateDefinition} strings\n * @param {...*} vararg\n * @return {!Element}\n */\nexport const html = (strings, ...vararg) => {\n  return Fragment.cached(strings, ...vararg).element();\n};\n\n/** @typedef {(!Array<string>|!TemplateStringsArray)} */\n// @ts-ignore typedef\nexport let TemplateDefinition;\n\n/**\n  * @typedef {!{\n  *   elementId: (string|undefined),\n  *   attr: (!{\n  *     index: number,\n  *     names: !Array<string>,\n  *     values: !Array<string>\n  *   }|undefined),\n  *   replaceNodeIndex: (number|undefined)\n  * }}\n  */\n// @ts-ignore typedef\nexport let _Bind;\n\n/**\n * @typedef {!{\n  *   template: !HTMLTemplateElement,\n  *   binds: !Array<!_Bind>\n  * }}\n  */\n// @ts-ignore typedef\nexport let _Template;\n"]}