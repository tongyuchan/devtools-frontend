{"version":3,"file":"Dialog.js","sourceRoot":"","sources":["../../../../../front_end/ui/Dialog.js"],"names":[],"mappings":"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","sourcesContent":["/*\n * Copyright (C) 2012 Google Inc. All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are\n * met:\n *\n *     * Redistributions of source code must retain the above copyright\n * notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above\n * copyright notice, this list of conditions and the following disclaimer\n * in the documentation and/or other materials provided with the\n * distribution.\n *     * Neither the name of Google Inc. nor the names of its\n * contributors may be used to endorse or promote products derived from\n * this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport * as ARIAUtils from './ARIAUtils.js';\nimport {GlassPane, PointerEventsBehavior} from './GlassPane.js';\nimport {InspectorView} from './InspectorView.js';\nimport {KeyboardShortcut, Keys} from './KeyboardShortcut.js';\nimport {SplitWidget} from './SplitWidget.js';      // eslint-disable-line no-unused-vars\nimport {DevToolsCloseButton} from './UIUtils.js';  // eslint-disable-line no-unused-vars\nimport {WidgetFocusRestorer} from './Widget.js';\n\nexport class Dialog extends GlassPane {\n  constructor() {\n    super();\n    this.registerRequiredCSS('ui/dialog.css', {enableLegacyPatching: false});\n    this.contentElement.tabIndex = 0;\n    this.contentElement.addEventListener('focus', () => this.widget().focus(), false);\n    this.widget().setDefaultFocusedElement(this.contentElement);\n    this.setPointerEventsBehavior(PointerEventsBehavior.BlockedByGlassPane);\n    this.setOutsideClickCallback(event => {\n      this.hide();\n      event.consume(true);\n    });\n    ARIAUtils.markAsModalDialog(this.contentElement);\n    /** @type {!OutsideTabIndexBehavior} */\n    this._tabIndexBehavior = OutsideTabIndexBehavior.DisableAllOutsideTabIndex;\n    /** @type {!Map<!HTMLElement, number>} */\n    this._tabIndexMap = new Map();\n    /** @type {?WidgetFocusRestorer} */\n    this._focusRestorer = null;\n    this._closeOnEscape = true;\n    /** @type {?Document} */\n    this._targetDocument;\n    this._targetDocumentKeyDownHandler = this._onKeyDown.bind(this);\n    /** @type {?function(!Event):void} */\n    this._escapeKeyCallback = null;\n  }\n\n  /**\n   * @return {boolean}\n   */\n  static hasInstance() {\n    return Boolean(Dialog._instance);\n  }\n\n  /**\n   * @override\n   * @param {(!Document|!Element)=} where\n   */\n  show(where) {\n    const document = /** @type {!Document} */ (\n        where instanceof Document ? where : (where || InspectorView.instance().element).ownerDocument);\n    this._targetDocument = document;\n    this._targetDocument.addEventListener('keydown', this._targetDocumentKeyDownHandler, true);\n\n    if (Dialog._instance) {\n      Dialog._instance.hide();\n    }\n    Dialog._instance = this;\n    this._disableTabIndexOnElements(document);\n    super.show(document);\n    this._focusRestorer = new WidgetFocusRestorer(this.widget());\n  }\n\n  /**\n   * @override\n   */\n  hide() {\n    if (this._focusRestorer) {\n      this._focusRestorer.restore();\n    }\n    super.hide();\n\n    if (this._targetDocument) {\n      this._targetDocument.removeEventListener('keydown', this._targetDocumentKeyDownHandler, true);\n    }\n    this._restoreTabIndexOnElements();\n    this.dispatchEventToListeners('hidden');\n    Dialog._instance = null;\n  }\n\n  /**\n   * @param {boolean} close\n   */\n  setCloseOnEscape(close) {\n    this._closeOnEscape = close;\n  }\n\n  /**\n   * @param {function(!Event):void} callback\n   */\n  setEscapeKeyCallback(callback) {\n    this._escapeKeyCallback = callback;\n  }\n\n  addCloseButton() {\n    const closeButton = /** @type {!DevToolsCloseButton} */ (\n        this.contentElement.createChild('div', 'dialog-close-button', 'dt-close-button'));\n    closeButton.gray = true;\n    closeButton.addEventListener('click', () => this.hide(), false);\n  }\n\n  /**\n   * @param {!OutsideTabIndexBehavior} tabIndexBehavior\n   */\n  setOutsideTabIndexBehavior(tabIndexBehavior) {\n    this._tabIndexBehavior = tabIndexBehavior;\n  }\n\n  /**\n   * @param {!Document} document\n   */\n  _disableTabIndexOnElements(document) {\n    if (this._tabIndexBehavior === OutsideTabIndexBehavior.PreserveTabIndex) {\n      return;\n    }\n\n    let exclusionSet = /** @type {?Set.<!HTMLElement>} */ (null);\n    if (this._tabIndexBehavior === OutsideTabIndexBehavior.PreserveMainViewTabIndex) {\n      exclusionSet = this._getMainWidgetTabIndexElements(InspectorView.instance().ownerSplit());\n    }\n\n    this._tabIndexMap.clear();\n    /** @type {?Node} */\n    let node = document;\n    for (; node; node = node.traverseNextNode(document)) {\n      if (node instanceof HTMLElement) {\n        const element = /** @type {!HTMLElement} */ (node);\n        const tabIndex = element.tabIndex;\n        if (tabIndex >= 0 && (!exclusionSet || !exclusionSet.has(element))) {\n          this._tabIndexMap.set(element, tabIndex);\n          element.tabIndex = -1;\n        }\n      }\n    }\n  }\n\n  /**\n   * @param {?SplitWidget} splitWidget\n   * @return {!Set.<!HTMLElement>}\n   */\n  _getMainWidgetTabIndexElements(splitWidget) {\n    const elementSet = /** @type {!Set.<!HTMLElement>} */ (new Set());\n    if (!splitWidget) {\n      return elementSet;\n    }\n\n    const mainWidget = splitWidget.mainWidget();\n    if (!mainWidget || !mainWidget.element) {\n      return elementSet;\n    }\n\n    /** @type {?Node} */\n    let node = mainWidget.element;\n    for (; node; node = node.traverseNextNode(mainWidget.element)) {\n      if (!(node instanceof HTMLElement)) {\n        continue;\n      }\n\n      const element = /** @type {!HTMLElement} */ (node);\n      const tabIndex = element.tabIndex;\n      if (tabIndex < 0) {\n        continue;\n      }\n\n      elementSet.add(element);\n    }\n\n    return elementSet;\n  }\n\n  _restoreTabIndexOnElements() {\n    for (const element of this._tabIndexMap.keys()) {\n      element.tabIndex = /** @type {number} */ (this._tabIndexMap.get(element));\n    }\n    this._tabIndexMap.clear();\n  }\n\n  /**\n   * @param {!Event} event\n   */\n  _onKeyDown(event) {\n    const keyboardEvent = /** @type {!KeyboardEvent} */ (event);\n    if (keyboardEvent.keyCode === Keys.Esc.code && KeyboardShortcut.hasNoModifiers(event)) {\n      if (this._escapeKeyCallback) {\n        this._escapeKeyCallback(event);\n      }\n\n      if (event.handled) {\n        return;\n      }\n\n      if (this._closeOnEscape) {\n        event.consume(true);\n        this.hide();\n      }\n    }\n  }\n}\n\n/** @type {?Dialog} */\nDialog._instance = null;\n\n/** @enum {symbol} */\nexport const OutsideTabIndexBehavior = {\n  DisableAllOutsideTabIndex: Symbol('DisableAllTabIndex'),\n  PreserveMainViewTabIndex: Symbol('PreserveMainViewTabIndex'),\n  PreserveTabIndex: Symbol('PreserveTabIndex')\n};\n"]}