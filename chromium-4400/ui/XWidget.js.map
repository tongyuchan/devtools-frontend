{"version":3,"file":"XWidget.js","sourceRoot":"","sources":["../../../../../front_end/ui/XWidget.js"],"names":[],"mappings":"AAAA,4DAA4D;AAC5D,yEAAyE;AACzE,6BAA6B;AAE7B,OAAO,EAAC,WAAW,EAAC,MAAM,yBAAyB,CAAC;AACpD,OAAO,EAAC,QAAQ,EAAC,MAAM,eAAe,CAAC;AAEvC,8BAA8B;AAC9B,IAAI,SAAS,GAAG,IAAI,CAAC;AAErB,2EAA2E;AAC3E,MAAM,sBAAsB,GAAG,IAAI,OAAO,EAAE,CAAC;AAE7C;;GAEG;AACH,MAAM,OAAO,OAAQ,SAAQ,QAAQ;IACnC;QACE,KAAK,EAAE,CAAC;QACR,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC;QAC1C,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,gBAAgB,EAAE,QAAQ,CAAC,CAAC;QACnD,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,aAAa,EAAE,SAAS,CAAC,CAAC;QACjD,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,iBAAiB,EAAE,YAAY,CAAC,CAAC;QACxD,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,SAAS,EAAE,cAAc,CAAC,CAAC;QAElD,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;QACtB,gCAAgC;QAChC,IAAI,CAAC,WAAW,CAAC;QACjB,uBAAuB;QACvB,IAAI,CAAC,sBAAsB,GAAG,IAAI,CAAC;QACnC,+BAA+B;QAC/B,IAAI,CAAC,oCAAoC,GAAG,EAAE,CAAC;QAC/C,+BAA+B;QAC/B,IAAI,CAAC,gBAAgB,CAAC;QACtB,+BAA+B;QAC/B,IAAI,CAAC,iBAAiB,CAAC;QACvB,+BAA+B;QAC/B,IAAI,CAAC,kBAAkB,CAAC;QAExB,IAAI,CAAC,SAAS,EAAE;YACd,SAAS,GAAG,IAAI,cAAc,CAAC,OAAO,CAAC,EAAE;gBACvC,KAAK,MAAM,KAAK,IAAI,OAAO,EAAE;oBAC3B,MAAM,MAAM,GAAG,uBAAuB,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;oBACtD,IAAI,MAAM,CAAC,QAAQ,IAAI,MAAM,CAAC,kBAAkB,EAAE;wBAChD,MAAM,CAAC,kBAAkB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;qBACtC;iBACF;YACH,CAAC,CAAC,CAAC;SACJ;QAED,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;QAExB,IAAI,CAAC,sCAAsC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;IACtD,CAAC;IAED;;OAEG;IACH,SAAS;QACP,OAAO,IAAI,CAAC,QAAQ,CAAC;IACvB,CAAC;IAED;;;OAGG;IACH,mBAAmB,CAAC,OAAO,EAAE,OAAO;QAClC,WAAW,CAAC,IAAI,CAAC,WAAW,IAAI,IAAI,EAAE,OAAO,EAAE,OAAO,CAAC,CAAC;IAC1D,CAAC;IAED;;OAEG;IACH,UAAU,CAAC,QAAQ;QACjB,IAAI,CAAC,gBAAgB,GAAG,QAAQ,CAAC;IACnC,CAAC;IAED;;OAEG;IACH,WAAW,CAAC,QAAQ;QAClB,IAAI,CAAC,iBAAiB,GAAG,QAAQ,CAAC;IACpC,CAAC;IAED;;OAEG;IACH,YAAY,CAAC,QAAQ;QACnB,IAAI,CAAC,kBAAkB,GAAG,QAAQ,CAAC;IACrC,CAAC;IAED;;OAEG;IACH,sCAAsC,CAAC,QAAQ;QAC7C,KAAK,MAAM,OAAO,IAAI,IAAI,CAAC,oCAAoC,EAAE;YAC/D,OAAO,CAAC,mBAAmB,CAAC,QAAQ,EAAE,OAAO,CAAC,oBAAoB,EAAE,EAAC,OAAO,EAAE,KAAK,EAAC,CAAC,CAAC;SACvF;QACD,IAAI,CAAC,oCAAoC,GAAG,QAAQ,CAAC;QACrD,KAAK,MAAM,OAAO,IAAI,IAAI,CAAC,oCAAoC,EAAE;YAC/D,OAAO,CAAC,gBAAgB,CAAC,QAAQ,EAAE,OAAO,CAAC,oBAAoB,EAAE,EAAC,OAAO,EAAE,IAAI,EAAE,OAAO,EAAE,KAAK,EAAC,CAAC,CAAC;SACnG;IACH,CAAC;IAED,sBAAsB;QACpB,KAAK,MAAM,OAAO,IAAI,IAAI,CAAC,oCAAoC,EAAE;YAC/D,MAAM,eAAe,GAAG,sBAAsB,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;YAC5D,IAAI,eAAe,EAAE;gBACnB,OAAO,CAAC,SAAS,GAAG,eAAe,CAAC,SAAS,CAAC;gBAC9C,OAAO,CAAC,UAAU,GAAG,eAAe,CAAC,UAAU,CAAC;aACjD;SACF;IACH,CAAC;IAED;;OAEG;IACH,MAAM,CAAC,oBAAoB,CAAC,KAAK;QAC/B,MAAM,OAAO,GAAG,uBAAuB,CAAC,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC;QAC9D,sBAAsB,CAAC,GAAG,CAAC,OAAO,EAAE,EAAC,UAAU,EAAE,OAAO,CAAC,UAAU,EAAE,SAAS,EAAE,OAAO,CAAC,SAAS,EAAC,CAAC,CAAC;IACtG,CAAC;IAED;;OAEG;IACH,wBAAwB,CAAC,OAAO;QAC9B,IAAI,OAAO,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC,EAAE;YAC9C,MAAM,IAAI,KAAK,CAAC,kCAAkC,CAAC,CAAC;SACrD;QACD,IAAI,CAAC,sBAAsB,GAAG,OAAO,CAAC;IACxC,CAAC;IAED;;OAEG;IACH,KAAK;QACH,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;YAClB,OAAO;SACR;QAED,IAAI,OAAO,CAAC;QACZ,IAAI,IAAI,CAAC,sBAAsB,IAAI,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,sBAAsB,CAAC,EAAE;YACrF,OAAO,GAAG,IAAI,CAAC,sBAAsB,CAAC;SACvC;aAAM,IAAI,IAAI,CAAC,QAAQ,KAAK,CAAC,CAAC,EAAE;YAC/B,OAAO,GAAG,IAAI,CAAC;SAChB;aAAM;YACL,IAAI,KAAK,GAAG,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;YACxC,OAAO,KAAK,EAAE;gBACZ,IAAI,CAAC,KAAK,YAAY,OAAO,CAAC,IAAI,KAAK,CAAC,QAAQ,EAAE;oBAChD,OAAO,GAAG,KAAK,CAAC;oBAChB,MAAM;iBACP;gBACD,KAAK,GAAG,KAAK,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;aACtC;SACF;QAED,IAAI,CAAC,OAAO,IAAI,OAAO,CAAC,QAAQ,EAAE,EAAE;YAClC,OAAO;SACR;QACD,IAAI,OAAO,KAAK,IAAI,EAAE;YACpB,WAAW,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;SACxC;aAAM;YACL,2BAA2B,CAAC,CAAC,OAAO,CAAC,CAAC,KAAK,EAAE,CAAC;SAC/C;IACH,CAAC;IAED;;OAEG;IACH,iBAAiB;QACf,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;QACrB,IAAI,CAAC,sBAAsB,EAAE,CAAC;QAC9B,IAAI,IAAI,CAAC,gBAAgB,EAAE;YACzB,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;SAClC;IACH,CAAC;IAED;;OAEG;IACH,oBAAoB;QAClB,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;QACtB,IAAI,IAAI,CAAC,iBAAiB,EAAE;YAC1B,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;SACnC;IACH,CAAC;CACF;AAED,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,UAAU,EAAE,OAAO,CAAC,CAAC","sourcesContent":["// Copyright 2017 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport {appendStyle} from './utils/append-style.js';\nimport {XElement} from './XElement.js';\n\n/** @type {?ResizeObserver} */\nlet _observer = null;\n\n/** @type {!WeakMap<!Element, !{scrollLeft: number, scrollTop: number}>} */\nconst _storedScrollPositions = new WeakMap();\n\n/**\n * @extends {XElement}\n */\nexport class XWidget extends XElement {\n  constructor() {\n    super();\n    this.style.setProperty('display', 'flex');\n    this.style.setProperty('flex-direction', 'column');\n    this.style.setProperty('align-items', 'stretch');\n    this.style.setProperty('justify-content', 'flex-start');\n    this.style.setProperty('contain', 'layout style');\n\n    this._visible = false;\n    /** @type {?DocumentFragment} */\n    this._shadowRoot;\n    /** @type {?Element} */\n    this._defaultFocusedElement = null;\n    /** @type {!Array<!Element>} */\n    this._elementsToRestoreScrollPositionsFor = [];\n    /** @type {?function():void} */\n    this._onShownCallback;\n    /** @type {?function():void} */\n    this._onHiddenCallback;\n    /** @type {?function():void} */\n    this._onResizedCallback;\n\n    if (!_observer) {\n      _observer = new ResizeObserver(entries => {\n        for (const entry of entries) {\n          const widget = /** @type {!XWidget} */ (entry.target);\n          if (widget._visible && widget._onResizedCallback) {\n            widget._onResizedCallback.call(null);\n          }\n        }\n      });\n    }\n\n    _observer.observe(this);\n\n    this.setElementsToRestoreScrollPositionsFor([this]);\n  }\n\n  /**\n   * @return {boolean}\n   */\n  isShowing() {\n    return this._visible;\n  }\n\n  /**\n   * @param {string} cssFile\n   * @param {!{enableLegacyPatching:boolean}} options\n   */\n  registerRequiredCSS(cssFile, options) {\n    appendStyle(this._shadowRoot || this, cssFile, options);\n  }\n\n  /**\n   * @param {?function():void} callback\n   */\n  setOnShown(callback) {\n    this._onShownCallback = callback;\n  }\n\n  /**\n   * @param {?function():void} callback\n   */\n  setOnHidden(callback) {\n    this._onHiddenCallback = callback;\n  }\n\n  /**\n   * @param {?function():void} callback\n   */\n  setOnResized(callback) {\n    this._onResizedCallback = callback;\n  }\n\n  /**\n   * @param {!Array<!Element>} elements\n   */\n  setElementsToRestoreScrollPositionsFor(elements) {\n    for (const element of this._elementsToRestoreScrollPositionsFor) {\n      element.removeEventListener('scroll', XWidget._storeScrollPosition, {capture: false});\n    }\n    this._elementsToRestoreScrollPositionsFor = elements;\n    for (const element of this._elementsToRestoreScrollPositionsFor) {\n      element.addEventListener('scroll', XWidget._storeScrollPosition, {passive: true, capture: false});\n    }\n  }\n\n  restoreScrollPositions() {\n    for (const element of this._elementsToRestoreScrollPositionsFor) {\n      const storedPositions = _storedScrollPositions.get(element);\n      if (storedPositions) {\n        element.scrollTop = storedPositions.scrollTop;\n        element.scrollLeft = storedPositions.scrollLeft;\n      }\n    }\n  }\n\n  /**\n   * @param {!Event} event\n   */\n  static _storeScrollPosition(event) {\n    const element = /** @type {!Element} */ (event.currentTarget);\n    _storedScrollPositions.set(element, {scrollLeft: element.scrollLeft, scrollTop: element.scrollTop});\n  }\n\n  /**\n   * @param {?Element} element\n   */\n  setDefaultFocusedElement(element) {\n    if (element && !this.isSelfOrAncestor(element)) {\n      throw new Error('Default focus must be descendant');\n    }\n    this._defaultFocusedElement = element;\n  }\n\n  /**\n   * @override\n   */\n  focus() {\n    if (!this._visible) {\n      return;\n    }\n\n    let element;\n    if (this._defaultFocusedElement && this.isSelfOrAncestor(this._defaultFocusedElement)) {\n      element = this._defaultFocusedElement;\n    } else if (this.tabIndex !== -1) {\n      element = this;\n    } else {\n      let child = this.traverseNextNode(this);\n      while (child) {\n        if ((child instanceof XWidget) && child._visible) {\n          element = child;\n          break;\n        }\n        child = child.traverseNextNode(this);\n      }\n    }\n\n    if (!element || element.hasFocus()) {\n      return;\n    }\n    if (element === this) {\n      HTMLElement.prototype.focus.call(this);\n    } else {\n      /** @type {!HTMLElement} */ (element).focus();\n    }\n  }\n\n  /**\n   * @override\n   */\n  connectedCallback() {\n    this._visible = true;\n    this.restoreScrollPositions();\n    if (this._onShownCallback) {\n      this._onShownCallback.call(null);\n    }\n  }\n\n  /**\n   * @override\n   */\n  disconnectedCallback() {\n    this._visible = false;\n    if (this._onHiddenCallback) {\n      this._onHiddenCallback.call(null);\n    }\n  }\n}\n\nself.customElements.define('x-widget', XWidget);\n"]}