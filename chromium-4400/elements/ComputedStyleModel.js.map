{"version":3,"file":"ComputedStyleModel.js","sourceRoot":"","sources":["../../../../../front_end/elements/ComputedStyleModel.js"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) 2015 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../common/common.js';\nimport * as SDK from '../sdk/sdk.js';\nimport * as UI from '../ui/ui.js';\n\nexport class ComputedStyleModel extends Common.ObjectWrapper.ObjectWrapper {\n  constructor() {\n    super();\n    this._node = UI.Context.Context.instance().flavor(SDK.DOMModel.DOMNode);\n    /** @type {?SDK.CSSModel.CSSModel} */\n    this._cssModel = null;\n    /** @type {!Array<!Common.EventTarget.EventDescriptor>} */\n    this._eventListeners = [];\n    UI.Context.Context.instance().addFlavorChangeListener(SDK.DOMModel.DOMNode, this._onNodeChanged, this);\n  }\n\n  /**\n   * @return {?SDK.DOMModel.DOMNode}\n   */\n  node() {\n    return this._node;\n  }\n\n  /**\n   * @return {?SDK.CSSModel.CSSModel}\n   */\n  cssModel() {\n    return this._cssModel && this._cssModel.isEnabled() ? this._cssModel : null;\n  }\n\n  /**\n   * @param {!Common.EventTarget.EventTargetEvent} event\n   */\n  _onNodeChanged(event) {\n    this._node = /** @type {?SDK.DOMModel.DOMNode} */ (event.data);\n    this._updateModel(this._node ? this._node.domModel().cssModel() : null);\n    this._onComputedStyleChanged(null);\n  }\n\n  /**\n   * @param {?SDK.CSSModel.CSSModel} cssModel\n   */\n  _updateModel(cssModel) {\n    if (this._cssModel === cssModel) {\n      return;\n    }\n    Common.EventTarget.EventTarget.removeEventListeners(this._eventListeners);\n    this._cssModel = cssModel;\n    const domModel = cssModel ? cssModel.domModel() : null;\n    const resourceTreeModel = cssModel ? cssModel.target().model(SDK.ResourceTreeModel.ResourceTreeModel) : null;\n    if (cssModel && domModel && resourceTreeModel) {\n      this._eventListeners = [\n        cssModel.addEventListener(SDK.CSSModel.Events.StyleSheetAdded, this._onComputedStyleChanged, this),\n        cssModel.addEventListener(SDK.CSSModel.Events.StyleSheetRemoved, this._onComputedStyleChanged, this),\n        cssModel.addEventListener(SDK.CSSModel.Events.StyleSheetChanged, this._onComputedStyleChanged, this),\n        cssModel.addEventListener(SDK.CSSModel.Events.FontsUpdated, this._onComputedStyleChanged, this),\n        cssModel.addEventListener(SDK.CSSModel.Events.MediaQueryResultChanged, this._onComputedStyleChanged, this),\n        cssModel.addEventListener(SDK.CSSModel.Events.PseudoStateForced, this._onComputedStyleChanged, this),\n        cssModel.addEventListener(SDK.CSSModel.Events.ModelWasEnabled, this._onComputedStyleChanged, this),\n        domModel.addEventListener(SDK.DOMModel.Events.DOMMutated, this._onDOMModelChanged, this),\n        resourceTreeModel.addEventListener(SDK.ResourceTreeModel.Events.FrameResized, this._onFrameResized, this),\n      ];\n    }\n  }\n\n  /**\n   * @param {?Common.EventTarget.EventTargetEvent} event\n   */\n  _onComputedStyleChanged(event) {\n    delete this._computedStylePromise;\n    this.dispatchEventToListeners(Events.ComputedStyleChanged, event ? event.data : null);\n  }\n\n  /**\n   * @param {!Common.EventTarget.EventTargetEvent} event\n   */\n  _onDOMModelChanged(event) {\n    // Any attribute removal or modification can affect the styles of \"related\" nodes.\n    const node = /** @type {!SDK.DOMModel.DOMNode} */ (event.data);\n    if (!this._node ||\n        this._node !== node && node.parentNode !== this._node.parentNode && !node.isAncestor(this._node)) {\n      return;\n    }\n    this._onComputedStyleChanged(null);\n  }\n\n  /**\n   * @param {!Common.EventTarget.EventTargetEvent} event\n   */\n  _onFrameResized(event) {\n    /**\n     * @this {ComputedStyleModel}\n     */\n    function refreshContents() {\n      this._onComputedStyleChanged(null);\n      delete this._frameResizedTimer;\n    }\n\n    if (this._frameResizedTimer) {\n      clearTimeout(this._frameResizedTimer);\n    }\n\n    this._frameResizedTimer = setTimeout(refreshContents.bind(this), 100);\n  }\n\n  /**\n   * @return {?SDK.DOMModel.DOMNode}\n   */\n  _elementNode() {\n    const node = this.node();\n    if (!node) {\n      return null;\n    }\n    return node.enclosingElementOrSelf();\n  }\n\n  /**\n   * @return {!Promise.<?ComputedStyle>}\n   */\n  async fetchComputedStyle() {\n    const elementNode = this._elementNode();\n    const cssModel = this.cssModel();\n    if (!elementNode || !cssModel) {\n      return /** @type {?ComputedStyle} */ (null);\n    }\n    const nodeId = elementNode.id;\n    if (!nodeId) {\n      return /** @type {?ComputedStyle} */ (null);\n    }\n\n    if (!this._computedStylePromise) {\n      this._computedStylePromise = cssModel.computedStylePromise(nodeId).then(verifyOutdated.bind(this, elementNode));\n    }\n\n    return this._computedStylePromise;\n\n    /**\n     * @param {!SDK.DOMModel.DOMNode} elementNode\n     * @param {?Map.<string, string>} style\n     * @return {?ComputedStyle}\n     * @this {ComputedStyleModel}\n     */\n    function verifyOutdated(elementNode, style) {\n      return elementNode === this._elementNode() && style ? new ComputedStyle(elementNode, style) :\n                                                            /** @type {?ComputedStyle} */ (null);\n    }\n  }\n}\n\n/** @enum {symbol} */\nexport const Events = {\n  ComputedStyleChanged: Symbol('ComputedStyleChanged')\n};\n\nexport class ComputedStyle {\n  /**\n   * @param {!SDK.DOMModel.DOMNode} node\n   * @param {!Map.<string, string>} computedStyle\n   */\n  constructor(node, computedStyle) {\n    this.node = node;\n    this.computedStyle = computedStyle;\n  }\n}\n"]}