{"version":3,"file":"EventSourceMessagesView.js","sourceRoot":"","sources":["../../../../../front_end/network/EventSourceMessagesView.js"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2014 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../common/common.js';\nimport * as DataGrid from '../data_grid/data_grid.js';\nimport * as Host from '../host/host.js';\nimport {ls} from '../platform/platform.js';\nimport * as SDK from '../sdk/sdk.js';\nimport * as UI from '../ui/ui.js';\n\nexport class EventSourceMessagesView extends UI.Widget.VBox {\n  /**\n   * @param {!SDK.NetworkRequest.NetworkRequest} request\n   */\n  constructor(request) {\n    super();\n    this.registerRequiredCSS('network/eventSourceMessagesView.css', {enableLegacyPatching: false});\n    this.element.classList.add('event-source-messages-view');\n    this._request = request;\n\n    const columns = /** @type {!Array<!DataGrid.DataGrid.ColumnDescriptor>} */ ([\n      {id: 'id', title: Common.UIString.UIString('Id'), sortable: true, weight: 8},\n      {id: 'type', title: Common.UIString.UIString('Type'), sortable: true, weight: 8},\n      {id: 'data', title: Common.UIString.UIString('Data'), sortable: false, weight: 88},\n      {id: 'time', title: Common.UIString.UIString('Time'), sortable: true, weight: 8}\n    ]);\n\n    this._dataGrid = new DataGrid.SortableDataGrid.SortableDataGrid({\n      displayName: ls`Event Source`,\n      columns,\n      editCallback: undefined,\n      deleteCallback: undefined,\n      refreshCallback: undefined\n    });\n    this._dataGrid.setStriped(true);\n    this._dataGrid.setStickToBottom(true);\n    this._dataGrid.setRowContextMenuCallback(this._onRowContextMenu.bind(this));\n    this._dataGrid.markColumnAsSortedBy('time', DataGrid.DataGrid.Order.Ascending);\n    this._sortItems();\n    this._dataGrid.addEventListener(DataGrid.DataGrid.Events.SortingChanged, this._sortItems, this);\n\n    this._dataGrid.setName('EventSourceMessagesView');\n    this._dataGrid.asWidget().show(this.element);\n  }\n\n  /**\n   * @override\n   */\n  wasShown() {\n    this._dataGrid.rootNode().removeChildren();\n    const messages = this._request.eventSourceMessages();\n    for (let i = 0; i < messages.length; ++i) {\n      this._dataGrid.insertChild(new EventSourceMessageNode(messages[i]));\n    }\n\n    this._request.addEventListener(SDK.NetworkRequest.Events.EventSourceMessageAdded, this._messageAdded, this);\n  }\n\n  /**\n   * @override\n   */\n  willHide() {\n    this._request.removeEventListener(SDK.NetworkRequest.Events.EventSourceMessageAdded, this._messageAdded, this);\n  }\n\n  /**\n   * @param {!Common.EventTarget.EventTargetEvent} event\n   */\n  _messageAdded(event) {\n    const message = /** @type {!SDK.NetworkRequest.EventSourceMessage} */ (event.data);\n    this._dataGrid.insertChild(new EventSourceMessageNode(message));\n  }\n\n  _sortItems() {\n    const sortColumnId = this._dataGrid.sortColumnId();\n    if (!sortColumnId) {\n      return;\n    }\n    const comparator =\n        /** @type {undefined|function(!DataGrid.SortableDataGrid.SortableDataGridNode<!EventSourceMessageNode>, !DataGrid.SortableDataGrid.SortableDataGridNode<!EventSourceMessageNode>):number} */\n        (Comparators[sortColumnId]);\n    if (!comparator) {\n      return;\n    }\n    this._dataGrid.sortNodes(comparator, !this._dataGrid.isSortOrderAscending());\n  }\n\n  /**\n   * @param {!UI.ContextMenu.ContextMenu} contextMenu\n   * @param {!DataGrid.DataGrid.DataGridNode<!DataGrid.ViewportDataGrid.ViewportDataGridNode<!DataGrid.SortableDataGrid.SortableDataGridNode<!EventSourceMessageNode>>>} node\n   */\n  _onRowContextMenu(contextMenu, node) {\n    contextMenu.clipboardSection().appendItem(\n        Common.UIString.UIString('Copy message'),\n        Host.InspectorFrontendHost.InspectorFrontendHostInstance.copyText.bind(\n            Host.InspectorFrontendHost.InspectorFrontendHostInstance, node.data.data));\n  }\n}\n\n/**\n * @extends {DataGrid.SortableDataGrid.SortableDataGridNode<EventSourceMessageNode>}\n */\nexport class EventSourceMessageNode extends DataGrid.SortableDataGrid.SortableDataGridNode {\n  /**\n   * @param {!SDK.NetworkRequest.EventSourceMessage} message\n   */\n  constructor(message) {\n    const time = new Date(message.time * 1000);\n    const timeText = ('0' + time.getHours()).substr(-2) + ':' + ('0' + time.getMinutes()).substr(-2) + ':' +\n        ('0' + time.getSeconds()).substr(-2) + '.' + ('00' + time.getMilliseconds()).substr(-3);\n    const timeNode = document.createElement('div');\n    UI.UIUtils.createTextChild(timeNode, timeText);\n    UI.Tooltip.Tooltip.install(timeNode, time.toLocaleString());\n    super({id: message.eventId, type: message.eventName, data: message.data, time: timeNode});\n    this._message = message;\n  }\n}\n\n/**\n * @param {function(!SDK.NetworkRequest.EventSourceMessage):(number|string)} fieldGetter\n * @param {!EventSourceMessageNode} a\n * @param {!EventSourceMessageNode} b\n * @return {number}\n */\nexport function EventSourceMessageNodeComparator(fieldGetter, a, b) {\n  const aValue = fieldGetter(a._message);\n  const bValue = fieldGetter(b._message);\n  return aValue < bValue ? -1 : aValue > bValue ? 1 : 0;\n}\n\n/** @type {!Object.<string, function(!EventSourceMessageNode, !EventSourceMessageNode):number>} */\nexport const Comparators = {\n  'id': EventSourceMessageNodeComparator.bind(null, message => message.eventId),\n  'type': EventSourceMessageNodeComparator.bind(null, message => message.eventName),\n  'time': EventSourceMessageNodeComparator.bind(null, message => message.time)\n};\n"]}