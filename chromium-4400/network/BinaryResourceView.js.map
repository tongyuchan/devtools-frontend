{"version":3,"file":"BinaryResourceView.js","sourceRoot":"","sources":["../../../../../front_end/network/BinaryResourceView.js"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2019 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../common/common.js';  // eslint-disable-line no-unused-vars\nimport * as Host from '../host/host.js';\nimport {ls} from '../platform/platform.js';\nimport * as SourceFrame from '../source_frame/source_frame.js';\nimport * as TextUtils from '../text_utils/text_utils.js';  // eslint-disable-line no-unused-vars\nimport * as UI from '../ui/ui.js';\n\nexport class BinaryResourceView extends UI.Widget.VBox {\n  /**\n   * @param {string} base64content\n   * @param {string} contentUrl\n   * @param {!Common.ResourceType.ResourceType} resourceType\n   */\n  constructor(base64content, contentUrl, resourceType) {\n    super();\n    this.registerRequiredCSS('network/binaryResourceView.css', {enableLegacyPatching: false});\n\n    this._binaryResourceViewFactory =\n        new SourceFrame.BinaryResourceViewFactory.BinaryResourceViewFactory(base64content, contentUrl, resourceType);\n\n    this._toolbar = new UI.Toolbar.Toolbar('binary-view-toolbar', this.element);\n\n    /** @type {!Array<!BinaryViewObject>} */\n    this._binaryViewObjects = [\n      new BinaryViewObject(\n          'base64', ls`Base64`, ls`Copied as Base64`,\n          this._binaryResourceViewFactory.createBase64View.bind(this._binaryResourceViewFactory),\n          this._binaryResourceViewFactory.base64.bind(this._binaryResourceViewFactory)),\n      new BinaryViewObject(\n          'hex', ls`Hex Viewer`, ls`Copied as Hex`,\n          this._binaryResourceViewFactory.createHexView.bind(this._binaryResourceViewFactory),\n          this._binaryResourceViewFactory.hex.bind(this._binaryResourceViewFactory)),\n      new BinaryViewObject(\n          'utf8', ls`UTF-8`, ls`Copied as UTF-8`,\n          this._binaryResourceViewFactory.createUtf8View.bind(this._binaryResourceViewFactory),\n          this._binaryResourceViewFactory.utf8.bind(this._binaryResourceViewFactory)),\n    ];\n    this._binaryViewTypeSetting = Common.Settings.Settings.instance().createSetting('binaryViewType', 'hex');\n    this._binaryViewTypeCombobox =\n        new UI.Toolbar.ToolbarComboBox(this._binaryViewTypeChanged.bind(this), ls`Binary view type`);\n    for (const viewObject of this._binaryViewObjects) {\n      this._binaryViewTypeCombobox.addOption(\n          this._binaryViewTypeCombobox.createOption(viewObject.label, viewObject.type));\n    }\n    this._toolbar.appendToolbarItem(this._binaryViewTypeCombobox);\n\n    const copyButton = new UI.Toolbar.ToolbarButton(ls`Copy to clipboard`, 'largeicon-copy');\n    copyButton.addEventListener(UI.Toolbar.ToolbarButton.Events.Click, event => {\n      this._copySelectedViewToClipboard();\n    }, this);\n    this._toolbar.appendToolbarItem(copyButton);\n\n    this._copiedText = new UI.Toolbar.ToolbarText();\n    this._copiedText.element.classList.add('binary-view-copied-text');\n    this._toolbar.element.appendChild(this._copiedText.element);\n\n    /** @type {?number} */\n    this._addFadeoutSettimeoutId = null;\n\n    /** @type {?UI.Widget.Widget} */\n    this._lastView = null;\n    this._updateView();\n  }\n\n  /**\n   * @return {?BinaryViewObject}\n   */\n  _getCurrentViewObject() {\n    const filter = /** @param {!BinaryViewObject} obj */ obj => obj.type === this._binaryViewTypeSetting.get();\n    const binaryViewObject = this._binaryViewObjects.find(filter);\n    console.assert(\n        Boolean(binaryViewObject),\n        `No binary view found for binary view type found in setting 'binaryViewType': ${\n            this._binaryViewTypeSetting.get()}`);\n    return binaryViewObject || null;\n  }\n\n  async _copySelectedViewToClipboard() {\n    const viewObject = this._getCurrentViewObject();\n    if (!viewObject) {\n      return;\n    }\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.copyText((await viewObject.content()).content);\n    this._copiedText.setText(viewObject.copiedMessage);\n    this._copiedText.element.classList.remove('fadeout');\n    /**\n     * @this {!BinaryResourceView}\n     */\n    function addFadeoutClass() {\n      this._copiedText.element.classList.add('fadeout');\n    }\n    if (this._addFadeoutSettimeoutId) {\n      clearTimeout(this._addFadeoutSettimeoutId);\n      this._addFadeoutSettimeoutId = null;\n    }\n    this._addFadeoutSettimeoutId = window.setTimeout(addFadeoutClass.bind(this), 2000);\n  }\n\n  /**\n   * @override\n   */\n  wasShown() {\n    this._updateView();\n  }\n\n  _updateView() {\n    const newViewObject = this._getCurrentViewObject();\n    if (!newViewObject) {\n      return;\n    }\n\n    const newView = newViewObject.getView();\n    if (newView === this._lastView) {\n      return;\n    }\n\n    if (this._lastView) {\n      this._lastView.detach();\n    }\n    this._lastView = newView;\n\n    newView.show(this.element, this._toolbar.element);\n    this._binaryViewTypeCombobox.selectElement().value = this._binaryViewTypeSetting.get();\n  }\n\n  _binaryViewTypeChanged() {\n    const selectedOption = /** @type {?HTMLOptionElement} */ (this._binaryViewTypeCombobox.selectedOption());\n    if (!selectedOption) {\n      return;\n    }\n    const newViewType = selectedOption.value;\n    if (this._binaryViewTypeSetting.get() === newViewType) {\n      return;\n    }\n    this._binaryViewTypeSetting.set(newViewType);\n    this._updateView();\n  }\n\n  /**\n   * @param {!UI.ContextMenu.ContextMenu} contextMenu\n   * @param {string} submenuItemText\n   */\n  addCopyToContextMenu(contextMenu, submenuItemText) {\n    const copyMenu = contextMenu.clipboardSection().appendSubMenuItem(submenuItemText);\n    const footerSection = copyMenu.footerSection();\n\n    footerSection.appendItem(ls`Copy as Base64`, async () => {\n      const content = await this._binaryResourceViewFactory.base64();\n      Host.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(content.content);\n    });\n    footerSection.appendItem(ls`Copy as Hex`, async () => {\n      const content = await this._binaryResourceViewFactory.hex();\n      Host.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(content.content);\n    });\n    footerSection.appendItem(ls`Copy as UTF-8`, async () => {\n      const content = await this._binaryResourceViewFactory.utf8();\n      Host.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(content.content);\n    });\n  }\n}\n\nexport class BinaryViewObject {\n  /**\n   * @param {string} type\n   * @param {string} label\n   * @param {string} copiedMessage\n   * @param {function():!UI.Widget.Widget} createViewFn\n   * @param {function():Promise<!TextUtils.ContentProvider.DeferredContent>} deferredContent\n   */\n  constructor(type, label, copiedMessage, createViewFn, deferredContent) {\n    this.type = type;\n    this.label = label;\n    this.copiedMessage = copiedMessage;\n    this.content = deferredContent;\n    this._createViewFn = createViewFn;\n\n    /** @type {?UI.Widget.Widget} */\n    this._view = null;\n  }\n\n  /**\n   * @return {!UI.Widget.Widget}\n   */\n  getView() {\n    if (!this._view) {\n      this._view = this._createViewFn();\n    }\n    return this._view;\n  }\n}\n"]}