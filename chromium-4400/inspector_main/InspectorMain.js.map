{"version":3,"file":"InspectorMain.js","sourceRoot":"","sources":["../../../../../front_end/inspector_main/InspectorMain.js"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2018 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../common/common.js';\nimport * as Components from '../components/components.js';\nimport * as Host from '../host/host.js';\nimport * as MobileThrottling from '../mobile_throttling/mobile_throttling.js';\nimport * as Root from '../root/root.js';\nimport * as SDK from '../sdk/sdk.js';\nimport * as UI from '../ui/ui.js';\n\n/**\n * @implements {Common.Runnable.Runnable}\n */\nexport class InspectorMainImpl extends Common.ObjectWrapper.ObjectWrapper {\n  /**\n   * @override\n   */\n  async run() {\n    let firstCall = true;\n    await SDK.Connections.initMainConnection(async () => {\n      const type = Root.Runtime.Runtime.queryParam('v8only') ? SDK.SDKModel.Type.Node : SDK.SDKModel.Type.Frame;\n      const waitForDebuggerInPage =\n          type === SDK.SDKModel.Type.Frame && Root.Runtime.Runtime.queryParam('panel') === 'sources';\n      const target = SDK.SDKModel.TargetManager.instance().createTarget(\n          'main', Common.UIString.UIString('Main'), type, null, undefined, waitForDebuggerInPage);\n\n      // Only resume target during the first connection,\n      // subsequent connections are due to connection hand-over,\n      // there is no need to pause in debugger.\n      if (!firstCall) {\n        return;\n      }\n      firstCall = false;\n\n      if (waitForDebuggerInPage) {\n        const debuggerModel = target.model(SDK.DebuggerModel.DebuggerModel);\n        if (debuggerModel) {\n          if (!debuggerModel.isReadyToPause()) {\n            await debuggerModel.once(SDK.DebuggerModel.Events.DebuggerIsReadyToPause);\n          }\n          debuggerModel.pause();\n        }\n      }\n\n      target.runtimeAgent().invoke_runIfWaitingForDebugger();\n    }, Components.TargetDetachedDialog.TargetDetachedDialog.webSocketConnectionLost);\n\n    new SourcesPanelIndicator();\n    new BackendSettingsSync();\n    new MobileThrottling.NetworkPanelIndicator.NetworkPanelIndicator();\n\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.events.addEventListener(\n        Host.InspectorFrontendHostAPI.Events.ReloadInspectedPage, event => {\n          const hard = /** @type {boolean} */ (event.data);\n          SDK.ResourceTreeModel.ResourceTreeModel.reloadAllPages(hard);\n        });\n  }\n}\n\n/**\n * @implements {UI.ActionRegistration.ActionDelegate}\n */\nexport class ReloadActionDelegate {\n  /**\n   * @override\n   * @param {!UI.Context.Context} context\n   * @param {string} actionId\n   * @return {boolean}\n   */\n  handleAction(context, actionId) {\n    switch (actionId) {\n      case 'inspector_main.reload':\n        SDK.ResourceTreeModel.ResourceTreeModel.reloadAllPages(false);\n        return true;\n      case 'inspector_main.hard-reload':\n        SDK.ResourceTreeModel.ResourceTreeModel.reloadAllPages(true);\n        return true;\n    }\n    return false;\n  }\n}\n\n/**\n * @implements {UI.ActionRegistration.ActionDelegate}\n */\nexport class FocusDebuggeeActionDelegate {\n  /**\n   * @override\n   * @param {!UI.Context.Context} context\n   * @param {string} actionId\n   * @return {boolean}\n   */\n  handleAction(context, actionId) {\n    const mainTarget = SDK.SDKModel.TargetManager.instance().mainTarget();\n    if (!mainTarget) {\n      return false;\n    }\n    mainTarget.pageAgent().invoke_bringToFront();\n    return true;\n  }\n}\n\n/**\n * @implements {UI.Toolbar.Provider}\n */\nexport class NodeIndicator {\n  constructor() {\n    const element = document.createElement('div');\n    const shadowRoot = UI.Utils.createShadowRootWithCoreStyles(\n        element, {cssFile: 'inspector_main/nodeIcon.css', enableLegacyPatching: false, delegatesFocus: undefined});\n    this._element = shadowRoot.createChild('div', 'node-icon');\n    element.addEventListener(\n        'click', () => Host.InspectorFrontendHost.InspectorFrontendHostInstance.openNodeFrontend(), false);\n    this._button = new UI.Toolbar.ToolbarItem(element);\n    this._button.setTitle(Common.UIString.UIString('Open dedicated DevTools for Node.js'));\n    SDK.SDKModel.TargetManager.instance().addEventListener(\n        SDK.SDKModel.Events.AvailableTargetsChanged,\n        event => this._update(/** @type {!Array<!Protocol.Target.TargetInfo>} */ (event.data)));\n    this._button.setVisible(false);\n    this._update([]);\n  }\n\n  /**\n   * @param {!Array<!Protocol.Target.TargetInfo>} targetInfos\n   */\n  _update(targetInfos) {\n    const hasNode = Boolean(targetInfos.find(target => target.type === 'node' && !target.attached));\n    this._element.classList.toggle('inactive', !hasNode);\n    if (hasNode) {\n      this._button.setVisible(true);\n    }\n  }\n\n  /**\n   * @override\n   * @return {?UI.Toolbar.ToolbarItem}\n   */\n  item() {\n    return this._button;\n  }\n}\n\nexport class SourcesPanelIndicator {\n  constructor() {\n    Common.Settings.Settings.instance()\n        .moduleSetting('javaScriptDisabled')\n        .addChangeListener(javaScriptDisabledChanged);\n    javaScriptDisabledChanged();\n\n    function javaScriptDisabledChanged() {\n      let icon = null;\n      const javaScriptDisabled = Common.Settings.Settings.instance().moduleSetting('javaScriptDisabled').get();\n      if (javaScriptDisabled) {\n        icon = UI.Icon.Icon.create('smallicon-warning');\n        UI.Tooltip.Tooltip.install(icon, Common.UIString.UIString('JavaScript is disabled'));\n      }\n      UI.InspectorView.InspectorView.instance().setPanelIcon('sources', icon);\n    }\n  }\n}\n\n/**\n * @implements {SDK.SDKModel.Observer}\n */\nexport class BackendSettingsSync {\n  constructor() {\n    this._autoAttachSetting = Common.Settings.Settings.instance().moduleSetting('autoAttachToCreatedPages');\n    this._autoAttachSetting.addChangeListener(this._updateAutoAttach, this);\n    this._updateAutoAttach();\n\n    this._adBlockEnabledSetting = Common.Settings.Settings.instance().moduleSetting('network.adBlockingEnabled');\n    this._adBlockEnabledSetting.addChangeListener(this._update, this);\n\n    this._emulatePageFocusSetting = Common.Settings.Settings.instance().moduleSetting('emulatePageFocus');\n    this._emulatePageFocusSetting.addChangeListener(this._update, this);\n\n    SDK.SDKModel.TargetManager.instance().observeTargets(this);\n  }\n\n  /**\n   * @param {!SDK.SDKModel.Target} target\n   */\n  _updateTarget(target) {\n    if (target.type() !== SDK.SDKModel.Type.Frame || target.parentTarget()) {\n      return;\n    }\n    target.pageAgent().invoke_setAdBlockingEnabled({enabled: this._adBlockEnabledSetting.get()});\n    target.emulationAgent().invoke_setFocusEmulationEnabled({enabled: this._emulatePageFocusSetting.get()});\n  }\n\n  _updateAutoAttach() {\n    Host.InspectorFrontendHost.InspectorFrontendHostInstance.setOpenNewWindowForPopups(this._autoAttachSetting.get());\n  }\n\n  _update() {\n    for (const target of SDK.SDKModel.TargetManager.instance().targets()) {\n      this._updateTarget(target);\n    }\n  }\n\n  /**\n   * @param {!SDK.SDKModel.Target} target\n   * @override\n   */\n  targetAdded(target) {\n    this._updateTarget(target);\n  }\n\n  /**\n   * @param {!SDK.SDKModel.Target} target\n   * @override\n   */\n  targetRemoved(target) {\n  }\n}\n\nSDK.ChildTargetManager.ChildTargetManager.install();\n"]}