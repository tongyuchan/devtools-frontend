{"version":3,"file":"NetworkProject.js","sourceRoot":"","sources":["../../../../../front_end/bindings/NetworkProject.js"],"names":[],"mappings":"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","sourcesContent":["/*\n * Copyright (C) 2012 Google Inc. All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are\n * met:\n *\n *     * Redistributions of source code must retain the above copyright\n * notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above\n * copyright notice, this list of conditions and the following disclaimer\n * in the documentation and/or other materials provided with the\n * distribution.\n *     * Neither the name of Google Inc. nor the names of its\n * contributors may be used to endorse or promote products derived from\n * this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport * as Common from '../common/common.js';\nimport * as SDK from '../sdk/sdk.js';\nimport * as Workspace from '../workspace/workspace.js';  // eslint-disable-line no-unused-vars\n\n/** @type {!WeakMap<!Workspace.UISourceCode.UISourceCode, !Map<string, !{frame: !SDK.ResourceTreeModel.ResourceTreeFrame, count: number}>>} */\nconst uiSourceCodeToAttributionMap = new WeakMap();\n/** @type {!WeakMap<!Workspace.Workspace.Project, !SDK.SDKModel.Target>} */\nconst projectToTargetMap = new WeakMap();\n\n/**\n * @type {!NetworkProjectManager}\n */\nlet networkProjectManagerInstance;\n\nexport class NetworkProjectManager extends Common.ObjectWrapper.ObjectWrapper {\n  /**\n   * @private\n   */\n  constructor() {\n    super();\n  }\n\n  /**\n   * @param {{forceNew: boolean}} opts\n   */\n  static instance({forceNew} = {forceNew: false}) {\n    if (!networkProjectManagerInstance || forceNew) {\n      networkProjectManagerInstance = new NetworkProjectManager();\n    }\n\n    return networkProjectManagerInstance;\n  }\n}\n\nexport const Events = {\n  FrameAttributionAdded: Symbol('FrameAttributionAdded'),\n  FrameAttributionRemoved: Symbol('FrameAttributionRemoved')\n};\n\nexport class NetworkProject {\n  /**\n   * @param {!Workspace.UISourceCode.UISourceCode} uiSourceCode\n   * @param {string} frameId\n   */\n  static _resolveFrame(uiSourceCode, frameId) {\n    const target = NetworkProject.targetForUISourceCode(uiSourceCode);\n    const resourceTreeModel = target && target.model(SDK.ResourceTreeModel.ResourceTreeModel);\n    return resourceTreeModel ? resourceTreeModel.frameForId(frameId) : null;\n  }\n\n  /**\n   * @param {!Workspace.UISourceCode.UISourceCode} uiSourceCode\n   * @param {string} frameId\n   */\n  static setInitialFrameAttribution(uiSourceCode, frameId) {\n    const frame = NetworkProject._resolveFrame(uiSourceCode, frameId);\n    if (!frame) {\n      return;\n    }\n    /** @type {!Map<string, !{frame: !SDK.ResourceTreeModel.ResourceTreeFrame, count: number}>} */\n    const attribution = new Map();\n    attribution.set(frameId, {frame: frame, count: 1});\n    uiSourceCodeToAttributionMap.set(uiSourceCode, attribution);\n  }\n\n  /**\n   * @param {!Workspace.UISourceCode.UISourceCode} fromUISourceCode\n   * @param {!Workspace.UISourceCode.UISourceCode} toUISourceCode\n   */\n  static cloneInitialFrameAttribution(fromUISourceCode, toUISourceCode) {\n    const fromAttribution = uiSourceCodeToAttributionMap.get(fromUISourceCode);\n    if (!fromAttribution) {\n      return;\n    }\n    /** @type {!Map<string, !{frame: !SDK.ResourceTreeModel.ResourceTreeFrame, count: number}>} */\n    const toAttribution = new Map();\n    for (const frameId of fromAttribution.keys()) {\n      const value = fromAttribution.get(frameId);\n      if (typeof value !== 'undefined') {\n        toAttribution.set(frameId, {frame: value.frame, count: value.count});\n      }\n    }\n    uiSourceCodeToAttributionMap.set(toUISourceCode, toAttribution);\n  }\n\n  /**\n   * @param {!Workspace.UISourceCode.UISourceCode} uiSourceCode\n   * @param {string} frameId\n   */\n  static addFrameAttribution(uiSourceCode, frameId) {\n    const frame = NetworkProject._resolveFrame(uiSourceCode, frameId);\n    if (!frame) {\n      return;\n    }\n    const frameAttribution = uiSourceCodeToAttributionMap.get(uiSourceCode);\n    if (!frameAttribution) {\n      return;\n    }\n    const attributionInfo = frameAttribution.get(frameId) || {frame: frame, count: 0};\n    attributionInfo.count += 1;\n    frameAttribution.set(frameId, attributionInfo);\n    if (attributionInfo.count !== 1) {\n      return;\n    }\n\n    const data = {uiSourceCode: uiSourceCode, frame: frame};\n    NetworkProjectManager.instance().dispatchEventToListeners(Events.FrameAttributionAdded, data);\n  }\n\n  /**\n   * @param {!Workspace.UISourceCode.UISourceCode} uiSourceCode\n   * @param {string} frameId\n   */\n  static removeFrameAttribution(uiSourceCode, frameId) {\n    const frameAttribution = uiSourceCodeToAttributionMap.get(uiSourceCode);\n    if (!frameAttribution) {\n      return;\n    }\n    const attributionInfo = frameAttribution.get(frameId);\n    console.assert(Boolean(attributionInfo), 'Failed to remove frame attribution for url: ' + uiSourceCode.url());\n    if (!attributionInfo) {\n      return;\n    }\n    attributionInfo.count -= 1;\n    if (attributionInfo.count > 0) {\n      return;\n    }\n    frameAttribution.delete(frameId);\n    const data = {uiSourceCode: uiSourceCode, frame: attributionInfo.frame};\n    NetworkProjectManager.instance().dispatchEventToListeners(Events.FrameAttributionRemoved, data);\n  }\n\n  /**\n   * @param {!Workspace.UISourceCode.UISourceCode} uiSourceCode\n   * @return {?SDK.SDKModel.Target} target\n   */\n  static targetForUISourceCode(uiSourceCode) {\n    return projectToTargetMap.get(uiSourceCode.project()) || null;\n  }\n\n  /**\n   * @param {!Workspace.Workspace.Project} project\n   * @param {!SDK.SDKModel.Target} target\n   */\n  static setTargetForProject(project, target) {\n    projectToTargetMap.set(project, target);\n  }\n\n  /**\n   * @param {!Workspace.Workspace.Project} project\n   * @return {?SDK.SDKModel.Target}\n   */\n  static getTargetForProject(project) {\n    return projectToTargetMap.get(project) || null;\n  }\n\n  /**\n   * @param {!Workspace.UISourceCode.UISourceCode} uiSourceCode\n   * @return {!Array<!SDK.ResourceTreeModel.ResourceTreeFrame>}\n   */\n  static framesForUISourceCode(uiSourceCode) {\n    const target = NetworkProject.targetForUISourceCode(uiSourceCode);\n    const resourceTreeModel = target && target.model(SDK.ResourceTreeModel.ResourceTreeModel);\n    const attribution = uiSourceCodeToAttributionMap.get(uiSourceCode);\n    if (!resourceTreeModel || !attribution) {\n      return [];\n    }\n    const frames = Array.from(attribution.keys()).map(frameId => resourceTreeModel.frameForId(frameId));\n    return /** @type {!Array<!SDK.ResourceTreeModel.ResourceTreeFrame>} */ (frames.filter(frame => Boolean(frame)));\n  }\n}\n"]}