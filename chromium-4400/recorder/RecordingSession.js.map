{"version":3,"file":"RecordingSession.js","sourceRoot":"","sources":["../../../../../front_end/recorder/RecordingSession.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\n/* eslint-disable rulesdir/no_underscored_properties */\n\nimport * as Common from '../common/common.js';  // eslint-disable-line no-unused-vars\nimport * as SDK from '../sdk/sdk.js';\nimport * as Workspace from '../workspace/workspace.js';  // eslint-disable-line no-unused-vars\nimport {RecordingEventHandler} from './RecordingEventHandler.js';\n\nexport class StepFrameContext {\n  path: number[];\n  target: string;\n  constructor(target: string, path: number[] = []) {\n    this.path = path;\n    this.target = target;\n  }\n\n  toString(): string {\n    let expression = StepFrameContext.getExpressionForTarget(this.target) + '\\n';\n    expression += 'const frame = targetPage.mainFrame()';\n    for (const index of this.path) {\n      expression += `.childFrames()[${index}]`;\n    }\n    expression += ';';\n    return expression;\n  }\n\n  static getExpressionForTarget(target: string): string {\n    if (target === 'main') {\n      return 'const targetPage = page;';\n    }\n    return `const target = await browser.waitForTarget(p => p.url() === ${JSON.stringify(target)});\n  const targetPage = await target.page();`;\n  }\n}\n\nexport class Step {\n  action: string;\n  constructor(action: string) {\n    this.action = action;\n  }\n\n  toString(): string {\n    throw new Error('Must be implemented in subclass.');\n  }\n}\n\nexport class ClickStep extends Step {\n  context: StepFrameContext;\n  selector: string;\n  constructor(context: StepFrameContext, selector: string) {\n    super('click');\n    this.context = context;\n    this.selector = selector;\n  }\n\n  toString(): string {\n    return `{\n  ${this.context}\n  const element = await frame.waitForSelector(${JSON.stringify(this.selector)});\n  await element.click();\n  }`;\n  }\n}\n\nexport class NavigationStep extends Step {\n  url: string;\n  constructor(url: string) {\n    super('navigate');\n    this.url = url;\n  }\n\n  toString(): string {\n    return `await page.goto(${JSON.stringify(this.url)});`;\n  }\n}\n\nexport class SubmitStep extends Step {\n  context: StepFrameContext;\n  selector: string;\n  constructor(context: StepFrameContext, selector: string) {\n    super('submit');\n    this.context = context;\n    this.selector = selector;\n  }\n\n  toString(): string {\n    return `{\n  ${this.context}\n  const element = await frame.waitForSelector(${JSON.stringify(this.selector)});\n  await element.evaluate(form => form.submit());\n  }`;\n  }\n}\n\nexport class ChangeStep extends Step {\n  context: StepFrameContext;\n  selector: string;\n  value: string;\n  constructor(context: StepFrameContext, selector: string, value: string) {\n    super('change');\n    this.context = context;\n    this.selector = selector;\n    this.value = value;\n  }\n\n  toString(): string {\n    return `{\n  ${this.context}\n  const element = await frame.waitForSelector(${JSON.stringify(this.selector)});\n  await element.type(${JSON.stringify(this.value)});\n  }`;\n  }\n}\n\nexport class CloseStep extends Step {\n  target: string;\n  constructor(target: string) {\n    super('close');\n    this.target = target;\n  }\n\n  toString(): string {\n    return `{\n  ${StepFrameContext.getExpressionForTarget(this.target)}\n  await targetPage.close();\n  }`;\n  }\n}\n\nexport class EmulateNetworkConditions extends Step {\n  conditions: SDK.NetworkManager.Conditions;\n  constructor(conditions: SDK.NetworkManager.Conditions) {\n    super('emulateNetworkConditions');\n    this.conditions = conditions;\n  }\n\n  toString(): string {\n    // TODO(crbug.com/1161438): Update once puppeteer has better support for this\n    return `{\n      // Simulated network throttling (${this.conditions.title})\n      const client = await page.target().createCDPSession();\n      await client.send('Network.enable');\n      await client.send('Network.emulateNetworkConditions', {\n      // Network connectivity is absent\n      offline: ${!this.conditions.download && !this.conditions.upload},\n      // Download speed (bytes/s)\n      downloadThroughput: ${this.conditions.download},\n      // Upload speed (bytes/s)\n      uploadThroughput: ${this.conditions.upload},\n      // Latency (ms)\n      latency: ${this.conditions.latency},\n      });\n  }`;\n  }\n}\n\nconst DOM_BREAKPOINTS = new Set<string>(['Mouse:click', 'Control:change', 'Control:submit']);\n\nexport class RecordingSession {\n  _target: SDK.SDKModel.Target;\n  _uiSourceCode: Workspace.UISourceCode.UISourceCode;\n  _currentIndentation: number;\n  _debuggerAgent: ProtocolProxyApi.DebuggerApi;\n  _domDebuggerAgent: ProtocolProxyApi.DOMDebuggerApi;\n  _runtimeAgent: ProtocolProxyApi.RuntimeApi;\n  _accessibilityAgent: ProtocolProxyApi.AccessibilityApi;\n  _pageAgent: ProtocolProxyApi.PageApi;\n  _targetAgent: ProtocolProxyApi.TargetApi;\n  _networkManager: SDK.NetworkManager.MultitargetNetworkManager;\n  _domModel: SDK.DOMModel.DOMModel;\n  _axModel: SDK.AccessibilityModel.AccessibilityModel;\n  _debuggerModel: SDK.DebuggerModel.DebuggerModel;\n  _resourceTreeModel: SDK.ResourceTreeModel.ResourceTreeModel;\n  _runtimeModel: SDK.RuntimeModel.RuntimeModel;\n  _childTargetManager: SDK.ChildTargetManager.ChildTargetManager|null;\n  _eventHandlers: Map<string, RecordingEventHandler>;\n  _targets: Set<SDK.SDKModel.Target>;\n  _initialDomBreakpointState: Map<SDK.DOMDebuggerModel.EventListenerBreakpoint, boolean>;\n  _interestingBreakpoints: SDK.DOMDebuggerModel.EventListenerBreakpoint[];\n  _newDocumentScriptIdentifier: string|null;\n\n  constructor(target: SDK.SDKModel.Target, uiSourceCode: Workspace.UISourceCode.UISourceCode) {\n    this._target = target;\n    this._uiSourceCode = uiSourceCode;\n    this._currentIndentation = 0;\n\n    this._debuggerAgent = target.debuggerAgent();\n    this._domDebuggerAgent = target.domdebuggerAgent();\n    this._runtimeAgent = target.runtimeAgent();\n    this._accessibilityAgent = target.accessibilityAgent();\n    this._pageAgent = target.pageAgent();\n    this._targetAgent = target.targetAgent();\n\n    this._networkManager = SDK.NetworkManager.MultitargetNetworkManager.instance();\n    this._domModel = target.model(SDK.DOMModel.DOMModel) as SDK.DOMModel.DOMModel;\n    this._axModel =\n        target.model(SDK.AccessibilityModel.AccessibilityModel) as SDK.AccessibilityModel.AccessibilityModel;\n    this._debuggerModel = target.model(SDK.DebuggerModel.DebuggerModel) as SDK.DebuggerModel.DebuggerModel;\n    this._resourceTreeModel =\n        target.model(SDK.ResourceTreeModel.ResourceTreeModel) as SDK.ResourceTreeModel.ResourceTreeModel;\n    this._runtimeModel = target.model(SDK.RuntimeModel.RuntimeModel) as SDK.RuntimeModel.RuntimeModel;\n    this._childTargetManager = target.model(SDK.ChildTargetManager.ChildTargetManager);\n\n    this._target = target;\n    this._eventHandlers = new Map();\n\n    this._targets = new Set();\n\n    this._initialDomBreakpointState = new Map();\n\n    this._interestingBreakpoints = [];\n\n    this._newDocumentScriptIdentifier = null;\n  }\n\n  async start(): Promise<void> {\n    const allDomBreakpoints = SDK.DOMDebuggerModel.DOMDebuggerManager.instance().eventListenerBreakpoints();\n    this._interestingBreakpoints =\n        allDomBreakpoints.filter(breakpoint => DOM_BREAKPOINTS.has(breakpoint.category() + ':' + breakpoint.title()));\n\n    for (const breakpoint of this._interestingBreakpoints) {\n      this._initialDomBreakpointState.set(breakpoint, breakpoint.enabled());\n      breakpoint.setEnabled(true);\n    }\n\n    this._networkManager.addEventListener(\n        SDK.NetworkManager.MultitargetNetworkManager.Events.ConditionsChanged, this._handleNetworkConditionsChanged,\n        this);\n\n    this.attachToTarget(this._target);\n    const mainTarget = SDK.SDKModel.TargetManager.instance().mainTarget();\n    if (!mainTarget) {\n      throw new Error('Could not find main target');\n    }\n    const resourceTreeModel = mainTarget.model(SDK.ResourceTreeModel.ResourceTreeModel);\n    if (!resourceTreeModel) {\n      throw new Error('Could not find resource tree model');\n    }\n\n    const mainFrame = resourceTreeModel.mainFrame;\n\n    if (!mainFrame) {\n      throw new Error('Could not find main frame');\n    }\n    await this.appendLineToScript('const puppeteer = require(\\'puppeteer\\');');\n    await this.appendLineToScript('');\n    await this.appendLineToScript('(async () => {');\n    this._currentIndentation += 1;\n    await this.appendLineToScript('const browser = await puppeteer.launch();');\n    await this.appendLineToScript('const page = await browser.newPage();');\n    await this.appendLineToScript('');\n\n    const networkConditions = this._networkManager.networkConditions();\n    if (networkConditions !== SDK.NetworkManager.NoThrottlingConditions) {\n      await this.appendStepToScript(new EmulateNetworkConditions(networkConditions));\n    }\n\n    await this.appendStepToScript(new NavigationStep(mainFrame.url));\n  }\n\n  _handleNetworkConditionsChanged(): void {\n    const networkConditions = this._networkManager.networkConditions();\n    this.appendStepToScript(new EmulateNetworkConditions(networkConditions));\n  }\n\n  async stop(): Promise<void> {\n    for (const target of this._targets) {\n      await this.detachFromTarget(target);\n    }\n    await this.detachFromTarget(this._target);\n\n    this._networkManager.removeEventListener(\n        SDK.NetworkManager.MultitargetNetworkManager.Events.ConditionsChanged, this._handleNetworkConditionsChanged,\n        this);\n\n    await this.appendLineToScript('await browser.close();');\n    this._currentIndentation -= 1;\n    await this.appendLineToScript('})();');\n    await this.appendLineToScript('');\n\n    if (this._newDocumentScriptIdentifier) {\n      await this._pageAgent.invoke_removeScriptToEvaluateOnNewDocument({identifier: this._newDocumentScriptIdentifier});\n    }\n\n    await this._debuggerModel.ignoreDebuggerPausedEvents(false);\n\n    for (const [breakpoint, enabled] of this._initialDomBreakpointState.entries()) {\n      breakpoint.setEnabled(enabled);\n    }\n  }\n\n  async appendLineToScript(line: string): Promise<void> {\n    let content = this._uiSourceCode.content();\n    const indent = Common.Settings.Settings.instance().moduleSetting('textEditorIndent').get();\n    content += (indent.repeat(this._currentIndentation) + line).trimRight() + '\\n';\n    await this._uiSourceCode.setContent(content, false);\n    const lastLine = content.split('\\n').length;\n    Common.Revealer.reveal(this._uiSourceCode.uiLocation(lastLine), true);\n  }\n\n  async appendStepToScript(step: Step): Promise<void> {\n    const lines = step.toString().split('\\n').map(l => l.trim());\n    for (const line of lines) {\n      if (line === '}') {\n        this._currentIndentation -= 1;\n      }\n      await this.appendLineToScript(line);\n      if (line === '{') {\n        this._currentIndentation += 1;\n      }\n    }\n  }\n\n  async isSubmitButton(targetId: string): Promise<boolean> {\n    function innerIsSubmitButton(this: HTMLButtonElement): boolean {\n      return this.tagName === 'BUTTON' && this.type === 'submit' && this.form !== null;\n    }\n\n    const {result} = await this._runtimeAgent.invoke_callFunctionOn({\n      functionDeclaration: innerIsSubmitButton.toString(),\n      objectId: targetId,\n    });\n    return result.value;\n  }\n\n  async attachToTarget(target: SDK.SDKModel.Target): Promise<void> {\n    this._targets.add(target);\n    const eventHandler = new RecordingEventHandler(this, target);\n    this._eventHandlers.set(target.id(), eventHandler);\n    target.registerDebuggerDispatcher(eventHandler);\n\n    const pageAgent = target.pageAgent();\n\n    const debuggerModel = target.model(SDK.DebuggerModel.DebuggerModel) as SDK.DebuggerModel.DebuggerModel;\n\n    const childTargetManager = target.model(SDK.ChildTargetManager.ChildTargetManager);\n\n    const setupEventListeners = `\n  if (!window.__recorderEventListener) {\n  const recorderEventListener = (event) => { };\n  window.addEventListener('click', recorderEventListener, true);\n  window.addEventListener('submit', recorderEventListener, true);\n  window.addEventListener('change', recorderEventListener, true);\n  window.__recorderEventListener = recorderEventListener;\n  }\n  `;\n\n    // This uses the setEventListenerBreakpoint method from the debugger\n    // to get notified about new events. Therefor disable the normal debugger\n    // while recording.\n    await debuggerModel.resumeModel();\n    await debuggerModel.ignoreDebuggerPausedEvents(true);\n\n    const {identifier} = await pageAgent.invoke_addScriptToEvaluateOnNewDocument({source: setupEventListeners});\n    this._newDocumentScriptIdentifier = identifier;\n\n    await this.evaluateInAllFrames(target, setupEventListeners);\n\n    childTargetManager?.addEventListener(SDK.ChildTargetManager.Events.TargetCreated, this.handleWindowOpened, this);\n    childTargetManager?.addEventListener(SDK.ChildTargetManager.Events.TargetDestroyed, this.handleWindowClosed, this);\n  }\n\n  async detachFromTarget(target: SDK.SDKModel.Target): Promise<void> {\n    const eventHandler = this._eventHandlers.get(target.id());\n    if (!eventHandler) {\n      return;\n    }\n    target.unregisterDebuggerDispatcher(eventHandler);\n\n    const debuggerModel = target.model(SDK.DebuggerModel.DebuggerModel) as SDK.DebuggerModel.DebuggerModel;\n\n    await debuggerModel.ignoreDebuggerPausedEvents(false);\n  }\n\n  async evaluateInAllFrames(target: SDK.SDKModel.Target, expression: string): Promise<void> {\n    const resourceTreeModel =\n        target.model(SDK.ResourceTreeModel.ResourceTreeModel) as SDK.ResourceTreeModel.ResourceTreeModel;\n    const runtimeModel = target.model(SDK.RuntimeModel.RuntimeModel) as SDK.RuntimeModel.RuntimeModel;\n    const executionContexts = runtimeModel.executionContexts();\n    for (const frame of resourceTreeModel.frames()) {\n      const executionContext = executionContexts.find(context => context.frameId === frame.id);\n      if (!executionContext) {\n        continue;\n      }\n\n      await executionContext.evaluate(\n          {\n            expression,\n            objectGroup: undefined,\n            includeCommandLineAPI: undefined,\n            silent: undefined,\n            returnByValue: undefined,\n            generatePreview: undefined,\n            allowUnsafeEvalBlockedByCSP: undefined,\n            throwOnSideEffect: undefined,\n            timeout: undefined,\n            disableBreaks: undefined,\n            replMode: undefined,\n          },\n          true, false);\n    }\n  }\n\n  async handleWindowOpened(event: Common.EventTarget.EventTargetEvent): Promise<void> {\n    if (event.data.type !== 'page') {\n      return;\n    }\n    const executionContexts = this._runtimeModel.executionContexts();\n    const executionContext = executionContexts.find(context => context.frameId === event.data.openerFrameId);\n    if (!executionContext) {\n      throw new Error('Could not find execution context in opened frame.');\n    }\n\n    await this._targetAgent.invoke_attachToTarget({targetId: event.data.targetId, flatten: true});\n    const target = SDK.SDKModel.TargetManager.instance().targets().find(t => t.id() === event.data.targetId);\n\n    if (!target) {\n      throw new Error('Could not find target.');\n    }\n\n    this.attachToTarget(target);\n  }\n\n  async handleWindowClosed(event: Common.EventTarget.EventTargetEvent): Promise<void> {\n    const eventHandler = this._eventHandlers.get(event.data);\n    if (!eventHandler) {\n      return;\n    }\n    eventHandler.targetDestroyed();\n  }\n}\n"]}