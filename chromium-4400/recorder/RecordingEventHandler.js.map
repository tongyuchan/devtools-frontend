{"version":3,"file":"RecordingEventHandler.js","sourceRoot":"","sources":["../../../../../front_end/recorder/RecordingEventHandler.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Elements from '../elements/elements.js';\nimport * as SDK from '../sdk/sdk.js';\n\nimport {ChangeStep, ClickStep, CloseStep, RecordingSession, StepFrameContext, SubmitStep} from './RecordingSession.js';\n\nconst RELEVANT_ROLES_FOR_ARIA_SELECTORS = new Set<string>(['button', 'link', 'textbox', 'checkbox']);\n\nexport class RecordingEventHandler implements ProtocolProxyApi.DebuggerDispatcher {\n  private target: SDK.SDKModel.Target;\n  private session: RecordingSession;\n  private runtimeModel: SDK.RuntimeModel.RuntimeModel;\n  private resourceTreeModel: SDK.ResourceTreeModel.ResourceTreeModel;\n  private debuggerAgent: ProtocolProxyApi.DebuggerApi;\n  private runtimeAgent: ProtocolProxyApi.RuntimeApi;\n  private domModel: SDK.DOMModel.DOMModel;\n  private axModel: SDK.AccessibilityModel.AccessibilityModel;\n\n  constructor(session: RecordingSession, target: SDK.SDKModel.Target) {\n    this.target = target;\n    this.session = session;\n\n    this.runtimeAgent = target.runtimeAgent();\n    this.debuggerAgent = target.debuggerAgent();\n    this.runtimeModel = target.model(SDK.RuntimeModel.RuntimeModel) as SDK.RuntimeModel.RuntimeModel;\n    this.resourceTreeModel =\n        target.model(SDK.ResourceTreeModel.ResourceTreeModel) as SDK.ResourceTreeModel.ResourceTreeModel;\n    this.domModel = target.model(SDK.DOMModel.DOMModel) as SDK.DOMModel.DOMModel;\n    this.axModel = target.model(SDK.AccessibilityModel.AccessibilityModel) as SDK.AccessibilityModel.AccessibilityModel;\n  }\n\n  async isSubmitButton(targetId: string): Promise<unknown> {\n    function innerIsSubmitButton(this: HTMLButtonElement): boolean {\n      return this.tagName === 'BUTTON' && this.type === 'submit' && this.form !== null;\n    }\n\n    const {result} = await this.runtimeAgent.invoke_callFunctionOn({\n      functionDeclaration: innerIsSubmitButton.toString(),\n      objectId: targetId,\n    });\n    return result.value;\n  }\n\n  async getSelector(node: SDK.DOMModel.DOMNode): Promise<string|null> {\n    const ariaSelector = await this.getAriaSelector(node);\n    if (ariaSelector) {\n      return ariaSelector;\n    }\n\n    const cssSelector = Elements.DOMPath.cssPath(node);\n    if (cssSelector) {\n      return cssSelector;\n    }\n\n    return null;\n  }\n\n  async findTargetId(localFrame: Protocol.Runtime.PropertyDescriptor[], interestingClassNames: string[]):\n      Promise<string|null|undefined> {\n    const event = localFrame.find(\n        prop => Boolean(\n            prop && prop.value && prop.value.className && interestingClassNames.includes(prop.value.className)));\n\n    if (!event || !event.value || !event.value.objectId) {\n      return null;\n    }\n\n    const eventProperties = await this.runtimeAgent.invoke_getProperties({\n      objectId: event.value.objectId,\n    });\n\n    if (!eventProperties) {\n      return null;\n    }\n\n    const target = eventProperties.result.find(prop => prop.name === 'target');\n\n    if (!target || !target.value) {\n      return null;\n    }\n\n    return target.value.objectId || null;\n  }\n\n  async getAriaSelector(node: SDK.DOMModel.DOMNode): Promise<string|null> {\n    await this.axModel.requestPartialAXTree(node);\n    let axNode = this.axModel.axNodeForDOMNode(node);\n    while (axNode) {\n      const roleObject = axNode.role();\n      const nameObject = axNode.name();\n      const role = roleObject ? roleObject.value : null;\n      const name = nameObject ? nameObject.value : null;\n      if (name && RELEVANT_ROLES_FOR_ARIA_SELECTORS.has(role)) {\n        return `aria/${name}`;\n      }\n      axNode = axNode.parentNode();\n    }\n    return null;\n  }\n\n  async handleClickEvent(context: StepFrameContext, localFrame: Protocol.Runtime.PropertyDescriptor[]): Promise<void> {\n    const targetId = await this.findTargetId(localFrame, [\n      'MouseEvent',\n      'PointerEvent',\n    ]);\n\n    if (!targetId) {\n      this.skip();\n      return;\n    }\n\n    const node = await this.domModel.pushNodeToFrontend(targetId);\n    if (!node) {\n      throw new Error('Node should not be null.');\n    }\n\n    // Clicking on a submit button will emit a submit event\n    // which will be handled in a different handler.\n    if (node.nodeName() === 'BUTTON' && node.getAttribute('type') === 'submit') {\n      this.skip();\n      return;\n    }\n\n    const selector = await this.getSelector(node);\n    if (!selector) {\n      throw new Error('Could not find selector');\n    }\n    this.session.appendStepToScript(new ClickStep(context, selector));\n    await this.resume();\n  }\n\n  async handleSubmitEvent(context: StepFrameContext, localFrame: Protocol.Runtime.PropertyDescriptor[]): Promise<void> {\n    const targetId = await this.findTargetId(localFrame, [\n      'SubmitEvent',\n    ]);\n\n    if (!targetId) {\n      this.skip();\n      return;\n    }\n\n    const node = await this.domModel.pushNodeToFrontend(targetId);\n    if (!node) {\n      throw new Error('Node should not be null.');\n    }\n\n    const selector = await this.getSelector(node);\n    if (!selector) {\n      throw new Error('Could not find selector');\n    }\n\n    this.session.appendStepToScript(new SubmitStep(context, selector));\n    await this.resume();\n  }\n\n  async handleChangeEvent(context: StepFrameContext, localFrame: Protocol.Runtime.PropertyDescriptor[]): Promise<void> {\n    const targetId = await this.findTargetId(localFrame, [\n      'Event',\n    ]);\n\n    if (!targetId) {\n      this.skip();\n      return;\n    }\n\n    const node = await this.domModel.pushNodeToFrontend(targetId);\n    if (!node) {\n      throw new Error('Node should not be null.');\n    }\n\n    const selector = await this.getSelector(node);\n    if (!selector) {\n      throw new Error('Could not find selector');\n    }\n\n    function getValue(this: HTMLInputElement): string {\n      return this.value;\n    }\n\n    const {result} = await this.runtimeAgent.invoke_callFunctionOn({\n      functionDeclaration: getValue.toString(),\n      objectId: targetId,\n    });\n    this.session.appendStepToScript(new ChangeStep(context, selector, result.value as string));\n    await this.resume();\n  }\n\n  getTarget(): string {\n    return this.target.id() === 'main' ? 'main' : this.target.inspectedURL();\n  }\n\n  getContextForFrame(frame: SDK.ResourceTreeModel.ResourceTreeFrame): StepFrameContext {\n    const path = [];\n    let currentFrame: SDK.ResourceTreeModel.ResourceTreeFrame = frame;\n    while (currentFrame) {\n      const parentFrame = currentFrame.parentFrame();\n      if (!parentFrame) {\n        break;\n      }\n\n      const childFrames = parentFrame.childFrames;\n      const index = childFrames.indexOf(currentFrame);\n      path.unshift(index);\n      currentFrame = parentFrame;\n    }\n\n    const target = this.getTarget();\n    return new StepFrameContext(target, path);\n  }\n\n  async resume(): Promise<void> {\n    await this.debuggerAgent.invoke_setSkipAllPauses({skip: true});\n    await this.debuggerAgent.invoke_resume({terminateOnResume: false});\n    await this.debuggerAgent.invoke_setSkipAllPauses({skip: false});\n  }\n\n  async skip(): Promise<void> {\n    await this.debuggerAgent.invoke_resume({terminateOnResume: false});\n  }\n\n  paused(params: Protocol.Debugger.PausedEvent): void {\n    if (params.reason !== 'EventListener') {\n      this.skip();\n      return;\n    }\n\n    const eventName = params.data.eventName;\n    const localFrame = params.callFrames[0].scopeChain[0];\n\n    const scriptId = params.callFrames[0].location.scriptId;\n    const executionContextId = this.runtimeModel.executionContextIdForScriptId(scriptId);\n    const executionContext = this.runtimeModel.executionContext(executionContextId);\n    if (!executionContext) {\n      throw new Error('Could not find execution context.');\n    }\n    if (!executionContext.frameId) {\n      throw new Error('Execution context is not assigned to a frame.');\n    }\n    const frame = this.resourceTreeModel.frameForId(executionContext.frameId);\n    if (!frame) {\n      throw new Error('Could not find frame.');\n    }\n\n    const context = this.getContextForFrame(frame);\n\n    if (!localFrame.object.objectId) {\n      return;\n    }\n    this.runtimeAgent.invoke_getProperties({objectId: localFrame.object.objectId}).then(async ({result}) => {\n      switch (eventName) {\n        case 'listener:click':\n          return this.handleClickEvent(context, result);\n        case 'listener:submit':\n          return this.handleSubmitEvent(context, result);\n        case 'listener:change':\n          return this.handleChangeEvent(context, result);\n        default:\n          this.skip();\n      }\n    });\n  }\n\n  targetDestroyed(): void {\n    this.session.appendStepToScript(new CloseStep(this.getTarget()));\n  }\n\n  breakpointResolved(): void {\n    // Added here to fullfill the ProtocolProxyApi.DebuggerDispatcher interface.\n  }\n\n  resumed(): void {\n    // Added here to fullfill the ProtocolProxyApi.DebuggerDispatcher interface.\n  }\n\n  scriptFailedToParse(): void {\n    // Added here to fullfill the ProtocolProxyApi.DebuggerDispatcher interface.\n  }\n\n  scriptParsed(): void {\n    // Added here to fullfill the ProtocolProxyApi.DebuggerDispatcher interface.\n  }\n}\n"]}