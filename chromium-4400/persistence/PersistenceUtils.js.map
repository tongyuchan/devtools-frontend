{"version":3,"file":"PersistenceUtils.js","sourceRoot":"","sources":["../../../../../front_end/persistence/PersistenceUtils.js"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2016 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../common/common.js';\nimport * as Components from '../components/components.js';\nimport * as i18n from '../i18n/i18n.js';\nimport * as Platform from '../platform/platform.js';\nimport * as UI from '../ui/ui.js';\nimport * as Workspace from '../workspace/workspace.js';\n\nimport {FileSystemWorkspaceBinding} from './FileSystemWorkspaceBinding.js';\nimport {NetworkPersistenceManager} from './NetworkPersistenceManager.js';\nimport {Events, PersistenceBinding, PersistenceImpl} from './PersistenceImpl.js';  // eslint-disable-line no-unused-vars\n\nexport const UIStrings = {\n  /**\n  *@description Text in Persistence Utils of the Workspace settings in Settings\n  *@example {example.url} PH1\n  */\n  linkedToSourceMapS: 'Linked to source map: {PH1}',\n  /**\n  *@description Text to show something is linked to another\n  *@example {example.url} PH1\n  */\n  linkedToS: 'Linked to {PH1}',\n};\nconst str_ = i18n.i18n.registerUIStrings('persistence/PersistenceUtils.js', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nexport class PersistenceUtils {\n  /**\n   * @param {!Workspace.UISourceCode.UISourceCode} uiSourceCode\n   * @return {string}\n   */\n  static tooltipForUISourceCode(uiSourceCode) {\n    const binding = PersistenceImpl.instance().binding(uiSourceCode);\n    if (!binding) {\n      return '';\n    }\n    if (uiSourceCode === binding.network) {\n      return FileSystemWorkspaceBinding.tooltipForUISourceCode(binding.fileSystem);\n    }\n    if (binding.network.contentType().isFromSourceMap()) {\n      return i18nString(\n          UIStrings.linkedToSourceMapS, {PH1: Platform.StringUtilities.trimMiddle(binding.network.url(), 150)});\n    }\n    return i18nString(UIStrings.linkedToS, {PH1: Platform.StringUtilities.trimMiddle(binding.network.url(), 150)});\n  }\n\n  /**\n   * @param {!Workspace.UISourceCode.UISourceCode} uiSourceCode\n   * @return {?UI.Icon.Icon}\n   */\n  static iconForUISourceCode(uiSourceCode) {\n    const binding = PersistenceImpl.instance().binding(uiSourceCode);\n    if (binding) {\n      if (!binding.fileSystem.url().startsWith('file://')) {\n        return null;\n      }\n      const icon = UI.Icon.Icon.create('mediumicon-file-sync');\n      UI.Tooltip.Tooltip.install(icon, PersistenceUtils.tooltipForUISourceCode(binding.network));\n      // TODO(allada) This will not work properly with dark theme.\n      if (NetworkPersistenceManager.instance().project() === binding.fileSystem.project()) {\n        icon.style.filter = 'hue-rotate(160deg)';\n      }\n      return icon;\n    }\n    if (uiSourceCode.project().type() !== Workspace.Workspace.projectTypes.FileSystem ||\n        !uiSourceCode.url().startsWith('file://')) {\n      return null;\n    }\n\n    const icon = UI.Icon.Icon.create('mediumicon-file');\n    UI.Tooltip.Tooltip.install(icon, PersistenceUtils.tooltipForUISourceCode(uiSourceCode));\n    return icon;\n  }\n}\n\n/**\n * @extends {Common.ObjectWrapper.ObjectWrapper}\n * @implements {Components.Linkifier.LinkDecorator}\n */\nexport class LinkDecorator extends Common.ObjectWrapper.ObjectWrapper {\n  /**\n   * @param {!PersistenceImpl} persistence\n   */\n  constructor(persistence) {\n    super();\n    persistence.addEventListener(Events.BindingCreated, this._bindingChanged, this);\n    persistence.addEventListener(Events.BindingRemoved, this._bindingChanged, this);\n  }\n\n  /**\n   * @param {!Common.EventTarget.EventTargetEvent} event\n   */\n  _bindingChanged(event) {\n    const binding = /** @type {!PersistenceBinding} */ (event.data);\n    this.dispatchEventToListeners(Components.Linkifier.LinkDecorator.Events.LinkIconChanged, binding.network);\n  }\n\n  /**\n   * @override\n   * @param {!Workspace.UISourceCode.UISourceCode} uiSourceCode\n   * @return {?UI.Icon.Icon}\n   */\n  linkIcon(uiSourceCode) {\n    return PersistenceUtils.iconForUISourceCode(uiSourceCode);\n  }\n}\n"]}