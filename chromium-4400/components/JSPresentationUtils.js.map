{"version":3,"file":"JSPresentationUtils.js","sourceRoot":"","sources":["../../../../../front_end/components/JSPresentationUtils.js"],"names":[],"mappings":"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","sourcesContent":["/*\n * Copyright (C) 2011 Google Inc.  All rights reserved.\n * Copyright (C) 2007, 2008 Apple Inc.  All rights reserved.\n * Copyright (C) 2008 Matt Lilek <webkit@mattlilek.com>\n * Copyright (C) 2009 Joseph Pecoraro\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *\n * 1.  Redistributions of source code must retain the above copyright\n *     notice, this list of conditions and the following disclaimer.\n * 2.  Redistributions in binary form must reproduce the above copyright\n *     notice, this list of conditions and the following disclaimer in the\n *     documentation and/or other materials provided with the distribution.\n * 3.  Neither the name of Apple Computer, Inc. (\"Apple\") nor the names of\n *     its contributors may be used to endorse or promote products derived\n *     from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS \"AS IS\" AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\n * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport * as Bindings from '../bindings/bindings.js';\nimport * as i18n from '../i18n/i18n.js';\nimport * as SDK from '../sdk/sdk.js';  // eslint-disable-line no-unused-vars\nimport * as UI from '../ui/ui.js';\n\nimport {Linkifier} from './Linkifier.js';\n\nexport const UIStrings = {\n  /**\n  *@description Text to stop preventing the debugger from stepping into library code\n  */\n  removeFromIgnore: 'Remove from ignore list',\n  /**\n  *@description Text for scripts that should not be stepped into when debugging\n  */\n  addToIgnore: 'Add script to ignore list',\n  /**\n  *@description Show all link text content in JSPresentation Utils\n  */\n  showMoreFrame: 'Show 1 more frame',\n  /**\n  *@description Show all link text content in JSPresentation Utils\n  *@example {2} PH1\n  */\n  showSMoreFrames: 'Show {PH1} more frames',\n  /**\n   *@description Text indicating that source url of a link is currently unknown\n   */\n  unknownSource: 'unknown',\n};\nconst str_ = i18n.i18n.registerUIStrings('components/JSPresentationUtils.js', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n/**\n * @param {?SDK.SDKModel.Target} target\n * @param {!Linkifier} linkifier\n * @param {!Options=} options\n * @return {{element: !HTMLElement, links: !Array<!HTMLElement>}}\n */\nexport function buildStackTracePreviewContents(target, linkifier, options = {\n  stackTrace: undefined,\n  contentUpdated: undefined,\n  tabStops: undefined\n}) {\n  const {stackTrace, contentUpdated, tabStops} = options;\n  const element = /** @type {!HTMLElement} */ (document.createElement('span'));\n  element.classList.add('monospace');\n  element.style.display = 'inline-block';\n  const shadowRoot = UI.Utils.createShadowRootWithCoreStyles(\n      element, {cssFile: 'components/jsUtils.css', enableLegacyPatching: false, delegatesFocus: undefined});\n  const contentElement = shadowRoot.createChild('table', 'stack-preview-container');\n  let totalHiddenCallFramesCount = 0;\n  let totalCallFramesCount = 0;\n  /** @type {!Array<!HTMLElement>} */\n  const links = [];\n\n  /**\n   * @param {!Protocol.Runtime.StackTrace} stackTrace\n   * @return {boolean}\n   */\n  function appendStackTrace(stackTrace) {\n    let hiddenCallFrames = 0;\n    for (const stackFrame of stackTrace.callFrames) {\n      totalCallFramesCount++;\n      let shouldHide = totalCallFramesCount > 30 && stackTrace.callFrames.length > 31;\n      const row = document.createElement('tr');\n      row.createChild('td').textContent = '\\n';\n      row.createChild('td', 'function-name').textContent = UI.UIUtils.beautifyFunctionName(stackFrame.functionName);\n      const link = linkifier.maybeLinkifyConsoleCallFrame(\n          target, stackFrame, {tabStop: Boolean(tabStops), className: undefined, columnNumber: undefined});\n      if (link) {\n        link.addEventListener('contextmenu', populateContextMenu.bind(null, link));\n        const uiLocation = Linkifier.uiLocation(link);\n        if (uiLocation &&\n            Bindings.IgnoreListManager.IgnoreListManager.instance().isIgnoreListedUISourceCode(\n                uiLocation.uiSourceCode)) {\n          shouldHide = true;\n        }\n        row.createChild('td').textContent = ' @ ';\n        row.createChild('td').appendChild(link);\n        // Linkifier is using a workaround with the 'zero width space' (\\u200b).\n        // TODO(szuend): Remove once the Linkfier is no longer using the workaround.\n        if (!link.textContent || link.textContent === '\\u200b') {\n          link.textContent = i18nString(UIStrings.unknownSource);\n        }\n        links.push(link);\n      }\n      if (shouldHide) {\n        row.classList.add('ignore-listed');\n        ++hiddenCallFrames;\n      }\n      contentElement.appendChild(row);\n    }\n    totalHiddenCallFramesCount += hiddenCallFrames;\n    return stackTrace.callFrames.length === hiddenCallFrames;\n  }\n\n  /**\n   * @param {!Element} link\n   * @param {!Event} event\n   */\n  function populateContextMenu(link, event) {\n    const contextMenu = new UI.ContextMenu.ContextMenu(event);\n    event.consume(true);\n    const uiLocation = Linkifier.uiLocation(link);\n    if (uiLocation &&\n        Bindings.IgnoreListManager.IgnoreListManager.instance().canIgnoreListUISourceCode(uiLocation.uiSourceCode)) {\n      if (Bindings.IgnoreListManager.IgnoreListManager.instance().isIgnoreListedUISourceCode(uiLocation.uiSourceCode)) {\n        contextMenu.debugSection().appendItem(\n            i18nString(UIStrings.removeFromIgnore),\n            () => Bindings.IgnoreListManager.IgnoreListManager.instance().unIgnoreListUISourceCode(\n                uiLocation.uiSourceCode));\n      } else {\n        contextMenu.debugSection().appendItem(\n            i18nString(UIStrings.addToIgnore),\n            () => Bindings.IgnoreListManager.IgnoreListManager.instance().ignoreListUISourceCode(\n                uiLocation.uiSourceCode));\n      }\n    }\n    contextMenu.appendApplicableItems(event);\n    contextMenu.show();\n  }\n\n  if (!stackTrace) {\n    return {element, links};\n  }\n\n  appendStackTrace(stackTrace);\n\n  let asyncStackTrace = stackTrace.parent;\n  while (asyncStackTrace) {\n    if (!asyncStackTrace.callFrames.length) {\n      asyncStackTrace = asyncStackTrace.parent;\n      continue;\n    }\n    const row = contentElement.createChild('tr');\n    row.createChild('td').textContent = '\\n';\n    row.createChild('td', 'stack-preview-async-description').textContent =\n        UI.UIUtils.asyncStackTraceLabel(asyncStackTrace.description);\n    row.createChild('td');\n    row.createChild('td');\n    if (appendStackTrace(asyncStackTrace)) {\n      row.classList.add('ignore-listed');\n    }\n    asyncStackTrace = asyncStackTrace.parent;\n  }\n\n  if (totalHiddenCallFramesCount) {\n    const row = contentElement.createChild('tr', 'show-ignore-listed-link');\n    row.createChild('td').textContent = '\\n';\n    const cell = /** @type {!HTMLTableCellElement} */ (row.createChild('td'));\n    cell.colSpan = 4;\n    const showAllLink = cell.createChild('span', 'link');\n    if (totalHiddenCallFramesCount === 1) {\n      showAllLink.textContent = i18nString(UIStrings.showMoreFrame);\n    } else {\n      showAllLink.textContent = i18nString(UIStrings.showSMoreFrames, {PH1: totalHiddenCallFramesCount});\n    }\n    showAllLink.addEventListener('click', () => {\n      contentElement.classList.add('show-ignore-listed');\n      if (contentUpdated) {\n        contentUpdated();\n      }\n    }, false);\n  }\n\n  return {element, links};\n}\n\n/**\n * @typedef {{\n *   stackTrace: (!Protocol.Runtime.StackTrace|undefined),\n *   contentUpdated: ((function(): *) | undefined),\n *   tabStops: (boolean|undefined)\n * }}\n */\n// @ts-ignore typedef\nexport let Options;\n"]}