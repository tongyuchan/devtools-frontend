{"version":3,"file":"EventsTimelineTreeView.js","sourceRoot":"","sources":["../../../../../front_end/timeline/EventsTimelineTreeView.js"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2017 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../common/common.js';\nimport * as DataGrid from '../data_grid/data_grid.js';\nimport {ls} from '../platform/platform.js';\nimport * as SDK from '../sdk/sdk.js';                                  // eslint-disable-line no-unused-vars\nimport * as TimelineModel from '../timeline_model/timeline_model.js';  // eslint-disable-line no-unused-vars\nimport * as UI from '../ui/ui.js';\n\nimport {Category, IsLong} from './TimelineFilters.js';\nimport {TimelineModeViewDelegate, TimelineSelection} from './TimelinePanel.js';  // eslint-disable-line no-unused-vars\nimport {TimelineTreeView} from './TimelineTreeView.js';\nimport {TimelineUIUtils} from './TimelineUIUtils.js';\n\nexport class EventsTimelineTreeView extends TimelineTreeView {\n  /**\n   * @param {!TimelineModeViewDelegate} delegate\n   */\n  constructor(delegate) {\n    super();\n    this._filtersControl = new Filters();\n    this._filtersControl.addEventListener(Filters.Events.FilterChanged, this._onFilterChanged, this);\n    this.init();\n    this._delegate = delegate;\n    this.dataGrid.markColumnAsSortedBy('startTime', DataGrid.DataGrid.Order.Ascending);\n    this.splitWidget.showBoth();\n\n    /** @type {!TimelineModel.TimelineProfileTree.Node} */\n    this._currentTree;\n  }\n\n  /**\n   * @override\n   * @protected\n   * @return {!Array<!TimelineModel.TimelineModelFilter.TimelineModelFilter>}\n   */\n  filters() {\n    return [...super.filters(), ...this._filtersControl.filters()];\n  }\n\n  /**\n   * @override\n   * @param {!TimelineSelection} selection\n   */\n  updateContents(selection) {\n    super.updateContents(selection);\n    if (selection.type() === TimelineSelection.Type.TraceEvent) {\n      const event = /** @type {!SDK.TracingModel.Event} */ (selection.object());\n      this._selectEvent(event, true);\n    }\n  }\n\n  /**\n   * @override\n   * @return {string}\n   */\n  getToolbarInputAccessiblePlaceHolder() {\n    return ls`Filter event log`;\n  }\n\n  /**\n   * @override\n   * @return {!TimelineModel.TimelineProfileTree.Node}\n   */\n  _buildTree() {\n    this._currentTree = this.buildTopDownTree(true, null);\n    return this._currentTree;\n  }\n\n  _onFilterChanged() {\n    const lastSelectedNode = this.lastSelectedNode();\n    const selectedEvent = lastSelectedNode && lastSelectedNode.event;\n    this.refreshTree();\n    if (selectedEvent) {\n      this._selectEvent(selectedEvent, false);\n    }\n  }\n\n  /**\n   * @param {!SDK.TracingModel.Event} event\n   * @return {?TimelineModel.TimelineProfileTree.Node}\n   */\n  _findNodeWithEvent(event) {\n    const iterators = [this._currentTree.children().values()];\n\n    while (iterators.length) {\n      // @ts-ignore crbug.com/1011811 there is no common iterator type between Closure and TypeScript\n      const iterator = iterators[iterators.length - 1].next();\n      if (iterator.done) {\n        iterators.pop();\n        continue;\n      }\n      const child = /** @type {!TimelineModel.TimelineProfileTree.Node} */ (iterator.value);\n      if (child.event === event) {\n        return child;\n      }\n      iterators.push(child.children().values());\n    }\n    return null;\n  }\n\n  /**\n   * @param {!SDK.TracingModel.Event} event\n   * @param {boolean=} expand\n   */\n  _selectEvent(event, expand) {\n    const node = this._findNodeWithEvent(event);\n    if (!node) {\n      return;\n    }\n    this.selectProfileNode(node, false);\n    if (expand) {\n      const dataGridNode = this.dataGridNodeForTreeNode(node);\n      if (dataGridNode) {\n        dataGridNode.expand();\n      }\n    }\n  }\n\n  /**\n   * @override\n   * @param {!Array<!DataGrid.DataGrid.ColumnDescriptor>} columns\n   */\n  populateColumns(columns) {\n    columns.push(/** @type {!DataGrid.DataGrid.ColumnDescriptor} */ ({\n      id: 'startTime',\n      title: Common.UIString.UIString('Start Time'),\n      width: '80px',\n      fixedWidth: true,\n      sortable: true,\n    }));\n    super.populateColumns(columns);\n    columns.filter(c => c.fixedWidth).forEach(c => {\n      c.width = '80px';\n    });\n  }\n\n  /**\n   * @override\n   * @param {!UI.Toolbar.Toolbar} toolbar\n   */\n  populateToolbar(toolbar) {\n    super.populateToolbar(toolbar);\n    this._filtersControl.populateToolbar(toolbar);\n  }\n\n  /**\n   * @override\n   * @param {!TimelineModel.TimelineProfileTree.Node} node\n   * @return {boolean}\n   */\n  _showDetailsForNode(node) {\n    const traceEvent = node.event;\n    if (!traceEvent) {\n      return false;\n    }\n    const model = this.model();\n    if (!model) {\n      return false;\n    }\n    TimelineUIUtils.buildTraceEventDetails(traceEvent, model.timelineModel(), this.linkifier, false)\n        .then(fragment => this.detailsView.element.appendChild(fragment));\n    return true;\n  }\n\n  /**\n   * @override\n   * @param {?TimelineModel.TimelineProfileTree.Node} node\n   */\n  _onHover(node) {\n    this._delegate.highlightEvent(node && node.event);\n  }\n}\n\nexport class Filters extends Common.ObjectWrapper.ObjectWrapper {\n  constructor() {\n    super();\n    this._categoryFilter = new Category();\n    this._durationFilter = new IsLong();\n    this._filters = [this._categoryFilter, this._durationFilter];\n  }\n\n  /**\n   * @return {!Array<!TimelineModel.TimelineModelFilter.TimelineModelFilter>}\n   */\n  filters() {\n    return this._filters;\n  }\n\n  /**\n   * @param {!UI.Toolbar.Toolbar} toolbar\n   */\n  populateToolbar(toolbar) {\n    const durationFilterUI = new UI.Toolbar.ToolbarComboBox(durationFilterChanged.bind(this), ls`Duration filter`);\n    for (const durationMs of Filters._durationFilterPresetsMs) {\n      durationFilterUI.addOption(durationFilterUI.createOption(\n          durationMs ? Common.UIString.UIString('\\u2265 %d\\xa0ms', durationMs) : Common.UIString.UIString('All'),\n          String(durationMs)));\n    }\n    toolbar.appendToolbarItem(durationFilterUI);\n\n    /** @type {!Map<string, !UI.Toolbar.ToolbarCheckbox>} */\n    const categoryFiltersUI = new Map();\n    const categories = TimelineUIUtils.categories();\n    for (const categoryName in categories) {\n      const category = categories[categoryName];\n      if (!category.visible) {\n        continue;\n      }\n      const checkbox =\n          new UI.Toolbar.ToolbarCheckbox(category.title, undefined, categoriesFilterChanged.bind(this, categoryName));\n      checkbox.setChecked(true);\n      checkbox.inputElement.style.backgroundColor = category.color;\n      categoryFiltersUI.set(category.name, checkbox);\n      toolbar.appendToolbarItem(checkbox);\n    }\n\n    /**\n     * @this {Filters}\n     */\n    function durationFilterChanged() {\n      const duration = /** @type {!HTMLOptionElement} */ (durationFilterUI.selectedOption()).value;\n      const minimumRecordDuration = parseInt(duration, 10);\n      this._durationFilter.setMinimumRecordDuration(minimumRecordDuration);\n      this._notifyFiltersChanged();\n    }\n\n    /**\n     * @param {string} name\n     * @this {Filters}\n     */\n    function categoriesFilterChanged(name) {\n      const categories = TimelineUIUtils.categories();\n      const checkBox = categoryFiltersUI.get(name);\n      categories[name].hidden = !checkBox || !checkBox.checked();\n      this._notifyFiltersChanged();\n    }\n  }\n\n  _notifyFiltersChanged() {\n    this.dispatchEventToListeners(Filters.Events.FilterChanged);\n  }\n}\n\nFilters._durationFilterPresetsMs = [0, 1, 15];\n\n/** @enum {symbol} */\nFilters.Events = {\n  FilterChanged: Symbol('FilterChanged')\n};\n"]}