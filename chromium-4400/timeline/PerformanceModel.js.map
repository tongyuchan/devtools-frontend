{"version":3,"file":"PerformanceModel.js","sourceRoot":"","sources":["../../../../../front_end/timeline/PerformanceModel.js"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2017 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Bindings from '../bindings/bindings.js';  // eslint-disable-line no-unused-vars\nimport * as Common from '../common/common.js';\nimport * as SDK from '../sdk/sdk.js';\nimport * as TimelineModel from '../timeline_model/timeline_model.js';\n\nimport {TimelineUIUtils} from './TimelineUIUtils.js';\n\nexport class PerformanceModel extends Common.ObjectWrapper.ObjectWrapper {\n  constructor() {\n    super();\n    /** @type {?SDK.SDKModel.Target} */\n    this._mainTarget = null;\n    /** @type {?SDK.TracingModel.TracingModel} */\n    this._tracingModel = null;\n    /** @type {!Array<!TimelineModel.TimelineModelFilter.TimelineModelFilter>} */\n    this._filters = [];\n\n    this._timelineModel = new TimelineModel.TimelineModel.TimelineModelImpl();\n    this._frameModel = new TimelineModel.TimelineFrameModel.TimelineFrameModel(\n        event => TimelineUIUtils.eventStyle(event).category.name);\n    /** @type {?SDK.FilmStripModel.FilmStripModel} */\n    this._filmStripModel = null;\n    /** @type {!TimelineModel.TimelineIRModel.TimelineIRModel} */\n    this._irModel = new TimelineModel.TimelineIRModel.TimelineIRModel();\n\n    /** @type {!Window} */\n    this._window = {left: 0, right: Infinity};\n\n    /** @type {!Array<!{title: string, model: !SDK.TracingModel.TracingModel, timeOffset: number}>} */\n    this._extensionTracingModels = [];\n    /** @type {number|undefined} */\n    this._recordStartTime = undefined;\n  }\n\n  /**\n   * @param {!SDK.SDKModel.Target} target\n   */\n  setMainTarget(target) {\n    this._mainTarget = target;\n  }\n\n  /**\n   * @return {?SDK.SDKModel.Target}\n   */\n  mainTarget() {\n    return this._mainTarget;\n  }\n\n  /**\n   * @param {number} time\n   */\n  setRecordStartTime(time) {\n    this._recordStartTime = time;\n  }\n\n  /**\n   * @return {number|undefined}\n   */\n  recordStartTime() {\n    return this._recordStartTime;\n  }\n\n  /**\n   * @param {!Array<!TimelineModel.TimelineModelFilter.TimelineModelFilter>} filters\n   */\n  setFilters(filters) {\n    this._filters = filters;\n  }\n\n  /**\n   * @return {!Array<!TimelineModel.TimelineModelFilter.TimelineModelFilter>}\n   */\n  filters() {\n    return this._filters;\n  }\n\n  /**\n   * @param {!SDK.TracingModel.Event} event\n   * @return {boolean}\n   */\n  isVisible(event) {\n    return this._filters.every(f => f.accept(event));\n  }\n\n  /**\n   * @param {!SDK.TracingModel.TracingModel} model\n   */\n  setTracingModel(model) {\n    this._tracingModel = model;\n    this._timelineModel.setEvents(model);\n\n    let inputEvents = null;\n    let animationEvents = null;\n    for (const track of this._timelineModel.tracks()) {\n      if (track.type === TimelineModel.TimelineModel.TrackType.Input) {\n        inputEvents = track.asyncEvents;\n      }\n      if (track.type === TimelineModel.TimelineModel.TrackType.Animation) {\n        animationEvents = track.asyncEvents;\n      }\n    }\n    if (inputEvents || animationEvents) {\n      this._irModel.populate(inputEvents || [], animationEvents || []);\n    }\n\n    const mainTracks = this._timelineModel.tracks().filter(\n        track => track.type === TimelineModel.TimelineModel.TrackType.MainThread && track.forMainFrame &&\n            track.events.length);\n    const threadData = mainTracks.map(track => {\n      const event = track.events[0];\n      return {thread: event.thread, time: event.startTime};\n    });\n    this._frameModel.addTraceEvents(this._mainTarget, this._timelineModel.inspectedTargetEvents(), threadData);\n\n    for (const entry of this._extensionTracingModels) {\n      entry.model.adjustTime(\n          this._tracingModel.minimumRecordTime() + (entry.timeOffset / 1000) -\n          /** @type {number} */ (this._recordStartTime));\n    }\n    this._autoWindowTimes();\n  }\n\n  /**\n   * @param {string} title\n   * @param {!SDK.TracingModel.TracingModel} model\n   * @param {number} timeOffset\n   */\n  addExtensionEvents(title, model, timeOffset) {\n    this._extensionTracingModels.push({model: model, title: title, timeOffset: timeOffset});\n    if (!this._tracingModel) {\n      return;\n    }\n    model.adjustTime(\n        this._tracingModel.minimumRecordTime() + (timeOffset / 1000) - /** @type {number} */ (this._recordStartTime));\n    this.dispatchEventToListeners(Events.ExtensionDataAdded);\n  }\n\n  /**\n   * @return {!SDK.TracingModel.TracingModel}\n   */\n  tracingModel() {\n    if (!this._tracingModel) {\n      throw 'call setTracingModel before accessing PerformanceModel';\n    }\n    return this._tracingModel;\n  }\n\n  /**\n   * @return {!TimelineModel.TimelineModel.TimelineModelImpl}\n   */\n  timelineModel() {\n    return this._timelineModel;\n  }\n\n  /**\n   * @return {!SDK.FilmStripModel.FilmStripModel} filmStripModel\n   */\n  filmStripModel() {\n    if (this._filmStripModel) {\n      return this._filmStripModel;\n    }\n    if (!this._tracingModel) {\n      throw 'call setTracingModel before accessing PerformanceModel';\n    }\n    this._filmStripModel = new SDK.FilmStripModel.FilmStripModel(this._tracingModel);\n    return this._filmStripModel;\n  }\n\n  /**\n   * @return {!Array<!TimelineModel.TimelineFrameModel.TimelineFrame>} frames\n   */\n  frames() {\n    return this._frameModel.frames();\n  }\n\n  /**\n   * @return {!TimelineModel.TimelineFrameModel.TimelineFrameModel} frames\n   */\n  frameModel() {\n    return this._frameModel;\n  }\n\n  /**\n   * @return {!Array<!Common.SegmentedRange.Segment>}\n   */\n  interactionRecords() {\n    return this._irModel.interactionRecords();\n  }\n\n  /**\n   * @return {!Array<!{title: string, model: !SDK.TracingModel.TracingModel}>}\n   */\n  extensionInfo() {\n    return this._extensionTracingModels;\n  }\n\n  dispose() {\n    if (this._tracingModel) {\n      this._tracingModel.dispose();\n    }\n    for (const extensionEntry of this._extensionTracingModels) {\n      extensionEntry.model.dispose();\n    }\n  }\n\n  /**\n   * @param {!TimelineModel.TimelineFrameModel.TimelineFrame} frame\n   * @return {?SDK.FilmStripModel.Frame}\n   */\n  filmStripModelFrame(frame) {\n    // For idle frames, look at the state at the beginning of the frame.\n    const screenshotTime = frame.idle ? frame.startTime : frame.endTime;\n    const filmStripModel = /** @type {!SDK.FilmStripModel.FilmStripModel} */ (this._filmStripModel);\n    const filmStripFrame = filmStripModel.frameByTimestamp(screenshotTime);\n    return filmStripFrame && filmStripFrame.timestamp - frame.endTime < 10 ? filmStripFrame : null;\n  }\n\n  /**\n   * @param {!Common.StringOutputStream.OutputStream} stream\n   * @return {!Promise<?DOMError>}\n   */\n  save(stream) {\n    if (!this._tracingModel) {\n      throw 'call setTracingModel before accessing PerformanceModel';\n    }\n    const backingStorage =\n        /** @type {!Bindings.TempFile.TempFileBackingStorage} */ (this._tracingModel.backingStorage());\n    return backingStorage.writeToStream(stream);\n  }\n\n  /**\n   * @param {!Window} window\n   * @param {boolean=} animate\n   */\n  setWindow(window, animate) {\n    this._window = window;\n    this.dispatchEventToListeners(Events.WindowChanged, {window, animate});\n  }\n\n  /**\n   * @return {!Window}\n   */\n  window() {\n    return this._window;\n  }\n\n  _autoWindowTimes() {\n    const timelineModel = this._timelineModel;\n    /** @type {!Array<!SDK.TracingModel.Event>} */\n    let tasks = [];\n    for (const track of timelineModel.tracks()) {\n      // Deliberately pick up last main frame's track.\n      if (track.type === TimelineModel.TimelineModel.TrackType.MainThread && track.forMainFrame) {\n        tasks = track.tasks;\n      }\n    }\n    if (!tasks.length) {\n      this.setWindow({left: timelineModel.minimumRecordTime(), right: timelineModel.maximumRecordTime()});\n      return;\n    }\n\n    /**\n     * @param {number} startIndex\n     * @param {number} stopIndex\n     * @return {number}\n     */\n    function findLowUtilizationRegion(startIndex, stopIndex) {\n      const threshold = 0.1;\n      let cutIndex = startIndex;\n      let cutTime = (tasks[cutIndex].startTime + /** @type {number} */ (tasks[cutIndex].endTime)) / 2;\n      let usedTime = 0;\n      const step = Math.sign(stopIndex - startIndex);\n      for (let i = startIndex; i !== stopIndex; i += step) {\n        const task = tasks[i];\n        const taskTime = (task.startTime + /** @type {number} */ (task.endTime)) / 2;\n        const interval = Math.abs(cutTime - taskTime);\n        if (usedTime < threshold * interval) {\n          cutIndex = i;\n          cutTime = taskTime;\n          usedTime = 0;\n        }\n        usedTime += /** @type {number} */ (task.duration);\n      }\n      return cutIndex;\n    }\n    const rightIndex = findLowUtilizationRegion(tasks.length - 1, 0);\n    const leftIndex = findLowUtilizationRegion(0, rightIndex);\n    let leftTime = tasks[leftIndex].startTime;\n    let rightTime = /** @type {number} */ (tasks[rightIndex].endTime);\n    const span = rightTime - leftTime;\n    const totalSpan = timelineModel.maximumRecordTime() - timelineModel.minimumRecordTime();\n    if (span < totalSpan * 0.1) {\n      leftTime = timelineModel.minimumRecordTime();\n      rightTime = timelineModel.maximumRecordTime();\n    } else {\n      leftTime = Math.max(leftTime - 0.05 * span, timelineModel.minimumRecordTime());\n      rightTime = Math.min(rightTime + 0.05 * span, timelineModel.maximumRecordTime());\n    }\n    this.setWindow({left: leftTime, right: rightTime});\n  }\n}\n\n/**\n * @enum {symbol}\n */\nexport const Events = {\n  ExtensionDataAdded: Symbol('ExtensionDataAdded'),\n  WindowChanged: Symbol('WindowChanged')\n};\n\n/** @typedef {!{left: number, right: number}} */\n// @ts-ignore typedef\nexport let Window;\n"]}