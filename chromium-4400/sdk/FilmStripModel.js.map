{"version":3,"file":"FilmStripModel.js","sourceRoot":"","sources":["../../../../../front_end/sdk/FilmStripModel.js"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2015 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Platform from '../platform/platform.js';\n\nimport {Event, ObjectSnapshot, TracingModel} from './TracingModel.js';  // eslint-disable-line no-unused-vars\n\n\nexport class FilmStripModel {\n  /**\n   * @param {!TracingModel} tracingModel\n   * @param {number=} zeroTime\n   */\n  constructor(tracingModel, zeroTime) {\n    /** @type {!Array<!Frame>} */\n    this._frames = [];\n    /** @type {number} */\n    this._zeroTime = 0;\n    /** @type {number} */\n    this._spanTime = 0;\n\n    this.reset(tracingModel, zeroTime);\n  }\n\n  /**\n   * @param {!TracingModel} tracingModel\n   * @param {number=} zeroTime\n   */\n  reset(tracingModel, zeroTime) {\n    this._zeroTime = zeroTime || tracingModel.minimumRecordTime();\n    this._spanTime = tracingModel.maximumRecordTime() - this._zeroTime;\n\n    /** @type {!Array<!Frame>} */\n    this._frames = [];\n    const browserMain = TracingModel.browserMainThread(tracingModel);\n    if (!browserMain) {\n      return;\n    }\n\n    const events = browserMain.events();\n    for (let i = 0; i < events.length; ++i) {\n      const event = events[i];\n      if (event.startTime < this._zeroTime) {\n        continue;\n      }\n      if (!event.hasCategory(_category)) {\n        continue;\n      }\n      if (event.name === TraceEvents.CaptureFrame) {\n        const data = event.args['data'];\n        if (data) {\n          this._frames.push(Frame._fromEvent(this, event, this._frames.length));\n        }\n      } else if (event.name === TraceEvents.Screenshot) {\n        this._frames.push(Frame._fromSnapshot(this, /** @type {!ObjectSnapshot} */ (event), this._frames.length));\n      }\n    }\n  }\n\n  /**\n   * @return {!Array<!Frame>}\n   */\n  frames() {\n    return this._frames;\n  }\n\n  /**\n   * @return {number}\n   */\n  zeroTime() {\n    return this._zeroTime;\n  }\n\n  /**\n   * @return {number}\n   */\n  spanTime() {\n    return this._spanTime;\n  }\n\n  /**\n   * @param {number} timestamp\n   * @return {?Frame}\n   */\n  frameByTimestamp(timestamp) {\n    const index =\n        Platform.ArrayUtilities.upperBound(this._frames, timestamp, (timestamp, frame) => timestamp - frame.timestamp) -\n        1;\n    return index >= 0 ? this._frames[index] : null;\n  }\n}\n\nconst _category = 'disabled-by-default-devtools.screenshot';\n\nconst TraceEvents = {\n  CaptureFrame: 'CaptureFrame',\n  Screenshot: 'Screenshot'\n};\n\nexport class Frame {\n  /**\n   * @param {!FilmStripModel} model\n   * @param {number} timestamp\n   * @param {number} index\n   */\n  constructor(model, timestamp, index) {\n    this._model = model;\n    this.timestamp = timestamp;\n    this.index = index;\n    /** @type {?string} */\n    this._imageData = null;\n    /** @type {?ObjectSnapshot} */\n    this._snapshot = null;\n  }\n\n  /**\n   * @param {!FilmStripModel} model\n   * @param {!Event} event\n   * @param {number} index\n   * @return {!Frame}\n   */\n  static _fromEvent(model, event, index) {\n    const frame = new Frame(model, event.startTime, index);\n    frame._imageData = event.args['data'];\n    return frame;\n  }\n\n  /**\n   * @param {!FilmStripModel} model\n   * @param {!ObjectSnapshot} snapshot\n   * @param {number} index\n   * @return {!Frame}\n   */\n  static _fromSnapshot(model, snapshot, index) {\n    const frame = new Frame(model, snapshot.startTime, index);\n    frame._snapshot = snapshot;\n    return frame;\n  }\n\n  /**\n   * @return {!FilmStripModel}\n   */\n  model() {\n    return this._model;\n  }\n\n  /**\n   * @return {!Promise<?string>}\n   */\n  imageDataPromise() {\n    if (this._imageData || !this._snapshot) {\n      return Promise.resolve(this._imageData);\n    }\n\n    return /** @type {!Promise<?string>} */ (this._snapshot.objectPromise());\n  }\n}\n"]}