{"version":3,"file":"SourceMapManager.js","sourceRoot":"","sources":["../../../../../front_end/sdk/SourceMapManager.js"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2017 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../common/common.js';\nimport * as Platform from '../platform/platform.js';\nimport {ls} from '../platform/platform.js';\n\nimport {FrameAssociated} from './FrameAssociated.js';  // eslint-disable-line no-unused-vars\nimport {Events as TargetManagerEvents, Target, TargetManager} from './SDKModel.js';  // eslint-disable-line no-unused-vars\nimport {SourceMap, TextSourceMap} from './SourceMap.js';  // eslint-disable-line no-unused-vars\n\n\n/**\n * @template {!FrameAssociated} T\n */\nexport class SourceMapManager extends Common.ObjectWrapper.ObjectWrapper {\n  /**\n   * @param {!Target} target\n   */\n  constructor(target) {\n    super();\n\n    this._target = target;\n    /** @type {boolean} */\n    this._isEnabled = true;\n\n    /** @type {!Map<!T, string>} */\n    this._relativeSourceURL = new Map();\n    /** @type {!Map<!T, string>} */\n    this._relativeSourceMapURL = new Map();\n    /** @type {!Map<!T, string>} */\n    this._resolvedSourceMapId = new Map();\n\n    /** @type {!Map<string, !SourceMap>} */\n    this._sourceMapById = new Map();\n    /** @type {!Platform.MapUtilities.Multimap<string, !T>} */\n    this._sourceMapIdToLoadingClients = new Platform.MapUtilities.Multimap();\n    /** @type {!Platform.MapUtilities.Multimap<string, !T>} */\n    this._sourceMapIdToClients = new Platform.MapUtilities.Multimap();\n\n    TargetManager.instance().addEventListener(TargetManagerEvents.InspectedURLChanged, this._inspectedURLChanged, this);\n  }\n\n  /**\n   * @param {boolean} isEnabled\n   */\n  setEnabled(isEnabled) {\n    if (isEnabled === this._isEnabled) {\n      return;\n    }\n    this._isEnabled = isEnabled;\n    // We need this copy, because `this._resolvedSourceMapId` is getting modified\n    // in the loop body and trying to iterate over it at the same time leads to\n    // an infinite loop.\n    const clients = [...this._resolvedSourceMapId.keys()];\n    for (const client of clients) {\n      const relativeSourceURL = this._relativeSourceURL.get(client);\n      const relativeSourceMapURL = this._relativeSourceMapURL.get(client);\n      this.detachSourceMap(client);\n      this.attachSourceMap(client, relativeSourceURL, relativeSourceMapURL);\n    }\n  }\n\n  /**\n   * @param {!Common.EventTarget.EventTargetEvent} event\n   */\n  _inspectedURLChanged(event) {\n    if (event.data !== this._target) {\n      return;\n    }\n\n    // We need this copy, because `this._resolvedSourceMapId` is getting modified\n    // in the loop body and trying to iterate over it at the same time leads to\n    // an infinite loop.\n    const prevSourceMapIds = new Map(this._resolvedSourceMapId);\n    for (const [client, prevSourceMapId] of prevSourceMapIds) {\n      const relativeSourceURL = this._relativeSourceURL.get(client);\n      const relativeSourceMapURL = this._relativeSourceMapURL.get(client);\n      if (relativeSourceURL === undefined || relativeSourceMapURL === undefined) {\n        continue;\n      }\n      const resolvedUrls = this._resolveRelativeURLs(relativeSourceURL, relativeSourceMapURL);\n      if (resolvedUrls !== null && prevSourceMapId !== resolvedUrls.sourceMapId) {\n        this.detachSourceMap(client);\n        this.attachSourceMap(client, relativeSourceURL, relativeSourceMapURL);\n      }\n    }\n  }\n\n  /**\n   * @param {!T} client\n   * @return {?SourceMap}\n   */\n  sourceMapForClient(client) {\n    const sourceMapId = this._resolvedSourceMapId.get(client);\n    if (!sourceMapId) {\n      return null;\n    }\n    return this._sourceMapById.get(sourceMapId) || null;\n  }\n\n  /**\n   * @param {!SourceMap} sourceMap\n   * @return {!Array<!T>}\n   */\n  clientsForSourceMap(sourceMap) {\n    const sourceMapId = this._getSourceMapId(sourceMap.compiledURL(), sourceMap.url());\n    if (this._sourceMapIdToClients.has(sourceMapId)) {\n      return [...this._sourceMapIdToClients.get(sourceMapId)];\n    }\n    return [...this._sourceMapIdToLoadingClients.get(sourceMapId)];\n  }\n\n  /**\n   * @param {string} sourceURL\n   * @param {string} sourceMapURL\n   */\n  _getSourceMapId(sourceURL, sourceMapURL) {\n    return `${sourceURL}:${sourceMapURL}`;\n  }\n\n  /**\n   * @param {string} sourceURL\n   * @param {string} sourceMapURL\n   * @return {?{sourceURL: string, sourceMapURL: string, sourceMapId: string}}\n   */\n  _resolveRelativeURLs(sourceURL, sourceMapURL) {\n    // |sourceURL| can be a random string, but is generally an absolute path.\n    // Complete it to inspected page url for relative links.\n    const resolvedSourceURL = Common.ParsedURL.ParsedURL.completeURL(this._target.inspectedURL(), sourceURL);\n    if (!resolvedSourceURL) {\n      return null;\n    }\n    const resolvedSourceMapURL = Common.ParsedURL.ParsedURL.completeURL(resolvedSourceURL, sourceMapURL);\n    if (!resolvedSourceMapURL) {\n      return null;\n    }\n    return {\n      sourceURL: resolvedSourceURL,\n      sourceMapURL: resolvedSourceMapURL,\n      sourceMapId: this._getSourceMapId(resolvedSourceURL, resolvedSourceMapURL)\n    };\n  }\n\n  /**\n   * @param {!T} client\n   * @param {string|undefined} relativeSourceURL\n   * @param {string|undefined} relativeSourceMapURL\n   */\n  attachSourceMap(client, relativeSourceURL, relativeSourceMapURL) {\n    // TODO(chromium:1011811): Strengthen the type to obsolte the undefined check once sdk/ is fully typescriptified.\n    if (relativeSourceURL === undefined || !relativeSourceMapURL) {\n      return;\n    }\n    console.assert(!this._resolvedSourceMapId.has(client), 'SourceMap is already attached to client');\n    const resolvedURLs = this._resolveRelativeURLs(relativeSourceURL, relativeSourceMapURL);\n    if (!resolvedURLs) {\n      return;\n    }\n    this._relativeSourceURL.set(client, relativeSourceURL);\n    this._relativeSourceMapURL.set(client, relativeSourceMapURL);\n\n    const {sourceURL, sourceMapURL, sourceMapId} = resolvedURLs;\n    this._resolvedSourceMapId.set(client, sourceMapId);\n\n    if (!this._isEnabled) {\n      return;\n    }\n\n    this.dispatchEventToListeners(Events.SourceMapWillAttach, client);\n\n    if (this._sourceMapById.has(sourceMapId)) {\n      attach.call(this, sourceMapId, client);\n      return;\n    }\n    if (!this._sourceMapIdToLoadingClients.has(sourceMapId)) {\n      TextSourceMap.load(sourceMapURL, sourceURL, client.createPageResourceLoadInitiator())\n          .catch(error => {\n            Common.Console.Console.instance().warn(ls`DevTools failed to load SourceMap: ${error.message}`);\n            return null;\n          })\n          .then(onSourceMap.bind(this, sourceMapId));\n    }\n    this._sourceMapIdToLoadingClients.set(sourceMapId, client);\n\n    /**\n     * @param {string} sourceMapId\n     * @param {?SourceMap} sourceMap\n     * @this {SourceMapManager<T>}\n     */\n    function onSourceMap(sourceMapId, sourceMap) {\n      this._sourceMapLoadedForTest();\n      const clients = this._sourceMapIdToLoadingClients.get(sourceMapId);\n      this._sourceMapIdToLoadingClients.deleteAll(sourceMapId);\n      if (!clients.size) {\n        return;\n      }\n      if (!sourceMap) {\n        for (const client of clients) {\n          this.dispatchEventToListeners(Events.SourceMapFailedToAttach, client);\n        }\n        return;\n      }\n      this._sourceMapById.set(sourceMapId, sourceMap);\n      for (const client of clients) {\n        attach.call(this, sourceMapId, client);\n      }\n    }\n\n    /**\n     * @param {string} sourceMapId\n     * @param {!T} client\n     * @this {SourceMapManager<T>}\n     */\n    function attach(sourceMapId, client) {\n      this._sourceMapIdToClients.set(sourceMapId, client);\n      const sourceMap = this._sourceMapById.get(sourceMapId);\n      this.dispatchEventToListeners(Events.SourceMapAttached, {client: client, sourceMap: sourceMap});\n    }\n  }\n\n  /**\n   * @param {!T} client\n   */\n  detachSourceMap(client) {\n    const sourceMapId = this._resolvedSourceMapId.get(client);\n    this._relativeSourceURL.delete(client);\n    this._relativeSourceMapURL.delete(client);\n    this._resolvedSourceMapId.delete(client);\n\n    if (!sourceMapId) {\n      return;\n    }\n    if (!this._sourceMapIdToClients.hasValue(sourceMapId, client)) {\n      if (this._sourceMapIdToLoadingClients.delete(sourceMapId, client)) {\n        this.dispatchEventToListeners(Events.SourceMapFailedToAttach, client);\n      }\n      return;\n    }\n    this._sourceMapIdToClients.delete(sourceMapId, client);\n    const sourceMap = this._sourceMapById.get(sourceMapId);\n    if (!sourceMap) {\n      return;\n    }\n    if (!this._sourceMapIdToClients.has(sourceMapId)) {\n      this._sourceMapById.delete(sourceMapId);\n    }\n    this.dispatchEventToListeners(Events.SourceMapDetached, {client: client, sourceMap: sourceMap});\n  }\n\n  _sourceMapLoadedForTest() {\n  }\n\n  dispose() {\n    TargetManager.instance().removeEventListener(\n        TargetManagerEvents.InspectedURLChanged, this._inspectedURLChanged, this);\n  }\n}\n\nexport const Events = {\n  SourceMapWillAttach: Symbol('SourceMapWillAttach'),\n  SourceMapFailedToAttach: Symbol('SourceMapFailedToAttach'),\n  SourceMapAttached: Symbol('SourceMapAttached'),\n  SourceMapDetached: Symbol('SourceMapDetached'),\n  SourceMapChanged: Symbol('SourceMapChanged')\n};\n"]}