{"version":3,"file":"CSSStyleSheetHeader.js","sourceRoot":"","sources":["../../../../../front_end/sdk/CSSStyleSheetHeader.js"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2016 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../common/common.js';\nimport {ls} from '../platform/platform.js';\nimport * as TextUtils from '../text_utils/text_utils.js';\n\nimport {CSSModel} from './CSSModel.js';  // eslint-disable-line no-unused-vars\nimport {DeferredDOMNode} from './DOMModel.js';\nimport {FrameAssociated} from './FrameAssociated.js';               // eslint-disable-line no-unused-vars\nimport {PageResourceLoadInitiator} from './PageResourceLoader.js';  // eslint-disable-line no-unused-vars\nimport {ResourceTreeModel} from './ResourceTreeModel.js';\n\n/**\n * @implements {TextUtils.ContentProvider.ContentProvider}\n * TODO(chromium:1011811): make `implements {FrameAssociated}` annotation work here.\n */\nexport class CSSStyleSheetHeader {\n  /**\n   * @param {!CSSModel} cssModel\n   * @param {!Protocol.CSS.CSSStyleSheetHeader} payload\n   */\n  constructor(cssModel, payload) {\n    this._cssModel = cssModel;\n    this.id = payload.styleSheetId;\n    this.frameId = payload.frameId;\n    this.sourceURL = payload.sourceURL;\n    this.hasSourceURL = Boolean(payload.hasSourceURL);\n    this.origin = payload.origin;\n    this.title = payload.title;\n    this.disabled = payload.disabled;\n    this.isInline = payload.isInline;\n    this.isMutable = payload.isMutable;\n    // TODO(alexrudenko): Needs a roll of the browser_protocol.pdl.\n    this.isConstructed = /** @type {*} */ (payload).isConstructed;\n    this.startLine = payload.startLine;\n    this.startColumn = payload.startColumn;\n    this.endLine = payload.endLine;\n    this.endColumn = payload.endColumn;\n    this.contentLength = payload.length;\n    if (payload.ownerNode) {\n      this.ownerNode = new DeferredDOMNode(cssModel.target(), payload.ownerNode);\n    }\n    this.sourceMapURL = payload.sourceMapURL;\n    this._originalContentProvider = null;\n  }\n\n  /**\n   * @return {!TextUtils.ContentProvider.ContentProvider}\n   */\n  originalContentProvider() {\n    if (!this._originalContentProvider) {\n      const lazyContent = /** @type {function():!Promise<!TextUtils.ContentProvider.DeferredContent>} */ (async () => {\n        const originalText = await this._cssModel.originalStyleSheetText(this);\n        // originalText might be an empty string which should not trigger the error\n        if (originalText === null) {\n          return {content: null, error: ls`Could not find the original style sheet.`, isEncoded: false};\n        }\n        return {content: originalText, isEncoded: false};\n      });\n      this._originalContentProvider =\n          new TextUtils.StaticContentProvider.StaticContentProvider(this.contentURL(), this.contentType(), lazyContent);\n    }\n    return this._originalContentProvider;\n  }\n\n  /**\n   * @param {string=} sourceMapURL\n   */\n  setSourceMapURL(sourceMapURL) {\n    this.sourceMapURL = sourceMapURL;\n  }\n\n  /**\n   * @return {!CSSModel}\n   */\n  cssModel() {\n    return this._cssModel;\n  }\n\n  /**\n   * @return {boolean}\n   */\n  isAnonymousInlineStyleSheet() {\n    return !this.resourceURL() && !this._cssModel.sourceMapManager().sourceMapForClient(this);\n  }\n\n  /**\n   * @return {string}\n   */\n  resourceURL() {\n    return this.isViaInspector() ? this._viaInspectorResourceURL() : this.sourceURL;\n  }\n\n  /**\n   * @return {string}\n   */\n  _viaInspectorResourceURL() {\n    const model = this._cssModel.target().model(ResourceTreeModel);\n    console.assert(Boolean(model));\n    if (!model) {\n      return '';\n    }\n    const frame = model.frameForId(this.frameId);\n    if (!frame) {\n      return '';\n    }\n    console.assert(Boolean(frame));\n    const parsedURL = new Common.ParsedURL.ParsedURL(frame.url);\n    let fakeURL = 'inspector://' + parsedURL.host + parsedURL.folderPathComponents;\n    if (!fakeURL.endsWith('/')) {\n      fakeURL += '/';\n    }\n    fakeURL += 'inspector-stylesheet';\n    return fakeURL;\n  }\n\n  /**\n   * @param {number} lineNumberInStyleSheet\n   * @return {number}\n   */\n  lineNumberInSource(lineNumberInStyleSheet) {\n    return this.startLine + lineNumberInStyleSheet;\n  }\n\n  /**\n   * @param {number} lineNumberInStyleSheet\n   * @param {number} columnNumberInStyleSheet\n   * @return {number|undefined}\n   */\n  columnNumberInSource(lineNumberInStyleSheet, columnNumberInStyleSheet) {\n    return (lineNumberInStyleSheet ? 0 : this.startColumn) + columnNumberInStyleSheet;\n  }\n\n  /**\n   * Checks whether the position is in this style sheet. Assumes that the\n   * position's columnNumber is consistent with line endings.\n   * @param {number} lineNumber\n   * @param {number} columnNumber\n   * @return {boolean}\n   */\n  containsLocation(lineNumber, columnNumber) {\n    const afterStart =\n        (lineNumber === this.startLine && columnNumber >= this.startColumn) || lineNumber > this.startLine;\n    const beforeEnd = lineNumber < this.endLine || (lineNumber === this.endLine && columnNumber <= this.endColumn);\n    return afterStart && beforeEnd;\n  }\n\n  /**\n   * @override\n   * @return {string}\n   */\n  contentURL() {\n    return this.resourceURL();\n  }\n\n  /**\n   * @override\n   * @return {!Common.ResourceType.ResourceType}\n   */\n  contentType() {\n    return Common.ResourceType.resourceTypes.Stylesheet;\n  }\n\n  /**\n   * @override\n   * @return {!Promise<boolean>}\n   */\n  contentEncoded() {\n    return Promise.resolve(false);\n  }\n\n  /**\n   * @override\n   * @return {!Promise<!TextUtils.ContentProvider.DeferredContent>}\n   */\n  async requestContent() {\n    try {\n      const cssText = await this._cssModel.getStyleSheetText(this.id);\n      return {content: /** @type{string} */ (cssText), isEncoded: false};\n    } catch (err) {\n      return {\n        content: null,\n        error: ls`There was an error retrieving the source styles.`,\n        isEncoded: false,\n      };\n    }\n  }\n\n  /**\n   * @override\n   * @param {string} query\n   * @param {boolean} caseSensitive\n   * @param {boolean} isRegex\n   * @return {!Promise<!Array<!TextUtils.ContentProvider.SearchMatch>>}\n   */\n  async searchInContent(query, caseSensitive, isRegex) {\n    const requestedContent = await this.requestContent();\n    if (requestedContent.content === null) {\n      return [];\n    }\n    return TextUtils.TextUtils.performSearchInContent(requestedContent.content, query, caseSensitive, isRegex);\n  }\n\n  /**\n   * @return {boolean}\n   */\n  isViaInspector() {\n    return this.origin === 'inspector';\n  }\n\n  /**\n   * @returns {!PageResourceLoadInitiator}\n   */\n  createPageResourceLoadInitiator() {\n    return {target: null, frameId: this.frameId, initiatorUrl: this.hasSourceURL ? '' : this.sourceURL};\n  }\n}\n"]}