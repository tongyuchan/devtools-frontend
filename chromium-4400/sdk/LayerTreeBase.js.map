{"version":3,"file":"LayerTreeBase.js","sourceRoot":"","sources":["../../../../../front_end/sdk/LayerTreeBase.js"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2016 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport {DOMModel, DOMNode} from './DOMModel.js';      // eslint-disable-line no-unused-vars\nimport {SnapshotWithRect} from './PaintProfiler.js';  // eslint-disable-line no-unused-vars\nimport {Target} from './SDKModel.js';                 // eslint-disable-line no-unused-vars\n\n/**\n * @interface\n */\nexport class Layer {\n  /**\n   * @return {string}\n   */\n  id() {\n    throw new Error('Not implemented');\n  }\n\n  /**\n   * @return {?string}\n   */\n  parentId() {\n    throw new Error('Not implemented');\n  }\n\n  /**\n   * @return {?Layer}\n   */\n  parent() {\n    throw new Error('Not implemented');\n  }\n\n  /**\n   * @return {boolean}\n   */\n  isRoot() {\n    throw new Error('Not implemented');\n  }\n\n  /**\n   * @return {!Array.<!Layer>}\n   */\n  children() {\n    throw new Error('Not implemented');\n  }\n\n  /**\n   * @param {!Layer} child\n   */\n  addChild(child) {\n  }\n\n  /**\n   * @return {?DOMNode}\n   */\n  node() {\n    throw new Error('Not implemented');\n  }\n\n  /**\n   * @return {?DOMNode}\n   */\n  nodeForSelfOrAncestor() {\n    throw new Error('Not implemented');\n  }\n\n  /**\n   * @return {number}\n   */\n  offsetX() {\n    throw new Error('Not implemented');\n  }\n\n  /**\n   * @return {number}\n   */\n  offsetY() {\n    throw new Error('Not implemented');\n  }\n\n  /**\n   * @return {number}\n   */\n  width() {\n    throw new Error('Not implemented');\n  }\n\n  /**\n   * @return {number}\n   */\n  height() {\n    throw new Error('Not implemented');\n  }\n\n  /**\n   * @return {?Array.<number>}\n   */\n  transform() {\n    throw new Error('Not implemented');\n  }\n\n  /**\n   * @return {!Array.<number>}\n   */\n  quad() {\n    throw new Error('Not implemented');\n  }\n\n  /**\n   * @return {!Array.<number>}\n   */\n  anchorPoint() {\n    throw new Error('Not implemented');\n  }\n\n  /**\n   * @return {boolean}\n   */\n  invisible() {\n    throw new Error('Not implemented');\n  }\n\n  /**\n   * @return {number}\n   */\n  paintCount() {\n    throw new Error('Not implemented');\n  }\n\n  /**\n   * @return {?Protocol.DOM.Rect}\n   */\n  lastPaintRect() {\n    throw new Error('Not implemented');\n  }\n\n  /**\n   * @return {!Array.<!Protocol.LayerTree.ScrollRect>}\n   */\n  scrollRects() {\n    throw new Error('Not implemented');\n  }\n\n  /**\n   * @return {?StickyPositionConstraint}\n   */\n  stickyPositionConstraint() {\n    throw new Error('Not implemented');\n  }\n\n  /**\n   * @return {number}\n   */\n  gpuMemoryUsage() {\n    throw new Error('Not implemented');\n  }\n\n  /**\n   * @return {!Promise<!Array<string>>}\n   */\n  requestCompositingReasonIds() {\n    throw new Error('Not implemented');\n  }\n\n  /**\n   * @return {boolean}\n   */\n  drawsContent() {\n    throw new Error('Not implemented');\n  }\n\n  /**\n   * @return {!Array<!Promise<?SnapshotWithRect>>}\n   */\n  snapshots() {\n    throw new Error('Not implemented');\n  }\n}\n\nLayer.ScrollRectType = {\n  NonFastScrollable: 'NonFastScrollable',\n  TouchEventHandler: 'TouchEventHandler',\n  WheelEventHandler: 'WheelEventHandler',\n  RepaintsOnScroll: 'RepaintsOnScroll',\n  MainThreadScrollingReason: 'MainThreadScrollingReason'\n};\n\nexport class StickyPositionConstraint {\n  /**\n   * @param {?LayerTreeBase} layerTree\n   * @param {!Protocol.LayerTree.StickyPositionConstraint} constraint\n   * @struct\n   */\n  constructor(layerTree, constraint) {\n    /** @type {!Protocol.DOM.Rect} */\n    this._stickyBoxRect = constraint.stickyBoxRect;\n    /** @type {!Protocol.DOM.Rect} */\n    this._containingBlockRect = constraint.containingBlockRect;\n    /** @type {?Layer} */\n    this._nearestLayerShiftingStickyBox = null;\n    if (layerTree && constraint.nearestLayerShiftingStickyBox) {\n      this._nearestLayerShiftingStickyBox = layerTree.layerById(constraint.nearestLayerShiftingStickyBox);\n    }\n\n    /** @type {?Layer} */\n    this._nearestLayerShiftingContainingBlock = null;\n    if (layerTree && constraint.nearestLayerShiftingContainingBlock) {\n      this._nearestLayerShiftingContainingBlock = layerTree.layerById(constraint.nearestLayerShiftingContainingBlock);\n    }\n  }\n\n  /**\n   * @return {!Protocol.DOM.Rect}\n   */\n  stickyBoxRect() {\n    return this._stickyBoxRect;\n  }\n\n  /**\n   * @return {!Protocol.DOM.Rect}\n   */\n  containingBlockRect() {\n    return this._containingBlockRect;\n  }\n\n  /**\n   * @return {?Layer}\n   */\n  nearestLayerShiftingStickyBox() {\n    return this._nearestLayerShiftingStickyBox;\n  }\n\n  /**\n   * @return {?Layer}\n   */\n  nearestLayerShiftingContainingBlock() {\n    return this._nearestLayerShiftingContainingBlock;\n  }\n}\n\nexport class LayerTreeBase {\n  /**\n   * @param {?Target} target\n   */\n  constructor(target) {\n    this._target = target;\n    this._domModel = target ? target.model(DOMModel) : null;\n    /** @type {!Map<(string|number), !Layer>} */\n    this.layersById = new Map();\n    this._root = null;\n    this._contentRoot = null;\n    /** @type {!Map<number, ?DOMNode>} */\n    this._backendNodeIdToNode = new Map();\n  }\n\n  /**\n   * @return {?Target}\n   */\n  target() {\n    return this._target;\n  }\n\n  /**\n   * @return {?Layer}\n   */\n  root() {\n    return this._root;\n  }\n\n  /**\n   * @param {?Layer} root\n   * @protected\n   */\n  setRoot(root) {\n    this._root = root;\n  }\n\n  /**\n   * @return {?Layer}\n   */\n  contentRoot() {\n    return this._contentRoot;\n  }\n\n  /**\n   * @param {?Layer} contentRoot\n   * @protected\n   */\n  setContentRoot(contentRoot) {\n    this._contentRoot = contentRoot;\n  }\n\n  /**\n   * @param {function(!Layer):*} callback\n   * @param {?Layer=} root\n   * @return {*}\n   */\n  forEachLayer(callback, root) {\n    if (!root) {\n      root = this.root();\n      if (!root) {\n        return false;\n      }\n    }\n    return callback(root) || root.children().some(this.forEachLayer.bind(this, callback));\n  }\n\n  /**\n   * @param {string} id\n   * @return {?Layer}\n   */\n  layerById(id) {\n    return this.layersById.get(id) || null;\n  }\n\n  /**\n   * @param {!Set<number>} requestedNodeIds\n   * @return {!Promise<void>}\n   */\n  async resolveBackendNodeIds(requestedNodeIds) {\n    if (!requestedNodeIds.size || !this._domModel) {\n      return;\n    }\n\n    const nodesMap = await this._domModel.pushNodesByBackendIdsToFrontend(requestedNodeIds);\n\n    if (!nodesMap) {\n      return;\n    }\n    for (const nodeId of nodesMap.keys()) {\n      this._backendNodeIdToNode.set(nodeId, nodesMap.get(nodeId) || null);\n    }\n  }\n\n  /**\n   * @return {!Map<number, ?DOMNode>}\n   */\n  backendNodeIdToNode() {\n    return this._backendNodeIdToNode;\n  }\n\n  /**\n   * @param {!{width: number, height: number}} viewportSize\n   */\n  setViewportSize(viewportSize) {\n    this._viewportSize = viewportSize;\n  }\n\n  /**\n   * @return {!{width: number, height: number}|undefined}\n   */\n  viewportSize() {\n    return this._viewportSize;\n  }\n\n  /**\n   * @param {number} id\n   * @return {?DOMNode}\n   */\n  _nodeForId(id) {\n    return this._domModel ? this._domModel.nodeForId(id) : null;\n  }\n}\n"]}