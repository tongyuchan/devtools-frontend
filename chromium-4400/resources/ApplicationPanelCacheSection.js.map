{"version":3,"file":"ApplicationPanelCacheSection.js","sourceRoot":"","sources":["../../../../../front_end/resources/ApplicationPanelCacheSection.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2020 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../common/common.js';\nimport {ls} from '../platform/platform.js';\nimport * as SDK from '../sdk/sdk.js';\nimport * as UI from '../ui/ui.js';\n\nimport {ApplicationPanelSidebar} from './ApplicationPanelSidebar.js';\nimport {ApplicationPanelTreeElement, ExpandableApplicationPanelTreeElement} from './ApplicationPanelTreeElement.js';\nimport {ResourcesPanel} from './ResourcesPanel.js';\nimport {ServiceWorkerCacheView} from './ServiceWorkerCacheViews.js';\n\nexport class ApplicationCacheManifestTreeElement extends ApplicationPanelTreeElement {\n  private readonly manifestURL: string;\n\n  constructor(resourcesPanel: ResourcesPanel, manifestURL: string) {\n    const title = new Common.ParsedURL.ParsedURL(manifestURL).displayName;\n    super(resourcesPanel, title, false);\n    this.tooltip = manifestURL;\n    this.manifestURL = manifestURL;\n  }\n\n  get itemURL(): string {\n    return 'appcache://' + this.manifestURL;\n  }\n\n  onselect(selectedByUser: boolean|undefined): boolean {\n    super.onselect(selectedByUser);\n    this.resourcesPanel.showCategoryView(this.manifestURL, null);\n    return false;\n  }\n}\n\nexport class ServiceWorkerCacheTreeElement extends ExpandableApplicationPanelTreeElement {\n  private swCacheModel: SDK.ServiceWorkerCacheModel.ServiceWorkerCacheModel|null;\n  private swCacheTreeElements: Set<SWCacheTreeElement>;\n\n  constructor(resourcesPanel: ResourcesPanel) {\n    super(resourcesPanel, ls`Cache Storage`, 'CacheStorage');\n    const icon = UI.Icon.Icon.create('mediumicon-database', 'resource-tree-item');\n    this.setLink('https://developers.google.com/web/tools/chrome-devtools/storage/cache?utm_source=devtools');\n    this.setLeadingIcons([icon]);\n    this.swCacheModel = null;\n    this.swCacheTreeElements = new Set();\n  }\n\n  initialize(model: SDK.ServiceWorkerCacheModel.ServiceWorkerCacheModel|null): void {\n    this.swCacheTreeElements.clear();\n    this.swCacheModel = model;\n    if (model) {\n      for (const cache of model.caches()) {\n        this.addCache(model, cache);\n      }\n    }\n    SDK.SDKModel.TargetManager.instance().addModelListener(\n        SDK.ServiceWorkerCacheModel.ServiceWorkerCacheModel, SDK.ServiceWorkerCacheModel.Events.CacheAdded,\n        this.cacheAdded, this);\n    SDK.SDKModel.TargetManager.instance().addModelListener(\n        SDK.ServiceWorkerCacheModel.ServiceWorkerCacheModel, SDK.ServiceWorkerCacheModel.Events.CacheRemoved,\n        this.cacheRemoved, this);\n  }\n\n  onattach(): void {\n    super.onattach();\n    this.listItemElement.addEventListener('contextmenu', this.handleContextMenuEvent.bind(this), true);\n  }\n\n  private handleContextMenuEvent(event: MouseEvent): void {\n    const contextMenu = new UI.ContextMenu.ContextMenu(event);\n    contextMenu.defaultSection().appendItem(ls`Refresh Caches`, this.refreshCaches.bind(this));\n    contextMenu.show();\n  }\n\n  private refreshCaches(): void {\n    if (this.swCacheModel) {\n      this.swCacheModel.refreshCacheNames();\n    }\n  }\n\n  private cacheAdded(event: Common.EventTarget.EventTargetEvent): void {\n    const cache = /** @type {!SDK.ServiceWorkerCacheModel.Cache} */ (event.data.cache);\n    const model = /** @type {!SDK.ServiceWorkerCacheModel.ServiceWorkerCacheModel} */ (event.data.model);\n    this.addCache(model, cache);\n  }\n\n  private addCache(\n      model: SDK.ServiceWorkerCacheModel.ServiceWorkerCacheModel, cache: SDK.ServiceWorkerCacheModel.Cache): void {\n    const swCacheTreeElement = new SWCacheTreeElement(this.resourcesPanel, model, cache);\n    this.swCacheTreeElements.add(swCacheTreeElement);\n    this.appendChild(swCacheTreeElement);\n  }\n\n  private cacheRemoved(event: Common.EventTarget.EventTargetEvent): void {\n    const cache = /** @type {!SDK.ServiceWorkerCacheModel.Cache} */ (event.data.cache);\n    const model = /** @type {!SDK.ServiceWorkerCacheModel.ServiceWorkerCacheModel} */ (event.data.model);\n\n    const swCacheTreeElement = this.cacheTreeElement(model, cache);\n    if (!swCacheTreeElement) {\n      return;\n    }\n\n    this.removeChild(swCacheTreeElement);\n    this.swCacheTreeElements.delete(swCacheTreeElement);\n    this.setExpandable(this.childCount() > 0);\n  }\n\n  private cacheTreeElement(\n      model: SDK.ServiceWorkerCacheModel.ServiceWorkerCacheModel,\n      cache: SDK.ServiceWorkerCacheModel.Cache): SWCacheTreeElement|null {\n    for (const cacheTreeElement of this.swCacheTreeElements) {\n      if (cacheTreeElement.hasModelAndCache(model, cache)) {\n        return cacheTreeElement;\n      }\n    }\n    return null;\n  }\n}\n\nexport class SWCacheTreeElement extends ApplicationPanelTreeElement {\n  private readonly model: SDK.ServiceWorkerCacheModel.ServiceWorkerCacheModel;\n  private cache: SDK.ServiceWorkerCacheModel.Cache;\n  private view: ServiceWorkerCacheView|null;\n\n  constructor(\n      resourcesPanel: ResourcesPanel, model: SDK.ServiceWorkerCacheModel.ServiceWorkerCacheModel,\n      cache: SDK.ServiceWorkerCacheModel.Cache) {\n    super(resourcesPanel, cache.cacheName + ' - ' + cache.securityOrigin, false);\n    this.model = model;\n    this.cache = cache;\n    /** @type {?} */\n    this.view = null;\n    const icon = UI.Icon.Icon.create('mediumicon-table', 'resource-tree-item');\n    this.setLeadingIcons([icon]);\n  }\n\n  get itemURL(): string {\n    // I don't think this will work at all.\n    return 'cache://' + this.cache.cacheId;\n  }\n\n  onattach(): void {\n    super.onattach();\n    this.listItemElement.addEventListener('contextmenu', this.handleContextMenuEvent.bind(this), true);\n  }\n\n  private handleContextMenuEvent(event: MouseEvent): void {\n    const contextMenu = new UI.ContextMenu.ContextMenu(event);\n    contextMenu.defaultSection().appendItem(ls`Delete`, this.clearCache.bind(this));\n    contextMenu.show();\n  }\n\n  private clearCache(): void {\n    this.model.deleteCache(this.cache);\n  }\n\n  update(cache: SDK.ServiceWorkerCacheModel.Cache): void {\n    this.cache = cache;\n    if (this.view) {\n      this.view.update(cache);\n    }\n  }\n\n  onselect(selectedByUser: boolean|undefined): boolean {\n    super.onselect(selectedByUser);\n    if (!this.view) {\n      this.view = new ServiceWorkerCacheView(this.model, this.cache);\n    }\n\n    this.showView(this.view);\n    return false;\n  }\n\n  hasModelAndCache(\n      model: SDK.ServiceWorkerCacheModel.ServiceWorkerCacheModel, cache: SDK.ServiceWorkerCacheModel.Cache): boolean {\n    return this.cache.equals(cache) && this.model === model;\n  }\n}\n\nexport class ApplicationCacheFrameTreeElement extends ApplicationPanelTreeElement {\n  private readonly sidebar: ApplicationPanelSidebar;\n  readonly frameId: string;\n  readonly manifestURL: string;\n\n  constructor(sidebar: ApplicationPanelSidebar, frame: SDK.ResourceTreeModel.ResourceTreeFrame, manifestURL: string) {\n    super(sidebar._panel, '', false);\n    this.sidebar = sidebar;\n    this.frameId = frame.id;\n    this.manifestURL = manifestURL;\n    this.refreshTitles(frame);\n\n    const icon = UI.Icon.Icon.create('mediumicon-frame-top', 'navigator-folder-tree-item');\n    this.setLeadingIcons([icon]);\n  }\n\n  get itemURL(): string {\n    return 'appcache://' + this.manifestURL + '/' + encodeURI(this.titleAsText());\n  }\n\n  private refreshTitles(frame: SDK.ResourceTreeModel.ResourceTreeFrame): void {\n    this.title = frame.displayName();\n  }\n\n  frameNavigated(frame: SDK.ResourceTreeModel.ResourceTreeFrame): void {\n    this.refreshTitles(frame);\n  }\n\n  onselect(selectedByUser: boolean|undefined): boolean {\n    super.onselect(selectedByUser);\n    this.sidebar._showApplicationCache(this.frameId);\n    return false;\n  }\n}\n"]}