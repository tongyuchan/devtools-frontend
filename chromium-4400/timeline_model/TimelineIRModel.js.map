{"version":3,"file":"TimelineIRModel.js","sourceRoot":"","sources":["../../../../../front_end/timeline_model/TimelineIRModel.js"],"names":[],"mappings":"AAAA,4DAA4D;AAC5D,yEAAyE;AACzE,6BAA6B;AAE7B,OAAO,KAAK,MAAM,MAAM,qBAAqB,CAAC;AAG9C,OAAO,EAAC,UAAU,EAAC,MAAM,oBAAoB,CAAC;AAE9C;;GAEG;AACH,MAAM,YAAY,GAAG,IAAI,OAAO,EAAE,CAAC;AAEnC,MAAM,OAAO,eAAe;IAC1B;QACE,wDAAwD;QAExD,qDAAqD;QACrD,IAAI,CAAC,SAAS,CAAC;QACf,oDAAoD;QACpD,IAAI,CAAC,MAAM,CAAC;QACZ,oDAAoD;QACpD,IAAI,CAAC,cAAc,CAAC;QACpB,oDAAoD;QACpD,IAAI,CAAC,UAAU,CAAC;QAChB,oDAAoD;QACpD,IAAI,CAAC,QAAQ,CAAC;QAEd,IAAI,CAAC,KAAK,EAAE,CAAC;IACf,CAAC;IAED;;;OAGG;IACH,MAAM,CAAC,aAAa,CAAC,KAAK;QACxB,OAAO,YAAY,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;IACjC,CAAC;IAED;;;OAGG;IACH,QAAQ,CAAC,cAAc,EAAE,UAAU;QACjC,IAAI,CAAC,KAAK,EAAE,CAAC;QACb,IAAI,CAAC,cAAc,EAAE;YACnB,OAAO;SACR;QACD,IAAI,CAAC,sBAAsB,CAAC,cAAc,CAAC,CAAC;QAC5C,IAAI,UAAU,EAAE;YACd,IAAI,CAAC,kBAAkB,CAAC,UAAU,CAAC,CAAC;SACrC;QACD,MAAM,KAAK,GAAG,IAAI,MAAM,CAAC,cAAc,CAAC,cAAc,EAAE,CAAC;QACzD,KAAK,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAE,gFAAgF;QACjH,KAAK,CAAC,WAAW,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;QACvC,KAAK,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QACjC,KAAK,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QACnC,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC,QAAQ,EAAE,CAAC;IACpC,CAAC;IAED;;OAEG;IACH,sBAAsB,CAAC,MAAM;QAC3B,MAAM,UAAU,GAAG,WAAW,CAAC;QAC/B,MAAM,MAAM,GAAG,MAAM,CAAC;QACtB,MAAM,YAAY,GAAG,eAAe,CAAC,kBAAkB,CAAC;QAExD,IAAI,WAAW,CAAC;QAChB,IAAI,UAAU,CAAC;QACf,IAAI,UAAU,CAAC;QACf,IAAI,cAAc,CAAC;QACnB,IAAI,UAAU,CAAC;QACf,IAAI,SAAS,CAAC;QACd,IAAI,SAAS,CAAC;QAEd,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,EAAE,CAAC,EAAE;YACtC,MAAM,KAAK,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;YACxB,IAAI,CAAC,GAAG,CAAC,IAAI,MAAM,CAAC,CAAC,CAAC,CAAC,SAAS,GAAG,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,SAAS,EAAE;gBAC1D,OAAO,CAAC,MAAM,CAAC,KAAK,EAAE,wBAAwB,CAAC,CAAC;aACjD;YACD,MAAM,IAAI,GAAG,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;YAC9C,QAAQ,IAAI,EAAE;gBACZ,KAAK,UAAU,CAAC,WAAW;oBACzB,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,KAAK,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC;oBAClE,WAAW,GAAG,KAAK,CAAC;oBACpB,MAAM;gBAER,KAAK,UAAU,CAAC,SAAS;oBACvB,IAAI,WAAW,EAAE;wBACf,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,qBAAqB,CAAC,WAAW,EAAE,KAAK,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC;qBACrF;yBAAM;wBACL,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,KAAK,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC;qBACnE;oBACD,WAAW,GAAG,IAAI,CAAC;oBACnB,MAAM;gBAER,KAAK,UAAU,CAAC,YAAY;oBAC1B,UAAU,GAAG,IAAI,CAAC,CAAE,6DAA6D;oBACjF,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,KAAK,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC;oBAClE,MAAM;gBAER,KAAK,UAAU,CAAC,UAAU;oBACxB,IAAI,UAAU,EAAE;wBACd,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC,KAAK,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAC5D,uCAAuC,EAAE,UAAU,CAAC,SAAS,EAAE,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC;wBACrF,MAAM;qBACP;oBACD,UAAU,GAAG,KAAK,CAAC;oBACnB,MAAM;gBAER,KAAK,UAAU,CAAC,WAAW;oBACzB,6CAA6C;oBAC7C,IAAI,CAAC,UAAU,EAAE;wBACf,MAAM;qBACP;oBACD,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,qBAAqB,CAAC,UAAU,EAAE,KAAK,EAAE,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;oBAClF,UAAU,GAAG,IAAI,CAAC;oBAClB,MAAM;gBAER,KAAK,UAAU,CAAC,aAAa;oBAC3B,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,KAAK,EAAE,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;oBACjE,MAAM;gBAER,KAAK,UAAU,CAAC,SAAS,CAAC;gBAC1B,KAAK,UAAU,CAAC,GAAG,CAAC;gBACpB,KAAK,UAAU,CAAC,OAAO,CAAC;gBACxB,KAAK,UAAU,CAAC,UAAU,CAAC;gBAC3B,KAAK,UAAU,CAAC,KAAK,CAAC;gBACtB,KAAK,UAAU,CAAC,IAAI,CAAC;gBACrB,KAAK,UAAU,CAAC,KAAK,CAAC;gBACtB,KAAK,UAAU,CAAC,WAAW;oBACzB,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,KAAK,EAAE,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC;oBACtE,MAAM;gBAER,KAAK,UAAU,CAAC,UAAU;oBACxB,+FAA+F;oBAC/F,6CAA6C;oBAC7C,IAAI,UAAU,EAAE;wBACd,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC,KAAK,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAC5D,wCAAwC,EAAE,UAAU,CAAC,SAAS,EAAE,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC;wBACtF,MAAM;qBACP;oBACD,UAAU,GAAG,KAAK,CAAC;oBACnB,IAAI,CAAC,iBAAiB,CAAC,KAAK,EAAE,MAAM,CAAC,QAAQ,CAAC,CAAC;oBAC/C,cAAc,GAAG,IAAI,CAAC;oBACtB,MAAM;gBAER,KAAK,UAAU,CAAC,WAAW;oBACzB,UAAU,GAAG,IAAI,CAAC;oBAClB,MAAM;gBAER,KAAK,UAAU,CAAC,SAAS;oBACvB,IAAI,cAAc,EAAE;wBAClB,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,KAAK,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;qBAC/D;yBAAM,IAAI,UAAU,EAAE;wBACrB,cAAc,GAAG,KAAK,CAAC;wBACvB,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,IAAI,CAAC,qBAAqB,CAAC,UAAU,EAAE,KAAK,EAAE,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC;qBACxF;oBACD,MAAM;gBAER,KAAK,UAAU,CAAC,QAAQ;oBACtB,UAAU,GAAG,IAAI,CAAC;oBAClB,MAAM;gBAER,KAAK,UAAU,CAAC,SAAS;oBACvB,SAAS,GAAG,KAAK,CAAC;oBAClB,SAAS,GAAG,IAAI,CAAC;oBACjB,MAAM;gBAER,KAAK,UAAU,CAAC,SAAS;oBACvB,IAAI,SAAS,IAAI,CAAC,SAAS,IAAI,SAAS,CAAC,SAAS,GAAG,YAAY,CAAC,KAAK,GAAG,KAAK,CAAC,SAAS,EAAE;wBACzF,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,SAAS,EAAE,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC;wBAC1E,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,KAAK,EAAE,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC;qBACvE;yBAAM,IAAI,SAAS,EAAE;wBACpB,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,KAAK,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;qBAC/D;oBACD,SAAS,GAAG,KAAK,CAAC;oBAClB,MAAM;gBAER,KAAK,UAAU,CAAC,OAAO;oBACrB,IAAI,CAAC,UAAU,CAAC,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,KAAK,EAAE,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC;oBACtE,SAAS,GAAG,IAAI,CAAC;oBACjB,MAAM;gBAER,KAAK,UAAU,CAAC,UAAU;oBACxB,2HAA2H;oBAC3H,IAAI,UAAU,IAAI,QAAQ,CAAC,YAAY,CAAC,KAAK,EAAE,UAAU,EAAE,KAAK,CAAC,EAAE;wBACjE,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,qBAAqB,CAAC,UAAU,EAAE,KAAK,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC;qBACpF;yBAAM;wBACL,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,KAAK,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC;qBACnE;oBACD,UAAU,GAAG,KAAK,CAAC;oBACnB,MAAM;aACT;SACF;QAED;;;;;WAKG;QACH,SAAS,QAAQ,CAAC,SAAS,EAAE,KAAK,EAAE,MAAM;YACxC,IAAI,KAAK,CAAC,OAAO,KAAK,SAAS,EAAE;gBAC/B,OAAO,KAAK,CAAC;aACd;YACD,OAAO,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC,SAAS,IAAI,MAAM,CAAC,SAAS,GAAG,KAAK,CAAC,OAAO,GAAG,SAAS,CAAC;QAC1F,CAAC;IACH,CAAC;IAED;;OAEG;IACH,kBAAkB,CAAC,MAAM;QACvB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,EAAE,CAAC,EAAE;YACtC,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC;SAChF;IACH,CAAC;IAED;;;;OAIG;IACH,gBAAgB,CAAC,KAAK,EAAE,KAAK;QAC3B,IAAI,CAAC,iBAAiB,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;QACrC,OAAO,IAAI,MAAM,CAAC,cAAc,CAAC,OAAO,CACpC,KAAK,CAAC,SAAS,EAAE,KAAK,CAAC,OAAO,KAAK,SAAS,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,gBAAgB,EAAE,KAAK,CAAC,CAAC;IACrG,CAAC;IAED;;;;;OAKG;IACH,qBAAqB,CAAC,UAAU,EAAE,QAAQ,EAAE,KAAK;QAC/C,IAAI,CAAC,iBAAiB,CAAC,UAAU,EAAE,KAAK,CAAC,CAAC;QAC1C,IAAI,CAAC,iBAAiB,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC;QACxC,OAAO,IAAI,MAAM,CAAC,cAAc,CAAC,OAAO,CACpC,UAAU,CAAC,SAAS,EAAE,UAAU,CAAC,OAAO,KAAK,SAAS,CAAC,CAAC,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,gBAAgB,EAAE,KAAK,CAAC,CAAC;IACpH,CAAC;IAED;;;OAGG;IACH,iBAAiB,CAAC,UAAU,EAAE,KAAK;QACjC,YAAY,CAAC,GAAG,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC;IAC/C,CAAC;IAED;;OAEG;IACH,kBAAkB;QAChB,OAAO,IAAI,CAAC,SAAS,CAAC;IACxB,CAAC;IAED,KAAK;QACH,MAAM,YAAY,GAAG,eAAe,CAAC,kBAAkB,CAAC;QAExD,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC;QACpB,IAAI,CAAC,MAAM,GAAG,IAAI,MAAM,CAAC,cAAc,CAAC,cAAc,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,EAAE,YAAY,CAAC,KAAK,CAAC,CAAC,CAAC;QAC7F,IAAI,CAAC,cAAc,GAAG,IAAI,MAAM,CAAC,cAAc,CAAC,cAAc,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,EAAE,YAAY,CAAC,SAAS,CAAC,CAAC,CAAC;QACzG,IAAI,CAAC,UAAU,GAAG,IAAI,MAAM,CAAC,cAAc,CAAC,cAAc,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,CAAC;QAChF,IAAI,CAAC,QAAQ,GAAG,IAAI,MAAM,CAAC,cAAc,CAAC,cAAc,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,EAAE,YAAY,CAAC,SAAS,CAAC,CAAC,CAAC;QAEnG;;;;WAIG;QACH,SAAS,KAAK,CAAC,SAAS,EAAE,KAAK,EAAE,MAAM;YACrC,OAAO,KAAK,CAAC,GAAG,GAAG,SAAS,IAAI,MAAM,CAAC,KAAK,IAAI,KAAK,CAAC,IAAI,KAAK,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC;QAC5F,CAAC;IACH,CAAC;IAED;;;OAGG;IACH,eAAe,CAAC,SAAS;QACvB,MAAM,MAAM,GAAG,gBAAgB,CAAC;QAChC,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,MAAM,CAAC,EAAE;YACjC,IAAI,SAAS,KAAK,WAAW,CAAC,aAAa,EAAE;gBAC3C,OAAO,2BAA2B,CAAC,CAAC,SAAS,CAAC,CAAC;aAChD;YACD,OAAO,CAAC,KAAK,CAAC,oCAAoC,GAAG,SAAS,CAAC,CAAC;YAChE,OAAO,IAAI,CAAC;SACb;QACD,OAAO,2BAA2B,CAAC,CAAC,SAAS,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC;IACvE,CAAC;CACF;AAED;;GAEG;AACH,MAAM,CAAC,MAAM,MAAM,GAAG;IACpB,IAAI,EAAE,MAAM;IACZ,QAAQ,EAAE,UAAU;IACpB,MAAM,EAAE,QAAQ;IAChB,KAAK,EAAE,OAAO;IACd,IAAI,EAAE,MAAM;IACZ,SAAS,EAAE,WAAW;IACtB,aAAa,EAAE,eAAe;CAC/B,CAAC;AAEF;;GAEG;AACH,MAAM,CAAC,MAAM,WAAW,GAAG;IACzB,IAAI,EAAE,MAAM;IACZ,KAAK,EAAE,cAAc;IACrB,WAAW,EAAE,aAAa;IAC1B,WAAW,EAAE,oBAAoB;IACjC,UAAU,EAAE,mBAAmB;IAC/B,aAAa,EAAE,UAAU,CAAC,aAAa;IACvC,OAAO,EAAE,SAAS;IAClB,UAAU,EAAE,YAAY;IACxB,KAAK,EAAE,OAAO;IACd,mBAAmB,EAAE,cAAc;IACnC,SAAS,EAAE,WAAW;IACtB,SAAS,EAAE,WAAW;IACtB,OAAO,EAAE,SAAS;IAClB,UAAU,EAAE,YAAY;IACxB,UAAU,EAAE,mBAAmB;IAC/B,QAAQ,EAAE,iBAAiB;IAC3B,WAAW,EAAE,oBAAoB;IACjC,WAAW,EAAE,oBAAoB;IACjC,SAAS,EAAE,kBAAkB;IAC7B,YAAY,EAAE,qBAAqB;IACnC,oBAAoB,EAAE,cAAc;IACpC,SAAS,EAAE,kBAAkB;IAC7B,GAAG,EAAE,YAAY;IACjB,SAAS,EAAE,kBAAkB;IAC7B,OAAO,EAAE,gBAAgB;IACzB,WAAW,EAAE,aAAa;IAC1B,QAAQ,EAAE,UAAU;IACpB,SAAS,EAAE,WAAW;IACtB,UAAU,EAAE,YAAY;CACzB,CAAC;AAEF,eAAe,CAAC,kBAAkB,GAAG;IACnC,SAAS,EAAE,CAAC;IACZ,KAAK,EAAE,EAAE;CACV,CAAC;AAEF,eAAe,CAAC,aAAa,GAAG,MAAM,CAAC,cAAc,CAAC,CAAC","sourcesContent":["// Copyright 2016 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../common/common.js';\nimport * as SDK from '../sdk/sdk.js';  // eslint-disable-line no-unused-vars\n\nimport {RecordType} from './TimelineModel.js';\n\n/**\n * @type {!WeakMap<!SDK.TracingModel.Event, !Phases>}\n */\nconst eventToPhase = new WeakMap();\n\nexport class TimelineIRModel {\n  constructor() {\n    // Attributes below are guaranteed to be set by reset();\n\n    /** @type {!Array<!Common.SegmentedRange.Segment>} */\n    this._segments;\n    /** @type {!Common.SegmentedRange.SegmentedRange} */\n    this._drags;\n    /** @type {!Common.SegmentedRange.SegmentedRange} */\n    this._cssAnimations;\n    /** @type {!Common.SegmentedRange.SegmentedRange} */\n    this._responses;\n    /** @type {!Common.SegmentedRange.SegmentedRange} */\n    this._scrolls;\n\n    this.reset();\n  }\n\n  /**\n   * @param {!SDK.TracingModel.Event} event\n   * @return {(!Phases|undefined)}\n   */\n  static phaseForEvent(event) {\n    return eventToPhase.get(event);\n  }\n\n  /**\n   * @param {?Array<!SDK.TracingModel.AsyncEvent>} inputLatencies\n   * @param {?Array<!SDK.TracingModel.AsyncEvent>} animations\n   */\n  populate(inputLatencies, animations) {\n    this.reset();\n    if (!inputLatencies) {\n      return;\n    }\n    this._processInputLatencies(inputLatencies);\n    if (animations) {\n      this._processAnimations(animations);\n    }\n    const range = new Common.SegmentedRange.SegmentedRange();\n    range.appendRange(this._drags);  // Drags take lower precedence than animation, as we can't detect them reliably.\n    range.appendRange(this._cssAnimations);\n    range.appendRange(this._scrolls);\n    range.appendRange(this._responses);\n    this._segments = range.segments();\n  }\n\n  /**\n   * @param {!Array<!SDK.TracingModel.AsyncEvent>} events\n   */\n  _processInputLatencies(events) {\n    const eventTypes = InputEvents;\n    const phases = Phases;\n    const thresholdsMs = TimelineIRModel._mergeThresholdsMs;\n\n    let scrollStart;\n    let flingStart;\n    let touchStart;\n    let firstTouchMove;\n    let mouseWheel;\n    let mouseDown;\n    let mouseMove;\n\n    for (let i = 0; i < events.length; ++i) {\n      const event = events[i];\n      if (i > 0 && events[i].startTime < events[i - 1].startTime) {\n        console.assert(false, 'Unordered input events');\n      }\n      const type = this._inputEventType(event.name);\n      switch (type) {\n        case eventTypes.ScrollBegin:\n          this._scrolls.append(this._segmentForEvent(event, phases.Scroll));\n          scrollStart = event;\n          break;\n\n        case eventTypes.ScrollEnd:\n          if (scrollStart) {\n            this._scrolls.append(this._segmentForEventRange(scrollStart, event, phases.Scroll));\n          } else {\n            this._scrolls.append(this._segmentForEvent(event, phases.Scroll));\n          }\n          scrollStart = null;\n          break;\n\n        case eventTypes.ScrollUpdate:\n          touchStart = null;  // Since we're scrolling now, disregard other touch gestures.\n          this._scrolls.append(this._segmentForEvent(event, phases.Scroll));\n          break;\n\n        case eventTypes.FlingStart:\n          if (flingStart) {\n            Common.Console.Console.instance().error(Common.UIString.UIString(\n                'Two flings at the same time? %s vs %s', flingStart.startTime, event.startTime));\n            break;\n          }\n          flingStart = event;\n          break;\n\n        case eventTypes.FlingCancel:\n          // FIXME: also process renderer fling events.\n          if (!flingStart) {\n            break;\n          }\n          this._scrolls.append(this._segmentForEventRange(flingStart, event, phases.Fling));\n          flingStart = null;\n          break;\n\n        case eventTypes.ImplSideFling:\n          this._scrolls.append(this._segmentForEvent(event, phases.Fling));\n          break;\n\n        case eventTypes.ShowPress:\n        case eventTypes.Tap:\n        case eventTypes.KeyDown:\n        case eventTypes.KeyDownRaw:\n        case eventTypes.KeyUp:\n        case eventTypes.Char:\n        case eventTypes.Click:\n        case eventTypes.ContextMenu:\n          this._responses.append(this._segmentForEvent(event, phases.Response));\n          break;\n\n        case eventTypes.TouchStart:\n          // We do not produce any response segment for TouchStart -- there's either going to be one upon\n          // TouchMove for drag, or one for GestureTap.\n          if (touchStart) {\n            Common.Console.Console.instance().error(Common.UIString.UIString(\n                'Two touches at the same time? %s vs %s', touchStart.startTime, event.startTime));\n            break;\n          }\n          touchStart = event;\n          this._setPhaseForEvent(event, phases.Response);\n          firstTouchMove = null;\n          break;\n\n        case eventTypes.TouchCancel:\n          touchStart = null;\n          break;\n\n        case eventTypes.TouchMove:\n          if (firstTouchMove) {\n            this._drags.append(this._segmentForEvent(event, phases.Drag));\n          } else if (touchStart) {\n            firstTouchMove = event;\n            this._responses.append(this._segmentForEventRange(touchStart, event, phases.Response));\n          }\n          break;\n\n        case eventTypes.TouchEnd:\n          touchStart = null;\n          break;\n\n        case eventTypes.MouseDown:\n          mouseDown = event;\n          mouseMove = null;\n          break;\n\n        case eventTypes.MouseMove:\n          if (mouseDown && !mouseMove && mouseDown.startTime + thresholdsMs.mouse > event.startTime) {\n            this._responses.append(this._segmentForEvent(mouseDown, phases.Response));\n            this._responses.append(this._segmentForEvent(event, phases.Response));\n          } else if (mouseDown) {\n            this._drags.append(this._segmentForEvent(event, phases.Drag));\n          }\n          mouseMove = event;\n          break;\n\n        case eventTypes.MouseUp:\n          this._responses.append(this._segmentForEvent(event, phases.Response));\n          mouseDown = null;\n          break;\n\n        case eventTypes.MouseWheel:\n          // Do not consider first MouseWheel as trace viewer's implementation does -- in case of MouseWheel it's not really special.\n          if (mouseWheel && canMerge(thresholdsMs.mouse, mouseWheel, event)) {\n            this._scrolls.append(this._segmentForEventRange(mouseWheel, event, phases.Scroll));\n          } else {\n            this._scrolls.append(this._segmentForEvent(event, phases.Scroll));\n          }\n          mouseWheel = event;\n          break;\n      }\n    }\n\n    /**\n     * @param {number} threshold\n     * @param {!SDK.TracingModel.AsyncEvent} first\n     * @param {!SDK.TracingModel.AsyncEvent} second\n     * @return {boolean}\n     */\n    function canMerge(threshold, first, second) {\n      if (first.endTime === undefined) {\n        return false;\n      }\n      return first.endTime < second.startTime && second.startTime < first.endTime + threshold;\n    }\n  }\n\n  /**\n   * @param {!Array<!SDK.TracingModel.AsyncEvent>} events\n   */\n  _processAnimations(events) {\n    for (let i = 0; i < events.length; ++i) {\n      this._cssAnimations.append(this._segmentForEvent(events[i], Phases.Animation));\n    }\n  }\n\n  /**\n   * @param {!SDK.TracingModel.AsyncEvent} event\n   * @param {!Phases} phase\n   * @return {!Common.SegmentedRange.Segment}\n   */\n  _segmentForEvent(event, phase) {\n    this._setPhaseForEvent(event, phase);\n    return new Common.SegmentedRange.Segment(\n        event.startTime, event.endTime !== undefined ? event.endTime : Number.MAX_SAFE_INTEGER, phase);\n  }\n\n  /**\n   * @param {!SDK.TracingModel.AsyncEvent} startEvent\n   * @param {!SDK.TracingModel.AsyncEvent} endEvent\n   * @param {!Phases} phase\n   * @return {!Common.SegmentedRange.Segment}\n   */\n  _segmentForEventRange(startEvent, endEvent, phase) {\n    this._setPhaseForEvent(startEvent, phase);\n    this._setPhaseForEvent(endEvent, phase);\n    return new Common.SegmentedRange.Segment(\n        startEvent.startTime, startEvent.endTime !== undefined ? startEvent.endTime : Number.MAX_SAFE_INTEGER, phase);\n  }\n\n  /**\n   * @param {!SDK.TracingModel.AsyncEvent} asyncEvent\n   * @param {!Phases} phase\n   */\n  _setPhaseForEvent(asyncEvent, phase) {\n    eventToPhase.set(asyncEvent.steps[0], phase);\n  }\n\n  /**\n   * @return {!Array<!Common.SegmentedRange.Segment>}\n   */\n  interactionRecords() {\n    return this._segments;\n  }\n\n  reset() {\n    const thresholdsMs = TimelineIRModel._mergeThresholdsMs;\n\n    this._segments = [];\n    this._drags = new Common.SegmentedRange.SegmentedRange(merge.bind(null, thresholdsMs.mouse));\n    this._cssAnimations = new Common.SegmentedRange.SegmentedRange(merge.bind(null, thresholdsMs.animation));\n    this._responses = new Common.SegmentedRange.SegmentedRange(merge.bind(null, 0));\n    this._scrolls = new Common.SegmentedRange.SegmentedRange(merge.bind(null, thresholdsMs.animation));\n\n    /**\n     * @param {number} threshold\n     * @param {!Common.SegmentedRange.Segment} first\n     * @param {!Common.SegmentedRange.Segment} second\n     */\n    function merge(threshold, first, second) {\n      return first.end + threshold >= second.begin && first.data === second.data ? first : null;\n    }\n  }\n\n  /**\n   * @param {string} eventName\n   * @return {?InputEvents}\n   */\n  _inputEventType(eventName) {\n    const prefix = 'InputLatency::';\n    if (!eventName.startsWith(prefix)) {\n      if (eventName === InputEvents.ImplSideFling) {\n        return /** @type {!InputEvents} */ (eventName);\n      }\n      console.error('Unrecognized input latency event: ' + eventName);\n      return null;\n    }\n    return /** @type {!InputEvents} */ (eventName.substr(prefix.length));\n  }\n}\n\n/**\n * @enum {string}\n */\nexport const Phases = {\n  Idle: 'Idle',\n  Response: 'Response',\n  Scroll: 'Scroll',\n  Fling: 'Fling',\n  Drag: 'Drag',\n  Animation: 'Animation',\n  Uncategorized: 'Uncategorized'\n};\n\n/**\n * @enum {string}\n */\nexport const InputEvents = {\n  Char: 'Char',\n  Click: 'GestureClick',\n  ContextMenu: 'ContextMenu',\n  FlingCancel: 'GestureFlingCancel',\n  FlingStart: 'GestureFlingStart',\n  ImplSideFling: RecordType.ImplSideFling,\n  KeyDown: 'KeyDown',\n  KeyDownRaw: 'RawKeyDown',\n  KeyUp: 'KeyUp',\n  LatencyScrollUpdate: 'ScrollUpdate',\n  MouseDown: 'MouseDown',\n  MouseMove: 'MouseMove',\n  MouseUp: 'MouseUp',\n  MouseWheel: 'MouseWheel',\n  PinchBegin: 'GesturePinchBegin',\n  PinchEnd: 'GesturePinchEnd',\n  PinchUpdate: 'GesturePinchUpdate',\n  ScrollBegin: 'GestureScrollBegin',\n  ScrollEnd: 'GestureScrollEnd',\n  ScrollUpdate: 'GestureScrollUpdate',\n  ScrollUpdateRenderer: 'ScrollUpdate',\n  ShowPress: 'GestureShowPress',\n  Tap: 'GestureTap',\n  TapCancel: 'GestureTapCancel',\n  TapDown: 'GestureTapDown',\n  TouchCancel: 'TouchCancel',\n  TouchEnd: 'TouchEnd',\n  TouchMove: 'TouchMove',\n  TouchStart: 'TouchStart'\n};\n\nTimelineIRModel._mergeThresholdsMs = {\n  animation: 1,\n  mouse: 40,\n};\n\nTimelineIRModel._eventIRPhase = Symbol('eventIRPhase');\n"]}