{"version":3,"file":"QuickPick.js","sourceRoot":"","sources":["../../../../../front_end/quick_open/QuickPick.js"],"names":[],"mappings":"AAAA,4DAA4D;AAC5D,yEAAyE;AACzE,6BAA6B;AAE7B,OAAO,KAAK,IAAI,MAAM,iBAAiB,CAAC;AACxC,OAAO,KAAK,EAAE,MAAM,aAAa,CAAC,CAAE,qCAAqC;AACzE,OAAO,EAAC,kBAAkB,EAAE,QAAQ,EAAC,MAAM,yBAAyB,CAAC;AAErE;;;;;;GAMG;AACH,aAAa;AACb,MAAM,CAAC,IAAI,aAAa,CAAC;AAEzB;;;;;;GAMG;AACH,aAAa;AACb,MAAM,CAAC,IAAI,gBAAgB,CAAC;AAE5B,MAAM,OAAO,SAAS;IACpB;;OAEG;IACH;QACE,MAAM,IAAI,cAAc,CAAC,gCAAgC,CAAC,CAAC;IAC7D,CAAC;IAED;;;;;OAKG;IACH,MAAM,CAAC,IAAI,CAAC,KAAK,EAAE,OAAO;QACxB;;WAEG;QACH,IAAI,eAAe,GAAG,IAAI,OAAO,CAAC,EAAE,CAAC,EAAE,GAAE,CAAC,CAAC,CAAC,CAAE,8CAA8C;QAC5F;;WAEG;QACH,MAAM,gBAAgB,GAAG,IAAI,OAAO,CAAC,OAAO,CAAC,EAAE;YAC7C,MAAM,QAAQ,GACV,IAAI,iBAAiB,CAAC,KAAK,EAAE,OAAO,EAAE,OAAO,CAAC,kBAAkB,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,aAAa,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YAClH,MAAM,MAAM,GAAG,IAAI,kBAAkB,CAAC,QAAQ,CAAC,CAAC;YAChD,MAAM,CAAC,cAAc,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;YAC3C,MAAM,CAAC,cAAc,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;YAC3C,MAAM,CAAC,YAAY,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;YACzC,eAAe,GAAG,kCAAkC,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;YAC7E,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;QACtB,CAAC,CAAC,CAAC;QAEH,OAAO,OAAO,CAAC,IAAI,CAAC,CAAC,gBAAgB,EAAE,eAAe,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;YACrE,wDAAwD;YACxD,uDAAuD;YACvD,6CAA6C;YAC7C,OAAO,MAAM,CAAC;QAChB,CAAC,CAAC,CAAC;IACL,CAAC;CACF;AAED,MAAM,iBAAkB,SAAQ,QAAQ;IACtC;;;;;;OAMG;IACH,YAAY,KAAK,EAAE,OAAO,EAAE,kBAAkB,GAAG,GAAG,EAAE,aAAa,GAAG,IAAI;QACxE,KAAK,EAAE,CAAC;QACR,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;QACxB,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QACpB,IAAI,CAAC,mBAAmB,GAAG,kBAAkB,CAAC;QAC9C,IAAI,CAAC,cAAc,GAAG,aAAa,CAAC;IACtC,CAAC;IAED;;OAEG;IACH,SAAS;QACP,OAAO,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC;IAC5B,CAAC;IAED;;;;OAIG;IACH,SAAS,CAAC,SAAS;QACjB,MAAM,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;QACpC,IAAI,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC;QACrB,IAAI,IAAI,CAAC,mBAAmB,EAAE;YAC5B,GAAG,IAAI,GAAG,GAAG,IAAI,CAAC,WAAW,CAAC;SAC/B;QACD,IAAI,IAAI,CAAC,cAAc,EAAE;YACvB,GAAG,IAAI,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC;SAC1B;QACD,OAAO,GAAG,CAAC;IACb,CAAC;IAED;;;;;OAKG;IACH,WAAW,CAAC,SAAS,EAAE,KAAK;QAC1B,MAAM,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;QACpC,MAAM,IAAI,GAAG,KAAK,CAAC,WAAW,EAAE,CAAC;QACjC,IAAI,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,cAAc,CAAC,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,WAAW,EAAE,CAAC,CAAC;QAEjF,IAAI,IAAI,CAAC,mBAAmB,IAAI,IAAI,CAAC,WAAW,EAAE;YAChD,MAAM,gBAAgB,GAAG,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,cAAc,CAAC,IAAI,EAAE,IAAI,CAAC,WAAW,CAAC,WAAW,EAAE,CAAC,CAAC;YACpG,KAAK,IAAI,gBAAgB,GAAG,IAAI,CAAC,mBAAmB,CAAC;SACtD;QAED,IAAI,IAAI,CAAC,cAAc,IAAI,IAAI,CAAC,MAAM,EAAE;YACtC,MAAM,WAAW,GAAG,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,cAAc,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC,CAAC;YAC1F,KAAK,IAAI,WAAW,GAAG,IAAI,CAAC,cAAc,CAAC;SAC5C;QAED,OAAO,KAAK,CAAC;IACf,CAAC;IAED;;;;;;OAMG;IACH,UAAU,CAAC,SAAS,EAAE,KAAK,EAAE,YAAY,EAAE,eAAe;QACxD,MAAM,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;QACpC,YAAY,CAAC,cAAc,EAAE,CAAC;QAC9B,MAAM,YAAY,GAAG,YAAY,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;QACtD,EAAE,CAAC,OAAO,CAAC,eAAe,CAAC,YAAY,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;QACrD,kBAAkB,CAAC,eAAe,CAAC,YAAY,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;QAC9D,IAAI,IAAI,CAAC,WAAW,EAAE;YACpB,MAAM,kBAAkB,GAAG,YAAY,CAAC,WAAW,CAAC,MAAM,EAAE,uBAAuB,CAAC,CAAC;YACrF,EAAE,CAAC,OAAO,CAAC,eAAe,CAAC,kBAAkB,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;YACjE,IAAI,IAAI,CAAC,mBAAmB,EAAE;gBAC5B,kBAAkB,CAAC,eAAe,CAAC,kBAAkB,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;aACrE;SACF;QACD,IAAI,IAAI,CAAC,MAAM,EAAE;YACf,EAAE,CAAC,OAAO,CAAC,eAAe,CAAC,eAAe,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;YACzD,IAAI,IAAI,CAAC,cAAc,EAAE;gBACvB,kBAAkB,CAAC,eAAe,CAAC,eAAe,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;aAClE;SACF;IACH,CAAC;IAED;;;OAGG;IACH,eAAe;QACb,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,OAAO,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;IAClD,CAAC;IAED;;;;OAIG;IACH,UAAU,CAAC,SAAS,EAAE,YAAY;QAChC,IAAI,OAAO,SAAS,KAAK,QAAQ,EAAE;YACjC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC;YACtC,OAAO;SACR;QAED,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC;IAC3B,CAAC;CACF","sourcesContent":["// Copyright 2020 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Diff from '../diff/diff.js';\nimport * as UI from '../ui/ui.js';  // eslint-disable-line no-unused-vars\nimport {FilteredListWidget, Provider} from './FilteredListWidget.js';\n\n/**\n * @typedef {{\n *  label: string,\n *  description: (string|undefined),\n *  detail: (string|undefined),\n * }}\n */\n// @ts-ignore\nexport let QuickPickItem;\n\n/**\n * @typedef {{\n *   placeHolder: string,\n *   matchOnDescription: (boolean|undefined),\n *   matchOnDetail: (boolean|undefined),\n * }}\n */\n// @ts-ignore\nexport let QuickPickOptions;\n\nexport class QuickPick {\n  /**\n   * @private\n   */\n  constructor() {\n    throw new ReferenceError('Instance type not implemented.');\n  }\n\n  /**\n   *\n   * @param {!Array<!QuickPickItem>} items\n   * @param {!QuickPickOptions} options\n   * @return {!Promise<!QuickPickItem|undefined>}\n   */\n  static show(items, options) {\n    /**\n     * @type {!Promise<undefined>}\n     */\n    let canceledPromise = new Promise(_r => {});  // Intentionally creates an unresolved promise\n    /**\n     * @type {!Promise<!QuickPickItem>}\n     */\n    const fulfilledPromise = new Promise(resolve => {\n      const provider =\n          new QuickPickProvider(items, resolve, options.matchOnDescription ? 0.5 : 0, options.matchOnDetail ? 0.25 : 0);\n      const widget = new FilteredListWidget(provider);\n      widget.setPlaceholder(options.placeHolder);\n      widget.setPromptTitle(options.placeHolder);\n      widget.showAsDialog(options.placeHolder);\n      canceledPromise = /** @type {!Promise<undefined>} */ (widget.once('hidden'));\n      widget.setQuery('');\n    });\n\n    return Promise.race([fulfilledPromise, canceledPromise]).then(values => {\n      // If it was fulfilled, then `result` will have a value.\n      // If it was canceled, then `result` will be undefined.\n      // Either way, it has the value that we want.\n      return values;\n    });\n  }\n}\n\nclass QuickPickProvider extends Provider {\n  /**\n   *\n   * @param {!Array<!QuickPickItem>} items\n   * @param {!Function} resolve\n   * @param {number=} matchOnDescription\n   * @param {number=} matchOnDetail\n   */\n  constructor(items, resolve, matchOnDescription = 0.5, matchOnDetail = 0.25) {\n    super();\n    this._resolve = resolve;\n    this._items = items;\n    this._matchOnDescription = matchOnDescription;\n    this._matchOnDetail = matchOnDetail;\n  }\n\n  /**\n   * @override\n   */\n  itemCount() {\n    return this._items.length;\n  }\n\n  /**\n   * @override\n   * @param {number} itemIndex\n   * @return {string}\n   */\n  itemKeyAt(itemIndex) {\n    const item = this._items[itemIndex];\n    let key = item.label;\n    if (this._matchOnDescription) {\n      key += ' ' + item.description;\n    }\n    if (this._matchOnDetail) {\n      key += ' ' + item.detail;\n    }\n    return key;\n  }\n\n  /**\n   * @override\n   * @param {number} itemIndex\n   * @param {string} query\n   * @return {number}\n   */\n  itemScoreAt(itemIndex, query) {\n    const item = this._items[itemIndex];\n    const test = query.toLowerCase();\n    let score = Diff.Diff.DiffWrapper.characterScore(test, item.label.toLowerCase());\n\n    if (this._matchOnDescription && item.description) {\n      const descriptionScore = Diff.Diff.DiffWrapper.characterScore(test, item.description.toLowerCase());\n      score += descriptionScore * this._matchOnDescription;\n    }\n\n    if (this._matchOnDetail && item.detail) {\n      const detailScore = Diff.Diff.DiffWrapper.characterScore(test, item.detail.toLowerCase());\n      score += detailScore * this._matchOnDetail;\n    }\n\n    return score;\n  }\n\n  /**\n   * @override\n   * @param {number} itemIndex\n   * @param {string} query\n   * @param {!Element} titleElement\n   * @param {!Element} subtitleElement\n   */\n  renderItem(itemIndex, query, titleElement, subtitleElement) {\n    const item = this._items[itemIndex];\n    titleElement.removeChildren();\n    const labelElement = titleElement.createChild('span');\n    UI.UIUtils.createTextChild(labelElement, item.label);\n    FilteredListWidget.highlightRanges(titleElement, query, true);\n    if (item.description) {\n      const descriptionElement = titleElement.createChild('span', 'quickpick-description');\n      UI.UIUtils.createTextChild(descriptionElement, item.description);\n      if (this._matchOnDescription) {\n        FilteredListWidget.highlightRanges(descriptionElement, query, true);\n      }\n    }\n    if (item.detail) {\n      UI.UIUtils.createTextChild(subtitleElement, item.detail);\n      if (this._matchOnDetail) {\n        FilteredListWidget.highlightRanges(subtitleElement, query, true);\n      }\n    }\n  }\n\n  /**\n   * @override\n   * @return {boolean}\n   */\n  renderAsTwoRows() {\n    return this._items.some(i => Boolean(i.detail));\n  }\n\n  /**\n   * @override\n   * @param {?number} itemIndex\n   * @param {string} _promptValue\n   */\n  selectItem(itemIndex, _promptValue) {\n    if (typeof itemIndex === 'number') {\n      this._resolve(this._items[itemIndex]);\n      return;\n    }\n\n    this._resolve(undefined);\n  }\n}\n"]}