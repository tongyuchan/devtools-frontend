{"version":3,"file":"CSSVarSwatch.js","sourceRoot":"","sources":["../../../../../front_end/inline_editor/CSSVarSwatch.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) 2020 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as i18n from '../i18n/i18n.js';\nimport * as LitHtml from '../third_party/lit-html/lit-html.js';\n\nexport const UIStrings = {\n  /**\n  *@description Text in CSS Variable Switch\n  */\n  jumpToDefinition: 'Jump to definition',\n  /**\n  *@description Text displayed in a tooltip shown when hovering over a var() CSS function in the Styles pane when the custom property in this function does not exist. The parameter is the name of the property.\n  *@example {--my-custom-property-name} PH1\n  */\n  sIsNotDefined: '{PH1} is not defined',\n};\nconst str_ = i18n.i18n.registerUIStrings('inline_editor/CSSVarSwatch.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nconst {render, html, Directives} = LitHtml;\n\nconst VARIABLE_FUNCTION_REGEX = /(var\\()(\\s*--[^,)]+)(.*)/;\n\ninterface SwatchRenderData {\n  text: string;\n  computedValue: string|null;\n  fromFallback: boolean;\n  onLinkClick: (varialeName: string, event: MouseEvent) => void;\n}\n\ninterface ParsedVariableFunction {\n  pre: string;\n  name: string;\n  post: string;\n}\n\nexport class CSSVarSwatch extends HTMLElement {\n  private readonly shadow = this.attachShadow({mode: 'open'});\n  private text: string = '';\n  private computedValue: string|null = null;\n  private fromFallback: boolean = false;\n  private onLinkClick: (varialeName: string, event: MouseEvent) => void = () => undefined;\n\n  set data(data: SwatchRenderData) {\n    this.text = data.text;\n    this.computedValue = data.computedValue;\n    this.fromFallback = data.fromFallback;\n    this.onLinkClick = data.onLinkClick;\n\n    this.render();\n  }\n\n  private parseVariableFunctionParts(): ParsedVariableFunction|null {\n    // When the value of CSS var() is greater than two spaces, only one is\n    // always displayed, and the actual number of spaces is displayed when\n    // editing is clicked.\n    const result = this.text.replace(/\\s{2,}/g, ' ').match(VARIABLE_FUNCTION_REGEX);\n    if (!result) {\n      return null;\n    }\n\n    return {\n      pre: result[1],\n      name: result[2],\n      post: result[3],\n    };\n  }\n\n  private get variableName(): string {\n    const match = this.text.match(/--[^,)]+/);\n    if (match) {\n      return match[0];\n    }\n    return '';\n  }\n\n  private renderLink(variableName: string): LitHtml.TemplateResult {\n    const isDefined = this.computedValue && !this.fromFallback;\n\n    const classes = Directives.classMap({\n      'css-var-link': true,\n      'undefined': !isDefined,\n    });\n    const title =\n        isDefined ? i18nString(UIStrings.jumpToDefinition) : i18nString(UIStrings.sIsNotDefined, {PH1: variableName});\n    // The this.variableName's space must be removed, otherwise it cannot be triggered when clicked.\n    const onClick = isDefined ? this.onLinkClick.bind(this, this.variableName.trim()) : null;\n\n    return html`<span class=\"${classes}\" title=\"${title}\" @mousedown=${onClick} role=\"link\" tabindex=\"-1\">${\n        variableName}</span>`;\n  }\n\n  private render(): void {\n    const functionParts = this.parseVariableFunctionParts();\n    if (!functionParts) {\n      render('', this.shadow, {eventContext: this});\n      return;\n    }\n\n    const link = this.renderLink(functionParts.name);\n\n    // Disabled until https://crbug.com/1079231 is fixed.\n    // clang-format off\n    render(\n      html`<style>\n      .css-var-link:not(.undefined) {\n        cursor: pointer;\n        text-underline-position: under;\n        color: var(--link-color);\n      }\n\n      .css-var-link:hover:not(.undefined) {\n        text-decoration: underline;\n      }\n\n      .css-var-link:focus:not(:focus-visible) {\n        outline: none;\n      }\n      </style><span title=\"${this.computedValue || ''}\">${functionParts.pre}${link}${functionParts.post}</span>`,\n      this.shadow, { eventContext: this });\n    // clang-format on\n  }\n}\n\nif (!customElements.get('devtools-css-var-swatch')) {\n  customElements.define('devtools-css-var-swatch', CSSVarSwatch);\n}\n\ndeclare global {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  interface HTMLElementTagNameMap {\n    'devtools-css-var-swatch': CSSVarSwatch;\n  }\n}\n"]}