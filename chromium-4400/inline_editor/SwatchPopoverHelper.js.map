{"version":3,"file":"SwatchPopoverHelper.js","sourceRoot":"","sources":["../../../../../front_end/inline_editor/SwatchPopoverHelper.js"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2016 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as Common from '../common/common.js';\nimport * as UI from '../ui/ui.js';\n\nimport {ColorSwatch} from './ColorSwatch.js';\n\nexport class SwatchPopoverHelper extends Common.ObjectWrapper.ObjectWrapper {\n  constructor() {\n    super();\n    this._popover = new UI.GlassPane.GlassPane();\n    this._popover.registerRequiredCSS('inline_editor/swatchPopover.css', {enableLegacyPatching: false});\n    this._popover.setSizeBehavior(UI.GlassPane.SizeBehavior.MeasureContent);\n    this._popover.setMarginBehavior(UI.GlassPane.MarginBehavior.Arrow);\n    this._popover.element.addEventListener('mousedown', e => e.consume(), false);\n\n    this._hideProxy = this.hide.bind(this, true);\n    this._boundOnKeyDown = this._onKeyDown.bind(this);\n    this._boundFocusOut = this._onFocusOut.bind(this);\n    this._isHidden = true;\n    /** @type {?Element} */\n    this._anchorElement = null;\n  }\n\n  /**\n   * @param {!FocusEvent} event\n   */\n  _onFocusOut(event) {\n    const relatedTarget = /** @type {?Element} */ (event.relatedTarget);\n    if (this._isHidden || !relatedTarget || !this._view ||\n        relatedTarget.isSelfOrDescendant(this._view.contentElement)) {\n      return;\n    }\n    this._hideProxy();\n  }\n\n  /**\n   * @return {boolean}\n   */\n  isShowing() {\n    return this._popover.isShowing();\n  }\n\n  /**\n   * @param {!UI.Widget.Widget} view\n   * @param {!Element} anchorElement\n   * @param {function(boolean)=} hiddenCallback\n   */\n  show(view, anchorElement, hiddenCallback) {\n    if (this._popover.isShowing()) {\n      if (this._anchorElement === anchorElement) {\n        return;\n      }\n\n      // Reopen the picker for another anchor element.\n      this.hide(true);\n    }\n\n    this.dispatchEventToListeners(Events.WillShowPopover);\n\n    this._isHidden = false;\n    this._anchorElement = anchorElement;\n    this._view = view;\n    this._hiddenCallback = hiddenCallback;\n    this.reposition();\n    view.focus();\n\n    const document = this._popover.element.ownerDocument;\n    document.addEventListener('mousedown', this._hideProxy, false);\n    if (document.defaultView) {\n      document.defaultView.addEventListener('resize', this._hideProxy, false);\n    }\n    this._view.contentElement.addEventListener('keydown', this._boundOnKeyDown, false);\n  }\n\n  reposition() {\n    // This protects against trying to reposition the popover after it has been hidden.\n    if (this._isHidden || !this._view) {\n      return;\n    }\n    // Unbind \"blur\" listener to avoid reenterability: |popover.show()| will hide the popover and trigger it synchronously.\n    this._view.contentElement.removeEventListener('focusout', this._boundFocusOut, false);\n    this._view.show(this._popover.contentElement);\n    if (this._anchorElement) {\n      let anchorBox = this._anchorElement.boxInWindow();\n      if (ColorSwatch.isColorSwatch(this._anchorElement)) {\n        const swatch = /** @type {!ColorSwatch} */ (this._anchorElement);\n        if (!swatch.anchorBox) {\n          return;\n        }\n        anchorBox = swatch.anchorBox;\n      }\n\n      this._popover.setContentAnchorBox(anchorBox);\n      this._popover.show(/** @type {!Document} */ (this._anchorElement.ownerDocument));\n    }\n    this._view.contentElement.addEventListener('focusout', this._boundFocusOut, false);\n    if (!this._focusRestorer) {\n      this._focusRestorer = new UI.Widget.WidgetFocusRestorer(this._view);\n    }\n  }\n\n  /**\n   * @param {boolean=} commitEdit\n   */\n  hide(commitEdit) {\n    if (this._isHidden) {\n      return;\n    }\n    const document = this._popover.element.ownerDocument;\n    this._isHidden = true;\n    this._popover.hide();\n\n    document.removeEventListener('mousedown', this._hideProxy, false);\n    if (document.defaultView) {\n      document.defaultView.removeEventListener('resize', this._hideProxy, false);\n    }\n\n    if (this._hiddenCallback) {\n      this._hiddenCallback.call(null, Boolean(commitEdit));\n    }\n\n    if (this._focusRestorer) {\n      this._focusRestorer.restore();\n    }\n    this._anchorElement = null;\n    if (this._view) {\n      this._view.detach();\n      this._view.contentElement.removeEventListener('keydown', this._boundOnKeyDown, false);\n      this._view.contentElement.removeEventListener('focusout', this._boundFocusOut, false);\n      delete this._view;\n    }\n  }\n\n  /**\n   * @param {!Event} event\n   */\n  _onKeyDown(event) {\n    const keyboardEvent = /** @type {!KeyboardEvent} */ (event);\n    if (keyboardEvent.key === 'Enter') {\n      this.hide(true);\n      keyboardEvent.consume(true);\n      return;\n    }\n    if (keyboardEvent.key === 'Escape') {\n      this.hide(false);\n      keyboardEvent.consume(true);\n    }\n  }\n}\n\n/** @enum {symbol} */\nexport const Events = {\n  WillShowPopover: Symbol('WillShowPopover'),\n};\n"]}